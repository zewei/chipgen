# STM32MP25x SoC Net Description
# Based on Arch.md architecture specification
# Complete version with all architecture details

# Clock Network Description
clock_network:
  description: "Complete clock distribution network for STM32MP25x SoC"
  
  # Clock Domains
  domains:
    mpu_domain:
      description: "Main processor domain (Cortex-A35)"
      primary_clock: clk_mpu
      frequency: 1200000000
      source: pll1_p
      gated_by: clk_en_mpu
      
    mcu_domain:
      description: "Microcontroller domain (Cortex-M33)"
      primary_clock: clk_mcu
      frequency: 400000000
      source: pll1_q
      gated_by: clk_en_mcu
      
    axi_domain:
      description: "AXI interconnect domain"
      primary_clock: clk_axi
      frequency: 400000000
      source: pll2_p
      gated_by: clk_en_axi
      
    ahb_domain:
      description: "AHB bus domain"
      primary_clock: clk_ahb
      frequency: 200000000
      source: pll2_q
      gated_by: clk_en_ahb
      
    apb_domain:
      description: "APB peripheral domain"
      primary_clock: clk_apb
      frequency: 100000000
      source: pll2_r
      gated_by: clk_en_apb
      
    gpu_domain:
      description: "Graphics processing domain"
      primary_clock: clk_gpu
      frequency: 800000000
      source: pll3_p
      gated_by: clk_en_gpu
      
    npu_domain:
      description: "Neural processing domain"
      primary_clock: clk_npu
      frequency: 800000000
      source: pll3_q
      gated_by: clk_en_npu
      
    ddr_domain:
      description: "DDR memory domain"
      primary_clock: clk_ddr
      frequency: 600000000
      source: pll4_p
      gated_by: clk_en_ddr
      
  # Clock Routing
  routing:
    # Primary clock distribution
    pll1_p:
      description: "PLL1 P output - Main system clock"
      destinations:
        - clk_mpu
        - clk_gpu
        - clk_hrtim
        - clk_tim1
        
    pll1_q:
      description: "PLL1 Q output - MCU and peripherals"
      destinations:
        - clk_mcu
        - clk_systick
        - clk_tim2
        
    pll1_r:
      description: "PLL1 R output - Low speed peripherals"
      destinations:
        - clk_tim3
        - clk_tim4
        
    pll2_p:
      description: "PLL2 P output - AXI domain"
      destinations:
        - clk_axi
        - clk_eth
        
    pll2_q:
      description: "PLL2 Q output - AHB domain"
      destinations:
        - clk_ahb
        - clk_usb
        
    pll2_r:
      description: "PLL2 R output - APB domain"
      destinations:
        - clk_apb
        - clk_pcie
        
    pll3_p:
      description: "PLL3 P output - Video processing"
      destinations:
        - clk_venc
        
    pll3_q:
      description: "PLL3 Q output - Neural processing"
      destinations:
        - clk_vdec
        - clk_npu
        
    pll4_p:
      description: "PLL4 P output - Memory interface"
      destinations:
        - clk_ddr
        
  # Clock Gating Strategy
  gating:
    description: "Clock gating implementation strategy"
    levels:
      level0:
        description: "Top-level domain gating"
        gates:
          - clk_en_mpu
          - clk_en_mcu
          - clk_en_gpu
          - clk_en_npu
          - clk_en_ddr
          
      level1:
        description: "Bus-level gating"
        gates:
          - clk_en_axi
          - clk_en_ahb
          - clk_en_apb
          
      level2:
        description: "Peripheral-level gating"
        gates:
          - clk_en_eth
          - clk_en_usb
          - clk_en_pcie
          - clk_en_venc
          - clk_en_vdec
          
  # Clock Security System
  security:
    description: "Clock security and monitoring"
    monitors:
      hse_monitor:
        type: frequency
        source: osc_hse
        threshold: "15-50MHz"
        action: interrupt_and_switch
        
      lse_monitor:
        type: frequency
        source: osc_lse
        threshold: "30-35kHz"
        action: reset
        
      pll_monitor:
        type: lock_detect
        sources: [pll1, pll2, pll3, pll4]
        action: interrupt
        
  # Power Management Integration
  power_management:
    description: "Integration with power management"
    low_power_modes:
      sleep:
        description: "CPU clock stopped, peripherals running"
        affected_clocks: [clk_mpu, clk_mcu]
        
      stop:
        description: "All PLLs stopped, oscillators running"
        affected_clocks: [clk_mpu, clk_mcu, clk_axi, clk_ahb, clk_apb]
        
      standby:
        description: "Only LSE/LSI running"
        affected_clocks: [clk_mpu, clk_mcu, clk_axi, clk_ahb, clk_apb, pll1, pll2, pll3, pll4]
        
      shutdown:
        description: "All clocks stopped"
        affected_clocks: "all"

# Clock Controller Section
clock:
  # Clock Sources
  osc_hse:
    type: source
    frequency: 16000000
    description: "16-48 MHz crystal oscillator"
    css: true
    
  osc_lse:
    type: source
    frequency: 32768
    description: "32.768 kHz crystal oscillator"
    css: true
    
  osc_hsi:
    type: source
    frequency: 64000000
    description: "64 MHz internal RC oscillator"
    trim: true
    
  osc_lsi:
    type: source
    frequency: 32000
    description: "32 kHz internal RC oscillator"
    
  osc_csi:
    type: source
    frequency: 4000000
    description: "4 MHz internal RC oscillator"
    
  # PLL Controllers
  pll1:
    type: pll
    input: osc_hse
    multiplier: 30
    divider: 1
    outputs:
      p: { frequency: 480000000, enabled: true }
      q: { frequency: 240000000, enabled: true }
      r: { frequency: 120000000, enabled: true }
    
  pll2:
    type: pll
    input: osc_hse
    multiplier: 25
    divider: 1
    outputs:
      p: { frequency: 400000000, enabled: true }
      q: { frequency: 200000000, enabled: true }
      r: { frequency: 100000000, enabled: true }
    
  pll3:
    type: pll
    input: osc_hse
    multiplier: 20
    divider: 1
    outputs:
      p: { frequency: 320000000, enabled: true }
      q: { frequency: 160000000, enabled: true }
      r: { frequency: 80000000, enabled: true }
    
  pll4:
    type: pll
    input: osc_hse
    multiplier: 15
    divider: 1
    outputs:
      p: { frequency: 240000000, enabled: true }
      q: { frequency: 120000000, enabled: true }
      r: { frequency: 60000000, enabled: true }
    
  # Clock Dividers
  clk_divider:
    type: divider
    inputs:
      pll1_p: { source: pll1.p, divider: 1 }
      pll1_q: { source: pll1.q, divider: 1 }
      pll1_r: { source: pll1.r, divider: 1 }
      pll2_p: { source: pll2.p, divider: 1 }
      pll2_q: { source: pll2.q, divider: 1 }
      pll2_r: { source: pll2.r, divider: 1 }
      pll3_p: { source: pll3.p, divider: 1 }
      pll3_q: { source: pll3.q, divider: 1 }
      pll3_r: { source: pll3.r, divider: 1 }
      pll4_p: { source: pll4.p, divider: 1 }
      pll4_q: { source: pll4.q, divider: 1 }
      pll4_r: { source: pll4.r, divider: 1 }
      osc_hsi: { source: osc_hsi, divider: 1 }
      osc_csi: { source: osc_csi, divider: 1 }
      osc_lsi: { source: osc_lsi, divider: 1 }
    outputs:
      clk_mpu: { source: pll1_p, divider: 1, frequency: 480000000 }
      clk_mcu: { source: pll1_q, divider: 2, frequency: 240000000 }
      clk_axi: { source: pll2_p, divider: 1, frequency: 400000000 }
      clk_ahb: { source: pll2_q, divider: 2, frequency: 200000000 }
      clk_apb: { source: pll2_r, divider: 2, frequency: 100000000 }
      clk_gpu: { source: pll3_p, divider: 1, frequency: 320000000 }
      clk_npu: { source: pll3_q, divider: 2, frequency: 160000000 }
      clk_ddr: { source: pll4_p, divider: 1, frequency: 240000000 }
      clk_eth: { source: pll4_q, divider: 2, frequency: 120000000 }
      clk_usb: { source: pll4_r, divider: 2, frequency: 60000000 }
      clk_pcie: { source: pll2_r, divider: 4, frequency: 50000000 }
      clk_venc: { source: pll3_p, divider: 2, frequency: 160000000 }
      clk_vdec: { source: pll3_q, divider: 2, frequency: 80000000 }
      clk_systick: { source: pll1_r, divider: 8, frequency: 15000000 }
      clk_rtc: { source: osc_lse, divider: 1, frequency: 32768 }
      clk_lptim1: { source: osc_lsi, divider: 1, frequency: 32000 }
      clk_lptim2: { source: osc_lsi, divider: 2, frequency: 16000 }
      clk_tim1: { source: pll1_p, divider: 4, frequency: 120000000 }
      clk_tim2: { source: pll1_q, divider: 4, frequency: 60000000 }
      clk_tim3: { source: pll1_r, divider: 2, frequency: 60000000 }
      clk_tim4: { source: pll2_p, divider: 8, frequency: 50000000 }
      clk_hrtim: { source: pll1_p, divider: 2, frequency: 240000000 }
      
  # Clock Gate Controllers
  clock_gate_mpu:
    type: gate
    input: clk_divider.clk_mpu
    enable: clk_en_mpu
    description: "MPU clock gate"
    
  clock_gate_mcu:
    type: gate
    input: clk_divider.clk_mcu
    enable: clk_en_mcu
    description: "MCU clock gate"
    
  clock_gate_gpu:
    type: gate
    input: clk_divider.clk_gpu
    enable: clk_en_gpu
    description: "GPU clock gate"
    
  clock_gate_npu:
    type: gate
    input: clk_divider.clk_npu
    enable: clk_en_npu
    description: "NPU clock gate"
    
  # Clock Security System
  clock_security:
    type: security
    monitors:
      hse: { source: osc_hse, enabled: true, action: interrupt }
      lse: { source: osc_lse, enabled: true, action: reset }
      pll1: { source: pll1, enabled: true, action: switch_to_hsi }
      pll2: { source: pll2, enabled: true, action: switch_to_hsi }
    
  # Clock Multiplexers
  clk_mux_sys:
    type: mux
    inputs:
      - pll1_p
      - pll2_p
      - osc_hsi
      - osc_csi
    select: sys_clk_sel
    default: pll1_p
    description: "System clock multiplexer"
# Part 1：Top-level ports
port:
  # External Clocks
  HSE:
    direction: input
    type: logic
    description: "16-48 MHz crystal oscillator (required for DDR and USB)"
  LSE:
    direction: input
    type: logic
    description: "32.768 kHz crystal oscillator (RTC)"
  
  # External Reset
  NRST:
    direction: inout
    type: logic
    description: "Active low, open-drain, 20kΩ internal pull-up"
  
  # Boot Selection
  BOOT:
    direction: input
    type: logic[3:0]
    description: "Boot selection pins with OTP override capability"
  
  # Reset Control
  reason_clear:
    direction: input
    type: logic
    description: "Software clear signal for reset reason recording"
  test_en:
    direction: input
    type: logic
    description: "Test enable signal for DFT bypass"
  
  # Power Supplies
  VDD:
    direction: inout
    type: logic
    description: "Main I/O supply (1.71-1.95V or 2.7-3.6V)"
  VDDCORE:
    direction: inout
    type: logic
    description: "Digital core supply"
  VDDCPU:
    direction: inout
    type: logic
    description: "Cortex-A35 supply"
  VDDGPU:
    direction: inout
    type: logic
    description: "GPU/NPU supply (optional)"
  VBAT:
    direction: inout
    type: logic
    description: "Backup domain supply (1.55-3.6V)"
  
  # DDR Interface
  DDR_CLK:
    direction: output
    type: logic
  DDR_ADDR:
    direction: output
    type: logic[15:0]
  DDR_DATA:
    direction: inout
    type: logic[31:0]
  DDR_CTRL:
    direction: output
    type: logic[11:0]
  
  # Ethernet Interfaces
  ETH1_RGMII:
    direction: inout
    type: logic[31:0]
    description: "Gigabit GMAC with one PHY interface (optional)"
  ETH2_RGMII:
    direction: inout
    type: logic[31:0]
    description: "Gigabit GMAC with external PHY interface"
  ETHSW_RGMII:
    direction: inout
    type: logic[95:0]
    description: "3-port Gigabit Ethernet switch (optional, STM32MP257x)"
  
  # USB Interfaces
  USBH_DP:
    direction: inout
    type: logic
  USBH_DM:
    direction: inout
    type: logic
  USB3DR_SSTX:
    direction: output
    type: logic[2:0]
  USB3DR_SSRX:
    direction: input
    type: logic[2:0]
  USB3DR_DP:
    direction: inout
    type: logic
  USB3DR_DM:
    direction: inout
    type: logic
  
  # PCIe Interface
  PCIE_TX:
    direction: output
    type: logic[3:0]
  PCIE_RX:
    direction: input
    type: logic[3:0]
  
  # Display Interfaces
  LCD_RGB:
    direction: output
    type: logic[23:0]
  LCD_HSYNC:
    direction: output
    type: logic
  LCD_VSYNC:
    direction: output
    type: logic
  LCD_DE:
    direction: output
    type: logic
  LCD_CLK:
    direction: output
    type: logic
  
  DSI_CLK:
    direction: output
    type: logic[3:0]
  DSI_DATA:
    direction: output
    type: logic[3:0]
  
  LVDS_TX:
    direction: output
    type: logic[7:0]
  
  # Camera Interface
  CSI_CLK:
    direction: input
    type: logic[1:0]
  CSI_DATA:
    direction: input
    type: logic[1:0]
  
  DCMI_DATA:
    direction: input
    type: logic[15:0]
  DCMI_PIXCLK:
    direction: input
    type: logic
  DCMI_HSYNC:
    direction: input
    type: logic
  DCMI_VSYNC:
    direction: input
    type: logic

instance:
  # Processor Cores
  cortex_a35_0:
    module: cortex_a35
    parameter:
      CORE_ID: 0
      FREQUENCY: 1200000000
      CACHE_L1I_SIZE: 32768
      CACHE_L1D_SIZE: 32768
      CACHE_L2_SIZE: 524288
    port:
      CLK:
        link: clk_mpu
      RESET_N:
        link: rst_mpu
      IRQ:
        link: gic_irq
      FIQ:
        link: gic_fiq
  
  cortex_a35_1:
    module: cortex_a35
    parameter:
      CORE_ID: 1
      FREQUENCY: 1200000000
      CACHE_L1I_SIZE: 32768
      CACHE_L1D_SIZE: 32768
      CACHE_L2_SIZE: 524288
    port:
      CLK:
        link: clk_mpu
      RESET_N:
        link: rst_mpu
      IRQ:
        link: gic_irq
      FIQ:
        link: gic_fiq
  
  cortex_m33:
    module: cortex_m33
    parameter:
      FREQUENCY: 400000000
      CACHE_SIZE: 16384
      FPU: true
      MPU: true
      TRUSTZONE: true
    port:
      CLK:
        link: clk_mcu
      RESET_N:
        link: rst_mcu
      IRQ:
        link: nvic_irq
  
  cortex_m0plus:
    module: cortex_m0plus
    parameter:
      FREQUENCY: 200000000
      BACKUP_FREQ: 16000000
    port:
      CLK:
        link: clk_mcu
      RESET_N:
        link: rst_m0
      IRQ:
        link: exti2_irq
  
  # Graphics and AI (Optional)
  gpu_core:
    module: gpu_verisilicon_gc8000ul
    parameter:
      FREQUENCY: 800000000
      API_OPENGL_ES: "3.1"
      API_VULKAN: "1.3"
      API_OPENCL: "3.0"
      API_OPENVX: "1.3"
      PERFORMANCE_MTRIANGLE: 133
      PERFORMANCE_MPIXEL: 800
    port:
      CLK:
        link: clk_gpu
      RESET_N:
        link: rst_gpu
      AXI_MASTER:
        link: gpu_axi
  
  npu_core:
    module: npu_verisilicon
    parameter:
      FREQUENCY: 800000000
      PERFORMANCE_TOPS: 1.2
      API_TENSORFLOW_LITE: true
      API_ONNX: true
      API_LINUX_NN: true
    port:
      CLK:
        link: clk_npu
      RESET_N:
        link: rst_npu
      AXI_MASTER:
        link: npu_axi
  
  # Video Processing (Optional)
  video_encoder:
    module: video_encoder
    parameter:
      FREQUENCY: 600000000
      FORMAT_H264: true
      FORMAT_VP8: true
      MAX_RESOLUTION: "1080p60"
      JPEG_RATE: 500000000
    port:
      CLK:
        link: clk_venc
      RESET_N:
        link: rst_venc
      AXI_MASTER:
        link: venc_axi
      VIDEO_IN:
        link: dcmipp_video
  
  video_decoder:
    module: video_decoder
    parameter:
      FREQUENCY: 600000000
      FORMAT_H264: true
      FORMAT_VP8: true
      MAX_RESOLUTION: "1080p60"
      SHARED_RAM: 131072
    port:
      CLK:
        link: clk_vdec
      RESET_N:
        link: rst_vdec
      AXI_MASTER:
        link: vdec_axi
      VIDEO_OUT:
        link: ltdc_video
  
  # Clock and Reset Controller (RCC) - Enhanced with QSoC Reset Format
  rcc:
    module: rcc
    parameter:
      FREQUENCY: 400000000
      PLL_COUNT: 4
      CLOCK_SOURCE_COUNT: 5
      CSS_ENABLE: true
      CLOCK_SECURITY_SYSTEM: true
      RESET_CONTROLLER_COUNT: 3
      RESET_SOURCE_COUNT: 8
      RESET_TARGET_COUNT: 15
    port:
      CLK:
        link: rcc_clk
      RESET_N:
        link: rcc_rst_n
      # Clock Sources
      CLK_HSE:
        link: clk_hse
      CLK_LSE:
        link: clk_lse
      CLK_HSI:
        link: clk_hsi
      CLK_LSI:
        link: clk_lsi
      CLK_CSI:
        link: clk_csi
      # PLL Outputs
      PLL1_P:
        link: pll1_p
      PLL1_Q:
        link: pll1_q
      PLL1_R:
        link: pll1_r
      PLL2_P:
        link: pll2_p
      PLL2_Q:
        link: pll2_q
      PLL2_R:
        link: pll2_r
      PLL3_P:
        link: pll3_p
      PLL3_Q:
        link: pll3_q
      PLL3_R:
        link: pll3_r
      PLL4_P:
        link: pll4_p
      PLL4_Q:
        link: pll4_q
      PLL4_R:
        link: pll4_r
      # Clock Enable Controls
      CLK_EN_MPU:
        link: clk_en_mpu
      CLK_EN_MCU:
        link: clk_en_mcu
      CLK_EN_AXI:
        link: clk_en_axi
      CLK_EN_AHB:
        link: clk_en_ahb
      CLK_EN_APB:
        link: clk_en_apb
      CLK_EN_GPU:
        link: clk_en_gpu
      CLK_EN_NPU:
        link: clk_en_npu
      CLK_EN_DDR:
        link: clk_en_ddr
      CLK_EN_ETH:
        link: clk_en_eth
      CLK_EN_USB:
        link: clk_en_usb
      CLK_EN_PCIE:
        link: clk_en_pcie
      # Reset Control Interface - Connected to Reset Controllers
      RESET_REQ_POR:
        link: por_rst_n
      RESET_REQ_BOR:
        link: bor_rst_n
      RESET_REQ_NRST:
        link: nrst_n
      RESET_REQ_IWDG:
        link: iwdg_rst_n
      RESET_REQ_WWDG:
        link: wwdg_rst_n
      RESET_REQ_SW:
        link: sw_rst_n
      RESET_REQ_CSS:
        link: css_rst_n
      # Reset Status from Controllers
      RESET_STATUS_CPU:
        link: cpu_rst_n
      RESET_STATUS_MCU:
        link: mcu_rst_n
      RESET_STATUS_M0:
        link: m0_rst_n
      RESET_STATUS_SYS:
        link: sys_rst_n
      RESET_STATUS_MEM:
        link: mem_rst_n
      RESET_STATUS_PERIPH:
        link: periph_rst_n
      # Clock Security System
      CSS_HSE:
        link: css_hse
      CSS_LSE:
        link: css_lse
      CSS_PLL:
        link: css_pll
      CSS_SYS:
        link: css_system
      CSS_HSEF:
        link: css_hse_flag
      CSS_LSEF:
        link: css_lse_flag
      CSS_PLLF:
        link: css_pll_flag
      # Reset Reason Recording
      RESET_REASON:
        link: reset_reason
      RESET_REASON_VALID:
        link: reason_valid
      RESET_REASON_CLEAR:
        link: reason_clear
      RESET_SEQ_DONE:
        link: reset_sequence_done
  
  pwr:
    module: pwr
    parameter:
      FREQUENCY: 400000000
      POWER_DOMAIN_COUNT: 5
      LOW_POWER_MODES: 4
    port:
      CLK:
        link: pwr_clk
      RESET_N:
        link: pwr_rst_n
  
  syscfg:
    module: syscfg
    parameter:
      FREQUENCY: 200000000
      EXTI_COUNT: 128
      BOOT_MODE_COUNT: 8
    port:
      CLK:
        link: syscfg_clk
      RESET_N:
        link: syscfg_rst_n
  
  dbgmcu:
    module: dbgmcu
    parameter:
      FREQUENCY: 200000000
      DEBUG_PORT_COUNT: 3
    port:
      CLK:
        link: dbgmcu_clk
      RESET_N:
        link: dbgmcu_rst_n
  
  flash:
    module: flash
    parameter:
      FREQUENCY: 200000000
      FLASH_SIZE: 4194304
      SECTOR_COUNT: 128
    port:
      CLK:
        link: flash_clk
      RESET_N:
        link: flash_rst_n
  
  temp:
    module: temp
    parameter:
      FREQUENCY: 100000000
      SENSOR_COUNT: 2
    port:
      CLK:
        link: temp_clk
      RESET_N:
        link: temp_rst_n
  
  # GPIO Ports
  gpioa:
    module: gpio
    parameter:
      FREQUENCY: 200000000
      PIN_COUNT: 16
      PORT_ID: 0
    port:
      CLK:
        link: gpio_clk
      RESET_N:
        link: gpio_rst_n
  
  gpiob:
    module: gpio
    parameter:
      FREQUENCY: 200000000
      PIN_COUNT: 16
      PORT_ID: 1
    port:
      CLK:
        link: gpio_clk
      RESET_N:
        link: gpio_rst_n
  
  gpioc:
    module: gpio
    parameter:
      FREQUENCY: 200000000
      PIN_COUNT: 16
      PORT_ID: 2
    port:
      CLK:
        link: gpio_clk
      RESET_N:
        link: gpio_rst_n
  
  gpiod:
    module: gpio
    parameter:
      FREQUENCY: 200000000
      PIN_COUNT: 16
      PORT_ID: 3
    port:
      CLK:
        link: gpio_clk
      RESET_N:
        link: gpio_rst_n
  
  gpioe:
    module: gpio
    parameter:
      FREQUENCY: 200000000
      PIN_COUNT: 16
      PORT_ID: 4
    port:
      CLK:
        link: gpio_clk
      RESET_N:
        link: gpio_rst_n
  
  gpiof:
    module: gpio
    parameter:
      FREQUENCY: 200000000
      PIN_COUNT: 16
      PORT_ID: 5
    port:
      CLK:
        link: gpio_clk
      RESET_N:
        link: gpio_rst_n
  
  gpiog:
    module: gpio
    parameter:
      FREQUENCY: 200000000
      PIN_COUNT: 16
      PORT_ID: 6
    port:
      CLK:
        link: gpio_clk
      RESET_N:
        link: gpio_rst_n
  
  gpioh:
    module: gpio
    parameter:
      FREQUENCY: 200000000
      PIN_COUNT: 16
      PORT_ID: 7
    port:
      CLK:
        link: gpio_clk
      RESET_N:
        link: gpio_rst_n
  
  # External Interrupt Controller
  exti:
    module: exti
    parameter:
      FREQUENCY: 200000000
      LINE_COUNT: 128
      GPIO_PORT_COUNT: 8
    port:
      CLK:
        link: exti_clk
      RESET_N:
        link: exti_rst_n
  
  # I2C Controllers
  i2c1:
    module: i2c
    parameter:
      FREQUENCY: 100000000
      BUS_SPEED: 400000
      ADDRESS_MODE: 7
    port:
      CLK:
        link: i2c_clk
      RESET_N:
        link: i2c_rst_n
  
  i2c2:
    module: i2c
    parameter:
      FREQUENCY: 100000000
      BUS_SPEED: 400000
      ADDRESS_MODE: 7
    port:
      CLK:
        link: i2c_clk
      RESET_N:
        link: i2c_rst_n
  
  i2c3:
    module: i2c
    parameter:
      FREQUENCY: 100000000
      BUS_SPEED: 400000
      ADDRESS_MODE: 7
    port:
      CLK:
        link: i2c_clk
      RESET_N:
        link: i2c_rst_n
  
  i2c4:
    module: i2c
    parameter:
      FREQUENCY: 100000000
      BUS_SPEED: 400000
      ADDRESS_MODE: 7
    port:
      CLK:
        link: i2c_clk
      RESET_N:
        link: i2c_rst_n
  
  i2c5:
    module: i2c
    parameter:
      FREQUENCY: 100000000
      BUS_SPEED: 400000
      ADDRESS_MODE: 7
    port:
      CLK:
        link: i2c_clk
      RESET_N:
        link: i2c_rst_n
  
  # SPI Controllers
  spi1:
    module: spi
    parameter:
      FREQUENCY: 200000000
      MAX_SPEED: 50000000
      DATA_WIDTH: 8
    port:
      CLK:
        link: spi_clk
      RESET_N:
        link: spi_rst_n
  
  spi2:
    module: spi
    parameter:
      FREQUENCY: 200000000
      MAX_SPEED: 50000000
      DATA_WIDTH: 8
    port:
      CLK:
        link: spi_clk
      RESET_N:
        link: spi_rst_n
  
  spi3:
    module: spi
    parameter:
      FREQUENCY: 200000000
      MAX_SPEED: 50000000
      DATA_WIDTH: 8
    port:
      CLK:
        link: spi_clk
      RESET_N:
        link: spi_rst_n
  
  spi4:
    module: spi
    parameter:
      FREQUENCY: 200000000
      MAX_SPEED: 50000000
      DATA_WIDTH: 8
    port:
      CLK:
        link: spi_clk
      RESET_N:
        link: spi_rst_n
  
  spi5:
    module: spi
    parameter:
      FREQUENCY: 200000000
      MAX_SPEED: 50000000
      DATA_WIDTH: 8
    port:
      CLK:
        link: spi_clk
      RESET_N:
        link: spi_rst_n
  
  # USART/UART Controllers
  usart1:
    module: usart
    parameter:
      FREQUENCY: 200000000
      MAX_SPEED: 12500000
      DATA_WIDTH: 8
      FLOW_CONTROL: true
    port:
      CLK:
        link: usart_clk
      RESET_N:
        link: usart_rst_n
  
  usart2:
    module: usart
    parameter:
      FREQUENCY: 200000000
      MAX_SPEED: 12500000
      DATA_WIDTH: 8
      FLOW_CONTROL: true
    port:
      CLK:
        link: usart_clk
      RESET_N:
        link: usart_rst_n
  
  usart3:
    module: usart
    parameter:
      FREQUENCY: 200000000
      MAX_SPEED: 12500000
      DATA_WIDTH: 8
      FLOW_CONTROL: true
    port:
      CLK:
        link: usart_clk
      RESET_N:
        link: usart_rst_n
  
  uart4:
    module: uart
    parameter:
      FREQUENCY: 200000000
      MAX_SPEED: 12500000
      DATA_WIDTH: 8
    port:
      CLK:
        link: uart_clk
      RESET_N:
        link: uart_rst_n
  
  uart5:
    module: uart
    parameter:
      FREQUENCY: 200000000
      MAX_SPEED: 12500000
      DATA_WIDTH: 8
    port:
      CLK:
        link: uart_clk
      RESET_N:
        link: uart_rst_n
  
  usart6:
    module: usart
    parameter:
      FREQUENCY: 200000000
      MAX_SPEED: 12500000
      DATA_WIDTH: 8
      FLOW_CONTROL: true
    port:
      CLK:
        link: usart_clk
      RESET_N:
        link: usart_rst_n
  
  uart7:
    module: uart
    parameter:
      FREQUENCY: 200000000
      MAX_SPEED: 12500000
      DATA_WIDTH: 8
    port:
      CLK:
        link: uart_clk
      RESET_N:
        link: uart_rst_n
  
  uart8:
    module: uart
    parameter:
      FREQUENCY: 200000000
      MAX_SPEED: 12500000
      DATA_WIDTH: 8
    port:
      CLK:
        link: uart_clk
      RESET_N:
        link: uart_rst_n
  
  # Communication Interfaces
  eth:
    module: eth_mac
    parameter:
      FREQUENCY: 250000000
      PHY_COUNT: 2
      SPEED: 1000
    port:
      CLK:
        link: eth_clk
      RESET_N:
        link: eth_rst_n
  
  usb:
    module: usb_ctrl
    parameter:
      FREQUENCY: 600000000
      PORT_COUNT: 1
      SPEED: "USB3.0"
    port:
      CLK:
        link: usb_clk
      RESET_N:
        link: usb_rst_n
  
  sdmmc1:
    module: sdmmc
    parameter:
      FREQUENCY: 200000000
      BUS_WIDTH: 4
      SPEED: 52000000
    port:
      CLK:
        link: sdmmc_clk
      RESET_N:
        link: sdmmc_rst_n
  
  sdmmc2:
    module: sdmmc
    parameter:
      FREQUENCY: 200000000
      BUS_WIDTH: 4
      SPEED: 52000000
    port:
      CLK:
        link: sdmmc_clk
      RESET_N:
        link: sdmmc_rst_n
  
  rtc:
    module: rtc
    parameter:
      FREQUENCY: 32768
      ALARM_COUNT: 2
    port:
      CLK:
        link: clk_rtc
      RESET_N:
        link: rst_rtc
  
  lptim1:
    module: lptim
    parameter:
      FREQUENCY: 32000
      COUNTER_WIDTH: 16
    port:
      CLK:
        link: clk_lptim1
      RESET_N:
        link: rst_lptim1
  
  lptim2:
    module: lptim
    parameter:
      FREQUENCY: 32000
      COUNTER_WIDTH: 16
    port:
      CLK:
        link: clk_lptim2
      RESET_N:
        link: rst_lptim2
  
  # System Status and Health Monitor
  system_status:
    module: system_status
    parameter:
      FREQUENCY: 100000000
      STATUS_VECTOR_WIDTH: 64
    port:
      CLK:
        link: clk_apb
      RESET_N:
        link: rst_sys
  
  health_monitor:
    module: health_monitor
    parameter:
      FREQUENCY: 100000000
      MONITOR_POINT_COUNT: 16
    port:
      CLK:
        link: clk_apb
      RESET_N:
        link: rst_sys
  
  # Clock Sources (Enhanced with Clock Controller Interface)
  osc_hse:
    module: osc_hse
    parameter:
      FREQUENCY: 16000000
      RANGE: "16-48MHz"
      CSS_ENABLE: true
    port:
      OUT:
        link: clk_osc_hse
      READY:
        link: osc_hse_ready
      CSS:
        link: css_hse
      CSSF:
        link: css_hse_flag
  
  osc_lse:
    module: osc_lse
    parameter:
      FREQUENCY: 32768
      CSS_ENABLE: true
    port:
      OUT:
        link: clk_osc_lse
      READY:
        link: osc_lse_ready
      CSS:
        link: css_lse
      CSSF:
        link: css_lse_flag
  
  osc_hsi:
    module: osc_hsi
    parameter:
      FREQUENCY: 64000000
      TRIM_ENABLE: true
    port:
      OUT:
        link: clk_osc_hsi
      READY:
        link: osc_hsi_ready
      TRIM:
        link: hsi_trim
  
  osc_lsi:
    module: osc_lsi
    parameter:
      FREQUENCY: 32000
    port:
      OUT:
        link: clk_osc_lsi
      READY:
        link: osc_lsi_ready
  
  osc_csi:
    module: osc_csi
    parameter:
      FREQUENCY: 4000000
    port:
      OUT:
        link: clk_osc_csi
      READY:
        link: osc_csi_ready
  
  # Enhanced Clock Divider with Clock Controller Interface
  clk_divider:
    module: clock_divider
    parameter:
      INPUT_COUNT: 13
      OUTPUT_COUNT: 20
      PROGRAMMABLE: true
    port:
      # PLL Inputs from Clock Controller
      PLL1_P:
        link: pll1_p
      PLL1_Q:
        link: pll1_q
      PLL1_R:
        link: pll1_r
      PLL2_P:
        link: pll2_p
      PLL2_Q:
        link: pll2_q
      PLL2_R:
        link: pll2_r
      PLL3_P:
        link: pll3_p
      PLL3_Q:
        link: pll3_q
      PLL3_R:
        link: pll3_r
      PLL4_P:
        link: pll4_p
      PLL4_Q:
        link: pll4_q
      PLL4_R:
        link: pll4_r
      # Oscillator Inputs
      CLK_HSI:
        link: clk_osc_hsi
      CLK_CSI:
        link: clk_osc_csi
      CLK_LSI:
        link: clk_osc_lsi
      # Clock Outputs to Subsystems
      CLK_MPU:
        link: clk_mpu
      CLK_MCU:
        link: clk_mcu
      CLK_AXI:
        link: clk_axi
      CLK_AHB:
        link: clk_ahb
      CLK_APB:
        link: clk_apb
      CLK_GPU:
        link: clk_gpu
      CLK_NPU:
        link: clk_npu
      CLK_DDR:
        link: clk_ddr
      CLK_ETH:
        link: clk_eth
      CLK_USB:
        link: clk_usb
      CLK_PCIE:
        link: clk_pcie
      CLK_VENC:
        link: clk_venc
      CLK_VDEC:
        link: clk_vdec
      CLK_SYSTICK:
        link: clk_systick
      CLK_RTC:
        link: clk_rtc
      CLK_LPTIM1:
        link: clk_lptim1
      CLK_LPTIM2:
        link: clk_lptim2
      CLK_TIM1:
        link: clk_tim1
      CLK_TIM2:
        link: clk_tim2
      CLK_TIM3:
        link: clk_tim3
      CLK_TIM4:
        link: clk_tim4
      CLK_HRTIM:
        link: clk_hrtim
  
  # Reset Controllers - Following QSoC Reset Format Specification
  reset:
    # Main System Reset Controller
    - name: main_reset_ctrl
      test_enable: test_en
      source:
        por_rst_n:
          active: low
          description: "Power-on reset (root reset)"
        nrst_n:
          active: low
          description: "External reset pin"
        bor_rst_n:
          active: low
          description: "Brown-out reset"
        iwdg_rst_n:
          active: low
          description: "Independent watchdog reset"
        wwdg_rst_n:
          active: low
          description: "Window watchdog reset"
        sw_rst_n:
          active: low
          description: "Software reset from RCC"
        css_rst_n:
          active: low
          description: "Clock security system reset"
      target:
        # CPU Domain Resets
        cpu_rst_n:
          active: low
          description: "Cortex-A35 cluster reset"
          link:
            por_rst_n:
              async:
                clock: clk_mpu
                stage: 4
            nrst_n:
              async:
                clock: clk_mpu
                stage: 4
            sw_rst_n:
              async:
                clock: clk_mpu
                stage: 2
        mcu_rst_n:
          active: low
          description: "Cortex-M33 subsystem reset"
          link:
            por_rst_n:
              async:
                clock: clk_mcu
                stage: 4
            nrst_n:
              async:
                clock: clk_mcu
                stage: 4
            sw_rst_n:
              async:
                clock: clk_mcu
                stage: 2
        m0_rst_n:
          active: low
          description: "Cortex-M0+ SmartRun domain reset"
          link:
            por_rst_n:
              async:
                clock: clk_m0plus
                stage: 4
            sw_rst_n:
              async:
                clock: clk_m0plus
                stage: 2
        # System Infrastructure Resets
        sys_rst_n:
          active: low
          description: "System infrastructure reset"
          link:
            por_rst_n:
              direct: ~
            bor_rst_n:
              direct: ~
            css_rst_n:
              direct: ~
        # Peripheral Domain Resets
        periph_rst_n:
          active: low
          description: "Peripheral domain reset"
          link:
            por_rst_n:
              async:
                clock: clk_apb
                stage: 2
            nrst_n:
              async:
                clock: clk_apb
                stage: 2
            sw_rst_n:
              async:
                clock: clk_apb
                stage: 2
        # Memory Domain Resets
        mem_rst_n:
          active: low
          description: "Memory subsystem reset"
          link:
            por_rst_n:
              async:
                clock: clk_axi
                stage: 3
            sw_rst_n:
              async:
                clock: clk_axi
                stage: 2
      reason:
        clock: clk_lse
        output: reset_reason
        valid: reason_valid
        clear: reason_clear
        root_reset: por_rst_n
    
    # Application Reset Controller
    - name: app_reset_ctrl
      test_enable: test_en
      source:
        app_rst_n:
          active: low
          description: "Application reset (from main controller)"
        wwdg_app_rst_n:
          active: low
          description: "Window watchdog application reset"
        sw_app_rst_n:
          active: low
          description: "Software application reset"
      target:
        app_cpu_rst_n:
          active: low
          description: "Application CPU reset"
          link:
            app_rst_n:
              async:
                clock: clk_mpu
                stage: 3
            wwdg_app_rst_n:
              async:
                clock: clk_mpu
                stage: 2
        app_periph_rst_n:
          active: low
          description: "Application peripheral reset"
          link:
            app_rst_n:
              async:
                clock: clk_apb
                stage: 2
            sw_app_rst_n:
              async:
                clock: clk_apb
                stage: 2
    
    # Debug Reset Controller
    - name: dbg_reset_ctrl
      test_enable: test_en
      source:
        dbg_rst_n:
          active: low
          description: "Debug reset"
        cpu_halt_rst_n:
          active: low
          description: "CPU halt reset"
      target:
        dbg_cpu_rst_n:
          active: low
          description: "Debug CPU reset"
          link:
            dbg_rst_n:
              async:
                clock: clk_mpu
                stage: 2
        dbg_mcu_rst_n:
          active: low
          description: "Debug MCU reset"
          link:
            dbg_rst_n:
              async:
                clock: clk_mcu
                stage: 2

  # Reset Source Modules (for signal generation)
  por:
    module: power_on_reset
    parameter:
      DELAY: 100
      VOLTAGE_THRESHOLD: 1800
    port:
      OUT:
        link: por_rst_n
  
  bor:
    module: brown_out_reset
    parameter:
      THRESHOLD: 2700
      HYSTERESIS: 100
    port:
      OUT:
        link: bor_rst_n
  
  reset_pin:
    module: reset_input
    parameter:
      POLARITY: "low"
      DEBOUNCE: 1000
    port:
      IN:
        link: NRST
      OUT:
        link: nrst_n
  
  iwdg:
    module: independent_watchdog
    parameter:
      TIMEOUT: 1000
      CLOCK_SOURCE: lsi
    port:
      RST_OUT:
        link: iwdg_rst_n
  
  wwdg:
    module: window_watchdog
    parameter:
      TIMEOUT: 100
      CLOCK_SOURCE: apb
    port:
      RST_OUT:
        link: wwdg_rst_n
  
  # Reset Distributor
  rst_distributor:
    module: reset_distributor
    port:
      IN:
        link: rst_sys
      RST_GPU:
        link: rst_gpu
      RST_NPU:
        link: rst_npu
      RST_VDEC:
        link: rst_vdec
      RST_VENC:
        link: rst_venc
      RST_DDR:
        link: rst_ddr
      RST_ETH:
        link: rst_eth
      RST_USB:
        link: rst_usb
      RST_PCIE:
        link: rst_pcie
      RST_GPIO:
        link: rst_gpio
      RST_DMA:
        link: rst_dma
      RST_ADC:
        link: rst_adc
      RST_DAC:
        link: rst_dac
      RST_TIMER:
        link: rst_timer
  
  # DDR Controller
  ddr_ctrl:
    module: ddr_controller
    parameter:
      FREQUENCY: 400000000
      DATA_WIDTH: 32
      ADDR_WIDTH: 16
    port:
      CLK:
        link: clk_ddr
      RESET_N:
        link: rst_ddr
      DDR_CLK:
        uplink: DDR_CLK
      DDR_ADDR:
        uplink: DDR_ADDR
      DDR_DATA:
        uplink: DDR_DATA
      DDR_CTRL:
        uplink: DDR_CTRL
  
  # Ethernet MAC
  eth_mac:
    module: ethernet_mac
    parameter:
      FREQUENCY: 250000000
      SPEED: 1000
      PHY_COUNT: 2
    port:
      CLK:
        link: clk_eth
      RESET_N:
        link: rst_eth
      ETH1_RGMII:
        uplink: ETH1_RGMII
      ETH2_RGMII:
        uplink: ETH2_RGMII
      ETHSW_RGMII:
        uplink: ETHSW_RGMII
  
  # USB Controller
  usb_ctrl:
    module: usb_controller
    parameter:
      FREQUENCY: 600000000
      SPEED: "USB3.0"
      PORT_COUNT: 1
    port:
      CLK:
        link: clk_usb
      RESET_N:
        link: rst_usb
      USBH_DP:
        uplink: USBH_DP
      USBH_DM:
        uplink: USBH_DM
      USB3DR_SSTX:
        uplink: USB3DR_SSTX
      USB3DR_SSRX:
        uplink: USB3DR_SSRX
      USB3DR_DP:
        uplink: USB3DR_DP
      USB3DR_DM:
        uplink: USB3DR_DM
  
  # PCIe Controller
  pcie_ctrl:
    module: pcie_controller
    parameter:
      FREQUENCY: 500000000
      LANE_COUNT: 4
    port:
      CLK:
        link: clk_pcie
      RESET_N:
        link: rst_pcie
      PCIE_TX:
        uplink: PCIE_TX
      PCIE_RX:
        uplink: PCIE_RX
  
  # QSPI Controller
  qspi:
    module: qspi_controller
    parameter:
      FREQUENCY: 200000000
      MAX_SPEED: 133000000
    port:
      CLK:
        link: clk_qspi
      RESET_N:
        link: rst_qspi
  
  # FDCAN Controllers
  fdcan1:
    module: fdcan_controller
    parameter:
      FREQUENCY: 200000000
      MAX_SPEED: 1000000
    port:
      CLK:
        link: clk_can
      RESET_N:
        link: rst_can
  
  fdcan2:
    module: fdcan_controller
    parameter:
      FREQUENCY: 200000000
      MAX_SPEED: 1000000
    port:
      CLK:
        link: clk_can
      RESET_N:
        link: rst_can
  
  # ADC Controllers
  adc1:
    module: adc_controller
    parameter:
      FREQUENCY: 200000000
      RESOLUTION: 12
      CHANNEL_COUNT: 16
    port:
      CLK:
        link: clk_adc
      RESET_N:
        link: rst_adc
  
  adc2:
    module: adc_controller
    parameter:
      FREQUENCY: 200000000
      RESOLUTION: 12
      CHANNEL_COUNT: 16
    port:
      CLK:
        link: clk_adc
      RESET_N:
        link: rst_adc
  
  # DAC Controller
  dac:
    module: dac_controller
    parameter:
      FREQUENCY: 200000000
      RESOLUTION: 12
      CHANNEL_COUNT: 2
    port:
      CLK:
        link: clk_dac
      RESET_N:
        link: rst_dac
  
  # Timer Controllers
  tim1:
    module: timer_controller
    parameter:
      FREQUENCY: 200000000
      BIT_WIDTH: 16
    port:
      CLK:
        link: clk_timer
      RESET_N:
        link: rst_timer
  
  tim2:
    module: timer_controller
    parameter:
      FREQUENCY: 200000000
      BIT_WIDTH: 16
    port:
      CLK:
        link: clk_timer
      RESET_N:
        link: rst_timer
  
  tim3:
    module: timer_controller
    parameter:
      FREQUENCY: 200000000
      BIT_WIDTH: 16
    port:
      CLK:
        link: clk_timer
      RESET_N:
        link: rst_timer
  
  tim4:
    module: timer_controller
    parameter:
      FREQUENCY: 200000000
      BIT_WIDTH: 16
    port:
      CLK:
        link: clk_timer
      RESET_N:
        link: rst_timer
  
  tim5:
    module: timer_controller
    parameter:
      FREQUENCY: 200000000
      BIT_WIDTH: 16
    port:
      CLK:
        link: clk_timer
      RESET_N:
        link: rst_timer
  
  tim6:
    module: timer_controller
    parameter:
      FREQUENCY: 200000000
      BIT_WIDTH: 16
    port:
      CLK:
        link: clk_timer
      RESET_N:
        link: rst_timer
  
  tim7:
    module: timer_controller
    parameter:
      FREQUENCY: 200000000
      BIT_WIDTH: 16
    port:
      CLK:
        link: clk_timer
      RESET_N:
        link: rst_timer
  
  tim8:
    module: timer_controller
    parameter:
      FREQUENCY: 200000000
      BIT_WIDTH: 16
    port:
      CLK:
        link: clk_timer
      RESET_N:
        link: rst_timer
  
  tim12:
    module: timer_controller
    parameter:
      FREQUENCY: 200000000
      BIT_WIDTH: 16
    port:
      CLK:
        link: clk_timer
      RESET_N:
        link: rst_timer
  
  tim13:
    module: timer_controller
    parameter:
      FREQUENCY: 200000000
      BIT_WIDTH: 16
    port:
      CLK:
        link: clk_timer
      RESET_N:
        link: rst_timer
  
  tim14:
    module: timer_controller
    parameter:
      FREQUENCY: 200000000
      BIT_WIDTH: 16
    port:
      CLK:
        link: clk_timer
      RESET_N:
        link: rst_timer
  
  tim15:
    module: timer_controller
    parameter:
      FREQUENCY: 200000000
      BIT_WIDTH: 16
    port:
      CLK:
        link: clk_timer
      RESET_N:
        link: rst_timer
  
  tim16:
    module: timer_controller
    parameter:
      FREQUENCY: 200000000
      BIT_WIDTH: 16
    port:
      CLK:
        link: clk_timer
      RESET_N:
        link: rst_timer
  
  tim17:
    module: timer_controller
    parameter:
      FREQUENCY: 200000000
      BIT_WIDTH: 16
    port:
      CLK:
        link: clk_timer
      RESET_N:
        link: rst_timer
  
  # Bus Interconnects
  axi_interconnect:
    module: axi_interconnect
    parameter:
      MASTER_COUNT: 8
      SLAVE_COUNT: 16
      DATA_WIDTH: 64
      ADDR_WIDTH: 32
    port:
      CLK:
        link: clk_axi
      RESET_N:
        link: rst_sys
  
  ahb_interconnect:
    module: ahb_interconnect
    parameter:
      MASTER_COUNT: 4
      SLAVE_COUNT: 8
      DATA_WIDTH: 32
      ADDR_WIDTH: 32
    port:
      CLK:
        link: clk_ahb
      RESET_N:
        link: rst_sys
  
  apb_interconnect:
    module: apb_interconnect
    parameter:
      MASTER_COUNT: 2
      SLAVE_COUNT: 32
      DATA_WIDTH: 32
      ADDR_WIDTH: 32
    port:
      CLK:
        link: clk_apb
      RESET_N:
        link: rst_sys

# Part 2: Clock and Reset Management
net:
  # Clock distribution network (Updated with Clock Controller)
  clk_osc_hse:
    - instance: osc_hse
      port: OUT
    - instance: rcc
      port: CLK_HSE
  clk_osc_lse:
    - instance: osc_lse
      port: OUT
    - instance: rcc
      port: CLK_LSE
  clk_osc_hsi:
    - instance: osc_hsi
      port: OUT
    - instance: rcc
      port: CLK_HSI
  clk_osc_lsi:
    - instance: osc_lsi
      port: OUT
    - instance: rcc
      port: CLK_LSI
  clk_osc_csi:
    - instance: osc_csi
      port: OUT
    - instance: rcc
      port: CLK_CSI
      
  # PLL Connections to Clock Controller
  pll1_p:
    - instance: pll1
      port: P_OUT
    - instance: rcc
      port: PLL1_P
  pll1_q:
    - instance: pll1
      port: Q_OUT
    - instance: rcc
      port: PLL1_Q
  pll1_r:
    - instance: pll1
      port: R_OUT
    - instance: rcc
      port: PLL1_R
  pll2_p:
    - instance: pll2
      port: P_OUT
    - instance: rcc
      port: PLL2_P
  pll2_q:
    - instance: pll2
      port: Q_OUT
    - instance: rcc
      port: PLL2_Q
  pll2_r:
    - instance: pll2
      port: R_OUT
    - instance: rcc
      port: PLL2_R
  pll3_p:
    - instance: pll3
      port: P_OUT
    - instance: rcc
      port: PLL3_P
  pll3_q:
    - instance: pll3
      port: Q_OUT
    - instance: rcc
      port: PLL3_Q
  pll3_r:
    - instance: pll3
      port: R_OUT
    - instance: rcc
      port: PLL3_R
  pll4_p:
    - instance: pll4
      port: P_OUT
    - instance: rcc
      port: PLL4_P
  pll4_q:
    - instance: pll4
      port: Q_OUT
    - instance: rcc
      port: PLL4_Q
  pll4_r:
    - instance: pll4
      port: R_OUT
    - instance: rcc
      port: PLL4_R
  
  # PLL outputs
  pll1_p:
    - instance: rcc
      port: PLL1_P
    - instance: clk_divider
      port: PLL1_P
  pll1_q:
    - instance: rcc
      port: PLL1_Q
    - instance: clk_divider
      port: PLL1_Q
  pll1_r:
    - instance: rcc
      port: PLL1_R
    - instance: clk_divider
      port: PLL1_R
  pll2_p:
    - instance: rcc
      port: PLL2_P
    - instance: clk_divider
      port: PLL2_P
  pll2_q:
    - instance: rcc
      port: PLL2_Q
    - instance: clk_divider
      port: PLL2_Q
  pll2_r:
    - instance: rcc
      port: PLL2_R
    - instance: clk_divider
      port: PLL2_R
  pll3_p:
    - instance: rcc
      port: PLL3_P
    - instance: clk_divider
      port: PLL3_P
  pll3_q:
    - instance: rcc
      port: PLL3_Q
    - instance: clk_divider
      port: PLL3_Q
  pll3_r:
    - instance: rcc
      port: PLL3_R
    - instance: clk_divider
      port: PLL3_R
  pll4_p:
    - instance: rcc
      port: PLL4_P
    - instance: clk_divider
      port: PLL4_P
  pll4_q:
    - instance: rcc
      port: PLL4_Q
    - instance: clk_divider
      port: PLL4_Q
  pll4_r:
    - instance: rcc
      port: PLL4_R
    - instance: clk_divider
      port: PLL4_R
  
  # Core clocks
  clk_mpu:
    - instance: clk_divider
      port: CLK_MPU
    - instance: cortex_a35_0
      port: CLK
    - instance: cortex_a35_1
      port: CLK
  clk_mcu:
    - instance: clk_divider
      port: CLK_MCU
    - instance: cortex_m33
      port: CLK
  clk_m0plus:
    - instance: clk_divider
      port: CLK_M0PLUS
    - instance: cortex_m0plus
      port: CLK
  clk_axi:
    - instance: clk_divider
      port: CLK_AXI
    - instance: axi_interconnect
      port: CLK
  clk_ahb:
    - instance: clk_divider
      port: CLK_AHB
    - instance: ahb_interconnect
      port: CLK
  clk_apb:
    - instance: clk_divider
      port: CLK_APB
    - instance: apb_interconnect
      port: CLK
  
  # Peripheral clocks
  clk_gpu:
    - instance: clk_divider
      port: CLK_GPU
    - instance: gpu_core
      port: CLK
  clk_npu:
    - instance: clk_divider
      port: CLK_NPU
    - instance: npu_core
      port: CLK
  clk_vdec:
    - instance: clk_divider
      port: CLK_VDEC
    - instance: video_decoder
      port: CLK
  clk_venc:
    - instance: clk_divider
      port: CLK_VENC
    - instance: video_encoder
      port: CLK
  clk_ddr:
    - instance: clk_divider
      port: CLK_DDR
    - instance: ddr_ctrl
      port: CLK
  clk_eth:
    - instance: clk_divider
      port: CLK_ETH
    - instance: eth_mac
      port: CLK
  clk_usb:
    - instance: clk_divider
      port: CLK_USB
    - instance: usb_ctrl
      port: CLK
  clk_pcie:
    - instance: clk_divider
      port: CLK_PCIE
    - instance: pcie_ctrl
      port: CLK
  clk_sdmmc:
    - instance: clk_divider
      port: CLK_SDMMC
    - instance: sdmmc1
      port: CLK
    - instance: sdmmc2
      port: CLK
  clk_qspi:
    - instance: clk_divider
      port: CLK_QSPI
    - instance: qspi
      port: CLK
  clk_i2c:
    - instance: clk_divider
      port: CLK_I2C
    - instance: i2c1
      port: CLK
    - instance: i2c2
      port: CLK
    - instance: i2c3
      port: CLK
    - instance: i2c4
      port: CLK
    - instance: i2c5
      port: CLK
  clk_spi:
    - instance: clk_divider
      port: CLK_SPI
    - instance: spi1
      port: CLK
    - instance: spi2
      port: CLK
    - instance: spi3
      port: CLK
    - instance: spi4
      port: CLK
    - instance: spi5
      port: CLK
  clk_usart:
    - instance: clk_divider
      port: CLK_USART
    - instance: usart1
      port: CLK
    - instance: usart2
      port: CLK
    - instance: usart3
      port: CLK
    - instance: uart4
      port: CLK
    - instance: uart5
      port: CLK
    - instance: usart6
      port: CLK
    - instance: uart7
      port: CLK
    - instance: uart8
      port: CLK
  clk_can:
    - instance: clk_divider
      port: CLK_CAN
    - instance: fdcan1
      port: CLK
    - instance: fdcan2
      port: CLK
  clk_adc:
    - instance: clk_divider
      port: CLK_ADC
    - instance: adc1
      port: CLK
    - instance: adc2
      port: CLK
  clk_dac:
    - instance: clk_divider
      port: CLK_DAC
    - instance: dac
      port: CLK
  clk_timer:
    - instance: clk_divider
      port: CLK_TIMER
    - instance: tim1
      port: CLK
    - instance: tim2
      port: CLK
    - instance: tim3
      port: CLK
    - instance: tim4
      port: CLK
    - instance: tim5
      port: CLK
    - instance: tim6
      port: CLK
    - instance: tim7
      port: CLK
    - instance: tim8
      port: CLK
    - instance: tim12
      port: CLK
    - instance: tim13
      port: CLK
    - instance: tim14
      port: CLK
    - instance: tim15
      port: CLK
    - instance: tim16
      port: CLK
    - instance: tim17
      port: CLK
  
  # Reset Signal Distribution - Using Standardized Reset Controller Outputs
  # CPU Domain Resets
  rst_mpu:
    - instance: reset.main_reset_ctrl
      port: cpu_rst_n
    - instance: cortex_a35_0
      port: RESET_N
    - instance: cortex_a35_1
      port: RESET_N
  rst_mcu:
    - instance: reset.main_reset_ctrl
      port: mcu_rst_n
    - instance: cortex_m33
      port: RESET_N
  rst_m0:
    - instance: reset.main_reset_ctrl
      port: m0_rst_n
    - instance: cortex_m0plus
      port: RESET_N
  
  # System Infrastructure Resets
  rst_sys:
    - instance: reset.main_reset_ctrl
      port: sys_rst_n
    - instance: rst_distributor
      port: IN
    - instance: axi_interconnect
      port: RESET_N
    - instance: ahb_interconnect
      port: RESET_N
    - instance: apb_interconnect
      port: RESET_N
  
  # Memory Domain Resets
  rst_ddr:
    - instance: reset.main_reset_ctrl
      port: mem_rst_n
    - instance: ddr_ctrl
      port: RESET_N
  
  # Peripheral Domain Resets
  rst_periph:
    - instance: reset.main_reset_ctrl
      port: periph_rst_n
    - instance: gpioa
      port: RESET_N
    - instance: gpiob
      port: RESET_N
    - instance: gpioc
      port: RESET_N
    - instance: gpiod
      port: RESET_N
    - instance: gpioe
      port: RESET_N
    - instance: gpiof
      port: RESET_N
    - instance: gpiog
      port: RESET_N
    - instance: gpioh
      port: RESET_N
  
  # Peripheral resets
  rst_gpu:
    - instance: rst_distributor
      port: RST_GPU
    - instance: gpu_core
      port: RESET_N
  rst_npu:
    - instance: rst_distributor
      port: RST_NPU
    - instance: npu_core
      port: RESET_N
  rst_vdec:
    - instance: rst_distributor
      port: RST_VDEC
    - instance: video_decoder
      port: RESET_N
  rst_venc:
    - instance: rst_distributor
      port: RST_VENC
    - instance: video_encoder
      port: RESET_N
  rst_eth:
    - instance: rst_distributor
      port: RST_ETH
    - instance: eth_mac
      port: RESET_N
  rst_usb:
    - instance: rst_distributor
      port: RST_USB
    - instance: usb_ctrl
      port: RESET_N
  rst_pcie:
    - instance: rst_distributor
      port: RST_PCIE
    - instance: pcie_ctrl
      port: RESET_N
  rst_gpio:
    - instance: rst_distributor
      port: RST_GPIO
    - instance: gpioa
      port: RESET_N
    - instance: gpiob
      port: RESET_N
    - instance: gpioc
      port: RESET_N
    - instance: gpiod
      port: RESET_N
    - instance: gpioe
      port: RESET_N
    - instance: gpiof
      port: RESET_N
    - instance: gpiog
      port: RESET_N
    - instance: gpioh
      port: RESET_N
  rst_adc:
    - instance: rst_distributor
      port: RST_ADC
    - instance: adc1
      port: RESET_N
    - instance: adc2
      port: RESET_N
  rst_dac:
    - instance: rst_distributor
      port: RST_DAC
    - instance: dac
      port: RESET_N
  rst_timer:
    - instance: rst_distributor
      port: RST_TIMER
    - instance: tim1
      port: RESET_N
    - instance: tim2
      port: RESET_N
    - instance: tim3
      port: RESET_N
    - instance: tim4
      port: RESET_N
    - instance: tim5
      port: RESET_N
    - instance: tim6
      port: RESET_N
    - instance: tim7
      port: RESET_N
    - instance: tim8
      port: RESET_N
    - instance: tim12
      port: RESET_N
    - instance: tim13
      port: RESET_N
    - instance: tim14
      port: RESET_N
    - instance: tim15
      port: RESET_N
    - instance: tim16
      port: RESET_N
    - instance: tim17
      port: RESET_N

  # SDMMC Resets
  rst_sdmmc1:
    - instance: rst_distributor
      port: RST_SDMMC
    - instance: sdmmc1
      port: RESET_N
  rst_sdmmc2:
    - instance: rst_distributor
      port: RST_SDMMC
    - instance: sdmmc2
      port: RESET_N
  
  # LPTIM and RTC Resets
  rst_lptim1:
    - instance: reset.main_reset_ctrl
      port: lptim_rst_n
    - instance: lptim1
      port: RESET_N
  rst_lptim2:
    - instance: reset.main_reset_ctrl
      port: lptim_rst_n
    - instance: lptim2
      port: RESET_N
  rst_rtc:
    - instance: reset.main_reset_ctrl
      port: rtc_rst_n
    - instance: rtc
      port: RESET_N
  
  # Clock enable signals
  clk_en_mpu:
    - instance: rcc
      port: clk_en_mpu
    - instance: clock_gate_mpu
      port: en
  clk_en_mcu:
    - instance: rcc
      port: clk_en_mcu
    - instance: clock_gate_mcu
      port: en
  clk_en_gpu:
    - instance: rcc
      port: clk_en_gpu
    - instance: clock_gate_gpu
      port: en
  clk_en_npu:
    - instance: rcc
      port: clk_en_npu
    - instance: clock_gate_npu
      port: en
  clk_en_ddr:
    - instance: rcc
      port: clk_en_ddr
    - instance: clock_gate_ddr
      port: en
  clk_en_eth:
    - instance: rcc
      port: clk_en_eth
    - instance: clock_gate_eth
      port: en
  clk_en_usb:
    - instance: rcc
      port: clk_en_usb
    - instance: clock_gate_usb
      port: en
  clk_en_pcie:
    - instance: rcc
      port: clk_en_pcie
    - instance: clock_gate_pcie
      port: en
  
  # Gated clocks
  clk_mpu_gated:
    - instance: clock_gate_mpu
      port: out
    - instance: cortex_a35_0
      port: clk_gated
    - instance: cortex_a35_1
      port: clk_gated
  clk_mcu_gated:
    - instance: clock_gate_mcu
      port: out
    - instance: cortex_m33
      port: clk_gated
  clk_gpu_gated:
    - instance: clock_gate_gpu
      port: out
    - instance: gpu_core
      port: clk_gated
  clk_npu_gated:
    - instance: clock_gate_npu
      port: out
    - instance: npu_core
      port: clk_gated
  clk_ddr_gated:
    - instance: clock_gate_ddr
      port: out
    - instance: ddr_ctrl
      port: clk_gated
  clk_eth_gated:
    - instance: clock_gate_eth
      port: out
    - instance: eth_mac
      port: clk_gated
  clk_usb_gated:
    - instance: clock_gate_usb
      port: out
    - instance: usb_ctrl
      port: clk_gated
  clk_pcie_gated:
    - instance: clock_gate_pcie
      port: out
    - instance: pcie_ctrl
      port: clk_gated

comb:
  # Clock Status and Security
  clk_ready: { bits: 1, expr: "osc_hse_ready & osc_lse_ready & osc_hsi_ready & osc_lsi_ready & osc_csi_ready" }
  osc_hse_ready: { bits: 1, expr: "osc_hse.stable" }
  osc_lse_ready: { bits: 1, expr: "osc_lse.stable" }
  osc_hsi_ready: { bits: 1, expr: "osc_hsi.stable" }
  osc_lsi_ready: { bits: 1, expr: "osc_lsi.stable" }
  osc_csi_ready: { bits: 1, expr: "osc_csi.stable" }

  # PLL Lock Status
  pll1_lock: { bits: 1, expr: "rcc.pll1_lock" }
  pll2_lock: { bits: 1, expr: "rcc.pll2_lock" }
  pll3_lock: { bits: 1, expr: "rcc.pll3_lock" }
  pll4_lock: { bits: 1, expr: "rcc.pll4_lock" }
  pll_all_locked: { bits: 1, expr: "pll1_lock & pll2_lock & pll3_lock & pll4_lock" }

  # Clock Security System Status
  css_hse_ok: { bits: 1, expr: "!css_hse_flag" }
  css_lse_ok: { bits: 1, expr: "!css_lse_flag" }
  css_pll_ok: { bits: 1, expr: "!css_pll_flag" }
  css_system_ok: { bits: 1, expr: "css_hse_ok & css_lse_ok & css_pll_ok" }

  # System Clock Ready
  sysclk_ready: { bits: 1, expr: "clk_ready & pll_all_locked & css_system_ok" }
  
  # Reset synchronization
  rst_sync: { bits: 1, expr: "rst_por || rst_bor || rst_pin || rst_iwdg || rst_wwdg" }
  rst_peripheral: { bits: 1, expr: "rst_sys || rst_mpu || rst_mcu" }
  
  # Clock Status Flags (Updated naming)
  clk_status_hse: { expr: "osc_hse_ready & css_hse_ok" }
  clk_status_hsi: { expr: "osc_hsi_ready" }
  clk_status_pll: { expr: "pll_all_locked & css_pll_ok" }
  clk_status_lse: { expr: "osc_lse_ready & css_lse_ok" }
  clk_status_lsi: { expr: "osc_lsi_ready" }
  clk_status_csi: { expr: "osc_csi_ready" }


# Part 2: Memory System
  # DDR Memory Interface
  ddr_addr:
    - instance: ddr_ctrl
      port: addr
    - instance: ddr_phy
      port: addr
  ddr_data:
    - instance: ddr_ctrl
      port: data
    - instance: ddr_phy
      port: data
  ddr_dqm:
    - instance: ddr_ctrl
      port: dqm
    - instance: ddr_phy
      port: dqm
  ddr_cs:
    - instance: ddr_ctrl
      port: cs
    - instance: ddr_phy
      port: cs
  ddr_ras:
    - instance: ddr_ctrl
      port: ras
    - instance: ddr_phy
      port: ras
  ddr_cas:
    - instance: ddr_ctrl
      port: cas
    - instance: ddr_phy
      port: cas
  ddr_we:
    - instance: ddr_ctrl
      port: we
    - instance: ddr_phy
      port: we
  ddr_clk_p:
    - instance: ddr_ctrl
      port: clk_p
    - instance: ddr_phy
      port: clk_p
  ddr_clk_n:
    - instance: ddr_ctrl
      port: clk_n
    - instance: ddr_phy
      port: clk_n
  ddr_cke:
    - instance: ddr_ctrl
      port: cke
    - instance: ddr_phy
      port: cke
  ddr_odt:
    - instance: ddr_ctrl
      port: odt
    - instance: ddr_phy
      port: odt
  ddr_reset:
    - instance: ddr_ctrl
      port: reset
    - instance: ddr_phy
      port: reset
  ddr_alert:
    - instance: ddr_phy
      port: alert
    - instance: ddr_ctrl
      port: alert
  
  # DDR Controller AXI Ports
  ddr_axi_awaddr:
    - instance: axi_interconnect
      port: m_ddr_awaddr
    - instance: ddr_ctrl
      port: awaddr
  ddr_axi_awvalid:
    - instance: axi_interconnect
      port: m_ddr_awvalid
    - instance: ddr_ctrl
      port: awvalid
  ddr_axi_awready:
    - instance: ddr_ctrl
      port: awready
    - instance: axi_interconnect
      port: m_ddr_awready
  ddr_axi_wdata:
    - instance: axi_interconnect
      port: m_ddr_wdata
    - instance: ddr_ctrl
      port: wdata
  ddr_axi_wstrb:
    - instance: axi_interconnect
      port: m_ddr_wstrb
    - instance: ddr_ctrl
      port: wstrb
  ddr_axi_wvalid:
    - instance: axi_interconnect
      port: m_ddr_wvalid
    - instance: ddr_ctrl
      port: wvalid
  ddr_axi_wready:
    - instance: ddr_ctrl
      port: wready
    - instance: axi_interconnect
      port: m_ddr_wready
  ddr_axi_bresp:
    - instance: ddr_ctrl
      port: bresp
    - instance: axi_interconnect
      port: m_ddr_bresp
  ddr_axi_bvalid:
    - instance: ddr_ctrl
      port: bvalid
    - instance: axi_interconnect
      port: m_ddr_bvalid
  ddr_axi_bready:
    - instance: axi_interconnect
      port: m_ddr_bready
    - instance: ddr_ctrl
      port: bready
  ddr_axi_araddr:
    - instance: axi_interconnect
      port: m_ddr_araddr
    - instance: ddr_ctrl
      port: araddr
  ddr_axi_arvalid:
    - instance: axi_interconnect
      port: m_ddr_arvalid
    - instance: ddr_ctrl
      port: arvalid
  ddr_axi_arready:
    - instance: ddr_ctrl
      port: arready
    - instance: axi_interconnect
      port: m_ddr_arready
  ddr_axi_rdata:
    - instance: ddr_ctrl
      port: rdata
    - instance: axi_interconnect
      port: m_ddr_rdata
  ddr_axi_rresp:
    - instance: ddr_ctrl
      port: rresp
    - instance: axi_interconnect
      port: m_ddr_rresp
  ddr_axi_rvalid:
    - instance: ddr_ctrl
      port: rvalid
    - instance: axi_interconnect
      port: m_ddr_rvalid
  ddr_axi_rready:
    - instance: axi_interconnect
      port: m_ddr_rready
    - instance: ddr_ctrl
      port: rready
  
  # Internal SRAM
  sram1_data:
    - instance: ahb_interconnect
      port: m_sram1
    - instance: sram1
      port: data
  sram1_addr:
    - instance: ahb_interconnect
      port: m_sram1_addr
    - instance: sram1
      port: addr
  sram1_we:
    - instance: ahb_interconnect
      port: m_sram1_we
    - instance: sram1
      port: we
  sram1_ready:
    - instance: sram1
      port: ready
    - instance: ahb_interconnect
      port: m_sram1_ready
  
  sram2_data:
    - instance: ahb_interconnect
      port: m_sram2
    - instance: sram2
      port: data
  sram2_addr:
    - instance: ahb_interconnect
      port: m_sram2_addr
    - instance: sram2
      port: addr
  sram2_we:
    - instance: ahb_interconnect
      port: m_sram2_we
    - instance: sram2
      port: we
  sram2_ready:
    - instance: sram2
      port: ready
    - instance: ahb_interconnect
      port: m_sram2_ready
  
  sram3_data:
    - instance: ahb_interconnect
      port: m_sram3
    - instance: sram3
      port: data
  sram3_addr:
    - instance: ahb_interconnect
      port: m_sram3_addr
    - instance: sram3
      port: addr
  sram3_we:
    - instance: ahb_interconnect
      port: m_sram3_we
    - instance: sram3
      port: we
  sram3_ready:
    - instance: sram3
      port: ready
    - instance: ahb_interconnect
      port: m_sram3_ready
  
  sram4_data:
    - instance: ahb_interconnect
      port: m_sram4
    - instance: sram4
      port: data
  sram4_addr:
    - instance: ahb_interconnect
      port: m_sram4_addr
    - instance: sram4
      port: addr
  sram4_we:
    - instance: ahb_interconnect
      port: m_sram4_we
    - instance: sram4
      port: we
  sram4_ready:
    - instance: sram4
      port: ready
    - instance: ahb_interconnect
      port: m_sram4_ready
  
  # Retention SRAM
  retsram_data:
    - instance: ahb_interconnect
      port: m_retsram
    - instance: retsram
      port: data
  retsram_addr:
    - instance: ahb_interconnect
      port: m_retsram_addr
    - instance: retsram
      port: addr
  retsram_we:
    - instance: ahb_interconnect
      port: m_retsram_we
    - instance: retsram
      port: we
  retsram_ready:
    - instance: retsram
      port: ready
    - instance: ahb_interconnect
      port: m_retsram_ready
  
  # Backup SRAM
  bkpsram_data:
    - instance: apb_interconnect
      port: m_bkpsram
    - instance: bkpsram
      port: data
  bkpsram_addr:
    - instance: apb_interconnect
      port: m_bkpsram_addr
    - instance: bkpsram
      port: addr
  bkpsram_we:
    - instance: apb_interconnect
      port: m_bkpsram_we
    - instance: bkpsram
      port: we
  bkpsram_ready:
    - instance: bkpsram
      port: ready
    - instance: apb_interconnect
      port: m_bkpsram_ready
  
  # Flash Memory Interface
  flash_data:
    - instance: flash_ctrl
      port: data
    - instance: flash_mem
      port: data
  flash_addr:
    - instance: flash_ctrl
      port: addr
    - instance: flash_mem
      port: addr
  flash_ce:
    - instance: flash_ctrl
      port: chip_en
    - instance: flash_mem
      port: ce
  flash_oe:
    - instance: flash_ctrl
      port: output_en
    - instance: flash_mem
      port: oe
  flash_we:
    - instance: flash_ctrl
      port: write_en
    - instance: flash_mem
      port: we
  flash_rdy:
    - instance: flash_mem
      port: ready
    - instance: flash_ctrl
      port: ready
  flash_err:
    - instance: flash_mem
      port: error
    - instance: flash_ctrl
      port: error
  
  # Flash Controller AHB Interface
  flash_ahb_data:
    - instance: ahb_interconnect
      port: m_flash
    - instance: flash_ctrl
      port: ahb_data
  flash_ahb_addr:
    - instance: ahb_interconnect
      port: m_flash_addr
    - instance: flash_ctrl
      port: ahb_addr
  flash_ahb_we:
    - instance: ahb_interconnect
      port: m_flash_we
    - instance: flash_ctrl
      port: ahb_we
  flash_ahb_ready:
    - instance: flash_ctrl
      port: ahb_ready
    - instance: ahb_interconnect
      port: m_flash_ready
  
  # Memory Protection Unit
  mpu_region_cfg:
    - instance: cortex_a35
      port: mpu_cfg
    - instance: mpu
      port: region_cfg
  mpu_enable:
    - instance: cortex_a35
      port: mpu_en
    - instance: mpu
      port: enable
  mpu_fault:
    - instance: mpu
      port: fault
    - instance: cortex_a35
      port: mpu_fault
  mpu_addr:
    - instance: mpu
      port: fault_addr
    - instance: cortex_a35
      port: mpu_fault_addr
  
  # Memory ECC
  ddr_ecc_err:
    - instance: ddr_ctrl
      port: ecc_err
    - instance: interrupt_ecc
      port: ddr_err
  sram_ecc_err:
    - instance: sram1
      port: ecc_err
    - instance: interrupt_ecc
      port: sram1_err
  flash_ecc_err:
    - instance: flash_ctrl
      port: ecc_err
    - instance: interrupt_ecc
      port: flash_err
  ecc_corr:
    - instance: interrupt_ecc
      port: corr
    - instance: cortex_a35
      port: ecc_corr_irq
  ecc_uncorr:
    - instance: interrupt_ecc
      port: uncorr
    - instance: cortex_a35
      port: ecc_uncorr_irq

bus:
  # DDR AXI Bus
  ddr_axi:
    - instance: instance.axi_interconnect
      port: ddr_master
    - instance: instance.ddr_ctrl
      port: axi_slave
  
  # SRAM AHB Bus  
  sram_ahb:
    - instance: instance.ahb_interconnect
      port: sram_master
    - instance: instance.sram1
      port: ahb_slave
    - instance: instance.sram2
      port: ahb_slave
    - instance: instance.sram3
      port: ahb_slave
    - instance: instance.sram4
      port: ahb_slave
    - instance: instance.retsram
      port: ahb_slave
    - instance: instance.flash_ctrl
      port: ahb_slave

comb:
  mem_ready: { bits: 1, expr: "ddr_ready & sram_ready & flash_ready" }
  ddr_ready: { bits: 1, expr: "ddr_phy.init_done & ddr_ctrl.calib_done" }
  sram_ready: { bits: 1, expr: "sram1.ready & sram2.ready & sram3.ready & sram4.ready" }
  flash_ready: { bits: 1, expr: "flash_mem.ready & flash_ctrl.ready" }
  mpu_fault: { bits: 1, expr: "mpu.fault | region_overlap | invalid_access" }
  region_overlap: { bits: 1, expr: "mpu.region_overlap" }
  invalid_access: { bits: 1, expr: "mpu.invalid_access" }
  ecc_status: { bits: 3, expr: "{ddr_ecc_err, sram_ecc_err, flash_ecc_err}" }
  ecc_fatal: { bits: 1, expr: "ecc_uncorr | multi_bit_err" }
  multi_bit_err: { bits: 1, expr: "ddr_ctrl.multi_bit_err | flash_ctrl.multi_bit_err" }

# Part 3: Communication Interfaces
  # Ethernet MAC Interface
  eth_txd:
    - instance: eth_mac
      port: txd
    - instance: eth_phy
      port: txd
  eth_txen:
    - instance: eth_mac
      port: txen
    - instance: eth_phy
      port: txen
  eth_txclk:
    - instance: eth_phy
      port: txclk
    - instance: eth_mac
      port: txclk
  eth_rxd:
    - instance: eth_phy
      port: rxd
    - instance: eth_mac
      port: rxd
  eth_rxen:
    - instance: eth_phy
      port: rxen
    - instance: eth_mac
      port: rxen
  eth_rxclk:
    - instance: eth_phy
      port: rxclk
    - instance: eth_mac
      port: rxclk
  eth_crs:
    - instance: eth_phy
      port: crs
    - instance: eth_mac
      port: crs
  eth_col:
    - instance: eth_phy
      port: col
    - instance: eth_mac
      port: col
  eth_mdc:
    - instance: eth_mac
      port: mdc
    - instance: eth_phy
      port: mdc
  eth_mdio:
    - instance: eth_mac
      port: mdio
    - instance: eth_phy
      port: mdio
  eth_int:
    - instance: eth_phy
      port: interrupt
    - instance: eth_mac
      port: phy_int
  eth_pps:
    - instance: eth_mac
      port: pps
    - instance: eth_phy
      port: pps
  
  # Ethernet MAC AXI Interface
  eth_axi_awaddr:
    - instance: axi_interconnect
      port: m_eth_awaddr
    - instance: eth_mac
      port: awaddr
  eth_axi_awvalid:
    - instance: axi_interconnect
      port: m_eth_awvalid
    - instance: eth_mac
      port: awvalid
  eth_axi_awready:
    - instance: eth_mac
      port: awready
    - instance: axi_interconnect
      port: m_eth_awready
  eth_axi_wdata:
    - instance: axi_interconnect
      port: m_eth_wdata
    - instance: eth_mac
      port: wdata
  eth_axi_wstrb:
    - instance: axi_interconnect
      port: m_eth_wstrb
    - instance: eth_mac
      port: wstrb
  eth_axi_wvalid:
    - instance: axi_interconnect
      port: m_eth_wvalid
    - instance: eth_mac
      port: wvalid
  eth_axi_wready:
    - instance: eth_mac
      port: wready
    - instance: axi_interconnect
      port: m_eth_wready
  eth_axi_bresp:
    - instance: eth_mac
      port: bresp
    - instance: axi_interconnect
      port: m_eth_bresp
  eth_axi_bvalid:
    - instance: eth_mac
      port: bvalid
    - instance: axi_interconnect
      port: m_eth_bvalid
  eth_axi_bready:
    - instance: axi_interconnect
      port: m_eth_bready
    - instance: eth_mac
      port: bready
  eth_axi_araddr:
    - instance: axi_interconnect
      port: m_eth_araddr
    - instance: eth_mac
      port: araddr
  eth_axi_arvalid:
    - instance: axi_interconnect
      port: m_eth_arvalid
    - instance: eth_mac
      port: arvalid
  eth_axi_arready:
    - instance: eth_mac
      port: arready
    - instance: axi_interconnect
      port: m_eth_arready
  eth_axi_rdata:
    - instance: eth_mac
      port: rdata
    - instance: axi_interconnect
      port: m_eth_rdata
  eth_axi_rresp:
    - instance: eth_mac
      port: rresp
    - instance: axi_interconnect
      port: m_eth_rresp
  eth_axi_rvalid:
    - instance: eth_mac
      port: rvalid
    - instance: axi_interconnect
      port: m_eth_rvalid
  eth_axi_rready:
    - instance: axi_interconnect
      port: m_eth_rready
    - instance: eth_mac
      port: rready
  
  # USB Controller Interface
  usb_dp:
    - instance: usb_ctrl
      port: dp
    - instance: usb_phy
      port: dp
  usb_dm:
    - instance: usb_ctrl
      port: dm
    - instance: usb_phy
      port: dm
  usb_vbus:
    - instance: usb_phy
      port: vbus
    - instance: usb_ctrl
      port: vbus
  usb_id:
    - instance: usb_phy
      port: id
    - instance: usb_ctrl
      port: id
  usb_rsten:
    - instance: usb_ctrl
      port: phy_reset
    - instance: usb_phy
      port: reset
  usb_clk:
    - instance: usb_phy
      port: clk
    - instance: usb_ctrl
      port: phy_clk
  usb_int:
    - instance: usb_phy
      port: interrupt
    - instance: usb_ctrl
      port: phy_int
  
  # USB AXI Interface
  usb_axi_awaddr:
    - instance: axi_interconnect
      port: m_usb_awaddr
    - instance: usb_ctrl
      port: awaddr
  usb_axi_awvalid:
    - instance: axi_interconnect
      port: m_usb_awvalid
    - instance: usb_ctrl
      port: awvalid
  usb_axi_awready:
    - instance: usb_ctrl
      port: awready
    - instance: axi_interconnect
      port: m_usb_awready
  usb_axi_wdata:
    - instance: axi_interconnect
      port: m_usb_wdata
    - instance: usb_ctrl
      port: wdata
  usb_axi_wstrb:
    - instance: axi_interconnect
      port: m_usb_wstrb
    - instance: usb_ctrl
      port: wstrb
  usb_axi_wvalid:
    - instance: axi_interconnect
      port: m_usb_wvalid
    - instance: usb_ctrl
      port: wvalid
  usb_axi_wready:
    - instance: usb_ctrl
      port: wready
    - instance: axi_interconnect
      port: m_usb_wready
  usb_axi_bresp:
    - instance: usb_ctrl
      port: bresp
    - instance: axi_interconnect
      port: m_usb_bresp
  usb_axi_bvalid:
    - instance: usb_ctrl
      port: bvalid
    - instance: axi_interconnect
      port: m_usb_bvalid
  usb_axi_bready:
    - instance: axi_interconnect
      port: m_usb_bready
    - instance: usb_ctrl
      port: bready
  usb_axi_araddr:
    - instance: axi_interconnect
      port: m_usb_araddr
    - instance: usb_ctrl
      port: araddr
  usb_axi_arvalid:
    - instance: axi_interconnect
      port: m_usb_arvalid
    - instance: usb_ctrl
      port: arvalid
  usb_axi_arready:
    - instance: usb_ctrl
      port: arready
    - instance: axi_interconnect
      port: m_usb_arready
  usb_axi_rdata:
    - instance: usb_ctrl
      port: rdata
    - instance: axi_interconnect
      port: m_usb_rdata
  usb_axi_rresp:
    - instance: usb_ctrl
      port: rresp
    - instance: axi_interconnect
      port: m_usb_rresp
  usb_axi_rvalid:
    - instance: usb_ctrl
      port: rvalid
    - instance: axi_interconnect
      port: m_usb_rvalid
  usb_axi_rready:
    - instance: axi_interconnect
      port: m_usb_rready
    - instance: usb_ctrl
      port: rready
  
  # PCIe Controller Interface
  pcie_txp:
    - instance: pcie_ctrl
      port: txp
    - instance: pcie_phy
      port: txp
  pcie_txn:
    - instance: pcie_ctrl
      port: txn
    - instance: pcie_phy
      port: txn
  pcie_rxp:
    - instance: pcie_phy
      port: rxp
    - instance: pcie_ctrl
      port: rxp
  pcie_rxn:
    - instance: pcie_phy
      port: rxn
    - instance: pcie_ctrl
      port: rxn
  pcie_refclk_p:
    - instance: pcie_phy
      port: refclk_p
    - instance: pcie_ctrl
      port: refclk_p
  pcie_refclk_n:
    - instance: pcie_phy
      port: refclk_n
    - instance: pcie_ctrl
      port: refclk_n
  pcie_perst:
    - instance: pcie_ctrl
      port: perst
    - instance: pcie_phy
      port: perst
  pcie_wake:
    - instance: pcie_ctrl
      port: wake
    - instance: pcie_phy
      port: wake
  pcie_clkreq:
    - instance: pcie_ctrl
      port: clkreq
    - instance: pcie_phy
      port: clkreq
  pcie_int:
    - instance: pcie_phy
      port: interrupt
    - instance: pcie_ctrl
      port: phy_int
  
  # PCIe AXI Interface
  pcie_axi_awaddr:
    - instance: axi_interconnect
      port: m_pcie_awaddr
    - instance: pcie_ctrl
      port: awaddr
  pcie_axi_awvalid:
    - instance: axi_interconnect
      port: m_pcie_awvalid
    - instance: pcie_ctrl
      port: awvalid
  pcie_axi_awready:
    - instance: pcie_ctrl
      port: awready
    - instance: axi_interconnect
      port: m_pcie_awready
  pcie_axi_wdata:
    - instance: axi_interconnect
      port: m_pcie_wdata
    - instance: pcie_ctrl
      port: wdata
  pcie_axi_wstrb:
    - instance: axi_interconnect
      port: m_pcie_wstrb
    - instance: pcie_ctrl
      port: wstrb
  pcie_axi_wvalid:
    - instance: axi_interconnect
      port: m_pcie_wvalid
    - instance: pcie_ctrl
      port: wvalid
  pcie_axi_wready:
    - instance: pcie_ctrl
      port: wready
    - instance: axi_interconnect
      port: m_pcie_wready
  pcie_axi_bresp:
    - instance: pcie_ctrl
      port: bresp
    - instance: axi_interconnect
      port: m_pcie_bresp
  pcie_axi_bvalid:
    - instance: pcie_ctrl
      port: bvalid
    - instance: axi_interconnect
      port: m_pcie_bvalid
  pcie_axi_bready:
    - instance: axi_interconnect
      port: m_pcie_bready
    - instance: pcie_ctrl
      port: bready
  pcie_axi_araddr:
    - instance: axi_interconnect
      port: m_pcie_araddr
    - instance: pcie_ctrl
      port: araddr
  pcie_axi_arvalid:
    - instance: axi_interconnect
      port: m_pcie_arvalid
    - instance: pcie_ctrl
      port: arvalid
  pcie_axi_arready:
    - instance: pcie_ctrl
      port: arready
    - instance: axi_interconnect
      port: m_pcie_arready
  pcie_axi_rdata:
    - instance: pcie_ctrl
      port: rdata
    - instance: axi_interconnect
      port: m_pcie_rdata
  pcie_axi_rresp:
    - instance: pcie_ctrl
      port: rresp
    - instance: axi_interconnect
      port: m_pcie_rresp
  pcie_axi_rvalid:
    - instance: pcie_ctrl
      port: rvalid
    - instance: axi_interconnect
      port: m_pcie_rvalid
  pcie_axi_rready:
    - instance: axi_interconnect
      port: m_pcie_rready
    - instance: pcie_ctrl
      port: rready
  
  # SDMMC Interfaces
  sdmmc1_clk:
    - instance: sdmmc1
      port: clk
    - instance: sdmmc1_phy
      port: clk
  sdmmc1_cmd:
    - instance: sdmmc1
      port: cmd
    - instance: sdmmc1_phy
      port: cmd
  sdmmc1_data:
    - instance: sdmmc1
      port: data
    - instance: sdmmc1_phy
      port: data
  sdmmc1_cd:
    - instance: sdmmc1_phy
      port: card_detect
    - instance: sdmmc1
      port: card_detect
  sdmmc1_wp:
    - instance: sdmmc1_phy
      port: write_protect
    - instance: sdmmc1
      port: write_protect
  sdmmc1_vsel:
    - instance: sdmmc1
      port: voltage_select
    - instance: sdmmc1_phy
      port: voltage_select
  sdmmc1_vsw:
    - instance: sdmmc1
      port: voltage_switch
    - instance: sdmmc1_phy
      port: voltage_switch
  
  sdmmc2_clk:
    - instance: sdmmc2
      port: clk
    - instance: sdmmc2_phy
      port: clk
  sdmmc2_cmd:
    - instance: sdmmc2
      port: cmd
    - instance: sdmmc2_phy
      port: cmd
  sdmmc2_data:
    - instance: sdmmc2
      port: data
    - instance: sdmmc2_phy
      port: data
  sdmmc2_cd:
    - instance: sdmmc2_phy
      port: card_detect
    - instance: sdmmc2
      port: card_detect
  sdmmc2_wp:
    - instance: sdmmc2_phy
      port: write_protect
    - instance: sdmmc2
      port: write_protect
  sdmmc2_vsel:
    - instance: sdmmc2
      port: voltage_select
    - instance: sdmmc2_phy
      port: voltage_select
  sdmmc2_vsw:
    - instance: sdmmc2
      port: voltage_switch
    - instance: sdmmc2_phy
      port: voltage_switch
  
  # SDMMC AHB Interface
  sdmmc1_ahb_data:
    - instance: ahb_interconnect
      port: m_sdmmc1
    - instance: sdmmc1
      port: ahb_data
  sdmmc1_ahb_addr:
    - instance: ahb_interconnect
      port: m_sdmmc1_addr
    - instance: sdmmc1
      port: ahb_addr
  sdmmc1_ahb_we:
    - instance: ahb_interconnect
      port: m_sdmmc1_we
    - instance: sdmmc1
      port: ahb_we
  sdmmc1_ahb_ready:
    - instance: sdmmc1
      port: ahb_ready
    - instance: ahb_interconnect
      port: m_sdmmc1_ready
  
  sdmmc2_ahb_data:
    - instance: ahb_interconnect
      port: m_sdmmc2
    - instance: sdmmc2
      port: ahb_data
  sdmmc2_ahb_addr:
    - instance: ahb_interconnect
      port: m_sdmmc2_addr
    - instance: sdmmc2
      port: ahb_addr
  sdmmc2_ahb_we:
    - instance: ahb_interconnect
      port: m_sdmmc2_we
    - instance: sdmmc2
      port: ahb_we
  sdmmc2_ahb_ready:
    - instance: sdmmc2
      port: ahb_ready
    - instance: ahb_interconnect
      port: m_sdmmc2_ready
  
  # QSPI Interface
  qspi_clk: { link: [qspi.clk, qspi_flash.clk] }
  qspi_cs:  { link: [qspi.chip_select, qspi_flash.cs] }
  qspi_io:  { link: [qspi.data, qspi_flash.io] }
  qspi_dqs: { link: [qspi_flash.dqs, qspi.dqs] }
  qspi_reset: { link: [qspi.reset, qspi_flash.reset] }
  
  # QSPI AHB Interface
  qspi_ahb_data:  { link: [ahb_interconnect.m_qspi, qspi.ahb_data] }
  qspi_ahb_addr:  { link: [ahb_interconnect.m_qspi_addr, qspi.ahb_addr] }
  qspi_ahb_we:    { link: [ahb_interconnect.m_qspi_we, qspi.ahb_we] }
  qspi_ahb_ready: { link: [qspi.ahb_ready, ahb_interconnect.m_qspi_ready] }
  
  # CAN FD Interfaces
  can1_tx:  { link: [fdcan1.tx, can1_phy.tx] }
  can1_rx:  { link: [can1_phy.rx, fdcan1.rx] }
  can1_stb: { link: [fdcan1.standby, can1_phy.standby] }
  can1_en:  { link: [fdcan1.enable, can1_phy.enable] }
  can1_err: { link: [can1_phy.error, fdcan1.phy_error] }
  
  can2_tx:  { link: [fdcan2.tx, can2_phy.tx] }
  can2_rx:  { link: [can2_phy.rx, fdcan2.rx] }
  can2_stb: { link: [fdcan2.standby, can2_phy.standby] }
  can2_en:  { link: [fdcan2.enable, can2_phy.enable] }
  can2_err: { link: [can2_phy.error, fdcan2.phy_error] }
  
  # CAN APB Interface
  can1_apb_data:  { link: [apb_interconnect.m_can1, fdcan1.apb_data] }
  can1_apb_addr:  { link: [apb_interconnect.m_can1_addr, fdcan1.apb_addr] }
  can1_apb_we:    { link: [apb_interconnect.m_can1_we, fdcan1.apb_we] }
  can1_apb_ready: { link: [fdcan1.apb_ready, apb_interconnect.m_can1_ready] }
  
  can2_apb_data:  { link: [apb_interconnect.m_can2, fdcan2.apb_data] }
  can2_apb_addr:  { link: [apb_interconnect.m_can2_addr, fdcan2.apb_addr] }
  can2_apb_we:    { link: [apb_interconnect.m_can2_we, fdcan2.apb_we] }
  can2_apb_ready: { link: [fdcan2.apb_ready, apb_interconnect.m_can2_ready] }

bus:
  # Ethernet AXI Bus
  eth_axi:
    - instance: instance.axi_interconnect
      port: eth_master
    - instance: instance.eth_mac
      port: axi_slave
  
  # USB AXI Bus
  usb_axi:
    - instance: instance.axi_interconnect
      port: usb_master
    - instance: instance.usb_ctrl
      port: axi_slave
  
  # PCIe AXI Bus
  pcie_axi:
    - instance: instance.axi_interconnect
      port: pcie_master
    - instance: instance.pcie_ctrl
      port: axi_slave
  
  # SDMMC AHB Bus
  sdmmc_ahb:
    - instance: instance.ahb_interconnect
      port: sdmmc_master
    - instance: instance.sdmmc1
      port: ahb_slave
    - instance: instance.sdmmc2
      port: ahb_slave
    - instance: instance.qspi
      port: ahb_slave
  
  # CAN APB Bus
  can_apb:
    - instance: instance.apb_interconnect
      port: can_master
    - instance: instance.fdcan1
      port: apb_slave
    - instance: instance.fdcan2
      port: apb_slave

comb:
  # Communication interface status
  comm_ready: { expr: "eth_ready & usb_ready & pcie_ready & sdmmc_ready" }
  eth_ready: { expr: "eth_phy.link_up & eth_mac.ready" }
  usb_ready: { expr: "usb_phy.ready & usb_ctrl.ready" }
  pcie_ready: { expr: "pcie_phy.ready & pcie_ctrl.ready" }
  sdmmc_ready: { expr: "sdmmc1_phy.ready & sdmmc2_phy.ready" }
  
  # Link status
  eth_link: { expr: "eth_phy.link_up" }
  eth_speed: { expr: "eth_phy.speed", width: 2 }
  usb_speed: { expr: "usb_ctrl.speed", width: 2 }
  pcie_link: { expr: "pcie_phy.link_up" }
  pcie_width: { expr: "pcie_phy.link_width", width: 3 }
  pcie_speed: { expr: "pcie_phy.link_speed", width: 2 }
  
  # Card detection
  sdmmc1_card: { expr: "sdmmc1_phy.card_detect" }
  sdmmc2_card: { expr: "sdmmc2_phy.card_detect" }
  sdmmc1_wp: { expr: "sdmmc1_phy.write_protect" }
  sdmmc2_wp: { expr: "sdmmc2_phy.write_protect" }
  
  # CAN status
  can1_ready: { expr: "fdcan1.ready & can1_phy.ready" }
  can2_ready: { expr: "fdcan2.ready & can2_phy.ready" }
  can_bus_off: { expr: "fdcan1.bus_off | fdcan2.bus_off" }
  can_error: { expr: "fdcan1.error | fdcan2.error | can1_phy.error | can2_phy.error" }

# Part 4: Analog Interfaces
net:
  # ADC1 Interface
  adc1_in:
    - instance: adc1_phy
      port: in
    - instance: adc1
      port: in
  adc1_vref:
    - instance: adc1_vref
      port: out
    - instance: adc1
      port: vref
  adc1_vdda:
    - instance: adc1_vdda
      port: out
    - instance: adc1
      port: vdda
  adc1_vssa:
    - instance: adc1_vssa
      port: out
    - instance: adc1
      port: vssa
  adc1_temp:
    - instance: temp_sensor
      port: out
    - instance: adc1
      port: temp
  adc1_vbat:
    - instance: vbat_div
      port: out
    - instance: adc1
      port: vbat
  adc1_data:
    - instance: adc1
      port: data
    - instance: adc1_fifo
      port: data_in
  adc1_drdy:
    - instance: adc1
      port: data_ready
    - instance: adc1_fifo
      port: write_en
  adc1_eoc:
    - instance: adc1
      port: end_conv
    - instance: interrupt_adc1
      port: eoc
  adc1_jeoc:
    - instance: adc1
      port: end_inj_conv
    - instance: interrupt_adc1
      port: jeoc
  adc1_awd:
    - instance: adc1
      port: analog_watchdog
    - instance: interrupt_adc1
      port: awd
  adc1_ovr:
    - instance: adc1
      port: overrun
    - instance: interrupt_adc1
      port: ovr
  
  # ADC2 Interface
  adc2_in:
    - instance: adc2_phy
      port: in
    - instance: adc2
      port: in
  adc2_vref:
    - instance: adc1_vref
      port: out
    - instance: adc2
      port: vref
  adc2_vdda:
    - instance: adc1_vdda
      port: out
    - instance: adc2
      port: vdda
  adc2_vssa:
    - instance: adc1_vssa
      port: out
    - instance: adc2
      port: vssa
  adc2_data:
    - instance: adc2
      port: data
    - instance: adc2_fifo
      port: data_in
  adc2_drdy:
    - instance: adc2
      port: data_ready
    - instance: adc2_fifo
      port: write_en
  adc2_eoc:
    - instance: adc2
      port: end_conv
    - instance: interrupt_adc2
      port: eoc
  adc2_jeoc:
    - instance: adc2
      port: end_inj_conv
    - instance: interrupt_adc2
      port: jeoc
  adc2_awd:
    - instance: adc2
      port: analog_watchdog
    - instance: interrupt_adc2
      port: awd
  adc2_ovr:
    - instance: adc2
      port: overrun
    - instance: interrupt_adc2
      port: ovr
  
  # DAC Interface
  dac1_out:
    - instance: dac1
      port: out
    - instance: dac1_phy
      port: out
  dac1_vref:
    - instance: dac_vref
      port: out
    - instance: dac1
      port: vref
  dac1_vdda:
    - instance: dac_vdda
      port: out
    - instance: dac1
      port: vdda
  dac1_data:
    - instance: dac1_fifo
      port: data_out
    - instance: dac1
      port: data
  dac1_trigger:
    - instance: timer_trigger
      port: out
    - instance: dac1
      port: trigger
  dac1_dma_req:
    - instance: dac1
      port: dma_req
    - instance: dma_dac1
      port: request
  dac1_underrun:
    - instance: dac1
      port: underrun
    - instance: interrupt_dac
      port: underrun
  
  dac2_out:
    - instance: dac2
      port: out
    - instance: dac2_phy
      port: out
  dac2_vref:
    - instance: dac_vref
      port: out
    - instance: dac2
      port: vref
  dac2_vdda:
    - instance: dac_vdda
      port: out
    - instance: dac2
      port: vdda
  dac2_data:
    - instance: dac2_fifo
      port: data_out
    - instance: dac2
      port: data
  dac2_trigger:
    - instance: timer_trigger
      port: out
    - instance: dac2
      port: trigger
  dac2_dma_req:
    - instance: dac2
      port: dma_req
    - instance: dma_dac2
      port: request
  dac2_underrun:
    - instance: dac2
      port: underrun
    - instance: interrupt_dac
      port: underrun
  
  # Temperature Sensor
  temp_out:
    - instance: temp_sensor
      port: out
    - instance: adc1
      port: temp
  temp_en:
    - instance: temp_ctrl
      port: enable
    - instance: temp_sensor
      port: enable
  temp_ready:
    - instance: temp_sensor
      port: ready
    - instance: temp_status
      port: ready
  temp_cal:
    - instance: temp_calib
      port: out
    - instance: temp_sensor
      port: calib
  
  # Voltage Reference
  vref_out:
    - instance: vref_buf
      port: out
    - instance: adc1_vref
      port: in
    - instance: adc2_vref
      port: in
    - instance: dac_vref
      port: in
  vref_en:
    - instance: vref_ctrl
      port: enable
    - instance: vref_buf
      port: enable
  vref_ready:
    - instance: vref_buf
      port: ready
    - instance: vref_status
      port: ready
  vref_trim:
    - instance: vref_trim
      port: out
    - instance: vref_buf
      port: trim
  
  # Analog Multiplexer
  adc1_mux_out:
    - instance: adc1_mux
      port: out
    - instance: adc1
      port: in
  adc1_mux_sel:
    - instance: adc1_cfg
      port: mux_sel
    - instance: adc1_mux
      port: sel
  adc1_mux_in:
    - instance: adc1_phy
      port: in
    - instance: adc1_mux
      port: in
  
  adc2_mux_out:
    - instance: adc2_mux
      port: out
    - instance: adc2
      port: in
  adc2_mux_sel:
    - instance: adc2_cfg
      port: mux_sel
    - instance: adc2_mux
      port: sel
  adc2_mux_in:
    - instance: adc2_phy
      port: in
    - instance: adc2_mux
      port: in
  
  # Analog Comparator
  comp1:
    out: { link: [comp1.out, interrupt_comp1.output] }
    inp: { link: [comp1_phy.inp, comp1.inp] }
    inm: { link: [comp1_phy.inm, comp1.inm] }
    en: { link: [comp1_cfg.enable, comp1.enable] }
    hyst: { link: [comp1_cfg.hysteresis, comp1.hyst], width: 2 }
    speed: { link: [comp1_cfg.speed, comp1.speed], width: 2 }
    blanking: { link: [timer_blank.out, comp1.blanking], width: 4 }
  
  comp2_out:
    - instance: comp2
      port: out
    - instance: interrupt_comp2
      port: output
  comp2_inp:
    - instance: comp2_phy
      port: inp
    - instance: comp2
      port: inp
  comp2_inm:
    - instance: comp2_phy
      port: inm
    - instance: comp2
      port: inm
  comp2_en:
    - instance: comp2_cfg
      port: enable
    - instance: comp2
      port: enable
  comp2_hyst:
    - instance: comp2_cfg
      port: hysteresis
    - instance: comp2
      port: hyst
  comp2_speed:
    - instance: comp2_cfg
      port: speed
    - instance: comp2
      port: speed
  comp2_blanking:
    - instance: timer_blank
      port: out
    - instance: comp2
      port: blanking
  
  # Operational Amplifier
  opamp1_out:
    - instance: opamp1
      port: out
    - instance: opamp1_phy
      port: out
  opamp1_inp:
    - instance: opamp1_phy
      port: inp
    - instance: opamp1
      port: inp
  opamp1_inm:
    - instance: opamp1_phy
      port: inm
    - instance: opamp1
      port: inm
  opamp1_en:
    - instance: opamp1_cfg
      port: enable
    - instance: opamp1
      port: enable
  opamp1_mode:
    - instance: opamp1_cfg
      port: mode
    - instance: opamp1
      port: mode
  opamp1_gain:
    - instance: opamp1_cfg
      port: gain
    - instance: opamp1
      port: gain
  opamp1_trim:
    - instance: opamp1_trim
      port: out
    - instance: opamp1
      port: trim
  
  opamp2_out:
    - instance: opamp2
      port: out
    - instance: opamp2_phy
      port: out
  opamp2_inp:
    - instance: opamp2_phy
      port: inp
    - instance: opamp2
      port: inp
  opamp2_inm:
    - instance: opamp2_phy
      port: inm
    - instance: opamp2
      port: inm
  opamp2_en:
    - instance: opamp2_cfg
      port: enable
    - instance: opamp2
      port: enable
  opamp2_mode:
    - instance: opamp2_cfg
      port: mode
    - instance: opamp2
      port: mode
  opamp2_gain:
    - instance: opamp2_cfg
      port: gain
    - instance: opamp2
      port: gain
  opamp2_trim:
    - instance: opamp2_trim
      port: out
    - instance: opamp2
      port: trim
  
  # ADC Configuration APB Interface
  adc1_cfg_data:
    - instance: apb_interconnect
      port: m_adc1_cfg
    - instance: adc1_cfg
      port: data
  adc1_cfg_addr:
    - instance: apb_interconnect
      port: m_adc1_cfg_addr
    - instance: adc1_cfg
      port: addr
  adc1_cfg_we:
    - instance: apb_interconnect
      port: m_adc1_cfg_we
    - instance: adc1_cfg
      port: we
  adc1_cfg_ready:
    - instance: adc1_cfg
      port: ready
    - instance: apb_interconnect
      port: m_adc1_cfg_ready
  
  adc2_cfg_data:
    - instance: apb_interconnect
      port: m_adc2_cfg
    - instance: adc2_cfg
      port: data
  adc2_cfg_addr:
    - instance: apb_interconnect
      port: m_adc2_cfg_addr
    - instance: adc2_cfg
      port: addr
  adc2_cfg_we:
    - instance: apb_interconnect
      port: m_adc2_cfg_we
    - instance: adc2_cfg
      port: we
  adc2_cfg_ready:
    - instance: adc2_cfg
      port: ready
    - instance: apb_interconnect
      port: m_adc2_cfg_ready
  
  # DAC Configuration APB Interface
  dac_cfg_data:
    - instance: apb_interconnect
      port: m_dac_cfg
    - instance: dac_cfg
      port: data
  dac_cfg_addr:
    - instance: apb_interconnect
      port: m_dac_cfg_addr
    - instance: dac_cfg
      port: addr
  dac_cfg_we:
    - instance: apb_interconnect
      port: m_dac_cfg_we
    - instance: dac_cfg
      port: we
  dac_cfg_ready:
    - instance: dac_cfg
      port: ready
    - instance: apb_interconnect
      port: m_dac_cfg_ready
  
  # Analog Watchdog
  awd1_out:
    - instance: adc1
      port: analog_watchdog
    - instance: interrupt_awd1
      port: output
  awd1_th:
    - instance: adc1_cfg
      port: awd_threshold
    - instance: adc1
      port: awd_th
  awd1_ch:
    - instance: adc1_cfg
      port: awd_channel
    - instance: adc1
      port: awd_ch
  awd1_en:
    - instance: adc1_cfg
      port: awd_enable
    - instance: adc1
      port: awd_en
  
  awd2_out:
    - instance: adc2
      port: analog_watchdog
    - instance: interrupt_awd2
      port: output
  awd2_th:
    - instance: adc2_cfg
      port: awd_threshold
    - instance: adc2
      port: awd_th
  awd2_ch:
    - instance: adc2_cfg
      port: awd_channel
    - instance: adc2
      port: awd_ch
  awd2_en:
    - instance: adc2_cfg
      port: awd_enable
    - instance: adc2
      port: awd_en
  
  # Battery Voltage Monitor
  vbat_div_out:
    - instance: vbat_div
      port: out
    - instance: adc1
      port: vbat
  vbat_div_en:
    - instance: vbat_ctrl
      port: enable
    - instance: vbat_div
      port: enable
  vbat_ready:
    - instance: vbat_div
      port: ready
    - instance: vbat_status
      port: ready
  vbat_level:
    - instance: vbat_div
      port: level
  
  # Analog Calibration
  adc1_cal:
    - instance: adc1_calib
      port: out
    - instance: adc1
      port: calib
  adc2_cal:
    - instance: adc2_calib
      port: out
    - instance: adc2
      port: calib
  adc_cal_en:
    - instance: calib_ctrl
      port: adc_cal_en
    - instance: adc1_calib
      port: enable
    - instance: adc2_calib
      port: enable
  calib_busy:
    - instance: adc1_calib
      port: busy
    - instance: adc2_calib
      port: busy
    - instance: calib_status
      port: busy

bus:
  # ADC APB Configuration Bus
  adc_apb:
    - instance: instance.apb_interconnect
      port: adc_master
    - instance: instance.adc1_cfg
      port: apb_slave
    - instance: instance.adc2_cfg
      port: apb_slave
  
  # DAC APB Configuration Bus
  dac_apb:
    - instance: instance.apb_interconnect
      port: dac_master
    - instance: instance.dac_cfg
      port: apb_slave

comb:
  # Analog power status
  analog_power_ok: { expr: "adc1_vdda.ok & adc2_vdda.ok & dac_vdda.ok & vref_ready" }
  adc1_power: { expr: "adc1_vdda.ok & adc1_vref.ok" }
  adc2_power: { expr: "adc2_vdda.ok & adc2_vref.ok" }
  dac_power: { expr: "dac_vdda.ok & dac_vref.ok" }
  
  # Analog ready status
  analog_ready: { expr: "adc1_ready & adc2_ready & dac_ready & temp_ready & vref_ready" }
  adc1_ready: { expr: "adc1.ready & adc1_calib.done" }
  adc2_ready: { expr: "adc2.ready & adc2_calib.done" }
  dac_ready: { expr: "dac1.ready & dac2.ready" }
  temp_ready: { expr: "temp_sensor.ready" }
  vref_ready: { expr: "vref_buf.ready" }
  
  # Analog error flags
  analog_error: { expr: "adc_overrun | dac_underrun | comp_fault | opamp_fault" }
  adc_overrun: { expr: "adc1.ovr | adc2.ovr" }
  dac_underrun: { expr: "dac1.underrun | dac2.underrun" }
  comp_fault: { expr: "comp1.fault | comp2.fault" }
  opamp_fault: { expr: "opamp1.fault | opamp2.fault" }
  
  # Watchdog triggers
  adc_watchdog: { expr: "awd1_out | awd2_out" }
  comp_watchdog: { expr: "comp1_out | comp2_out" }
  
  # Calibration status
  calib_needed: { expr: "!adc1_calib.done | !adc2_calib.done | !temp_calib.done" }
  calib_running: { expr: "adc1_calib.busy | adc2_calib.busy | temp_calib.busy" }
  calib_complete: { expr: "adc1_calib.done & adc2_calib.done & temp_calib.done" }
# Part 5: Timer System
  # Advanced Control Timers (TIM1, TIM8)
  tim1_clk:
    - instance: clk_divider
      port: clk_tim1
    - instance: tim1
      port: clk
  tim1_cnt:
    - instance: tim1
      port: counter
    - instance: tim1_cc
      port: counter
      bits: 16
  tim1_ARR:
    - instance: tim1
      port: auto_reload
    - instance: tim1_cc
      port: auto_reload
      bits: 16
  tim1_PSC:
    - instance: tim1
      port: prescaler
    - instance: tim1_cc
      port: prescaler
      bits: 16
  tim1_CCR1:
    - instance: tim1
      port: ccr1
    - instance: tim1_cc
      port: ccr1
      bits: 16
  tim1_CCR2:
    - instance: tim1
      port: ccr2
    - instance: tim1_cc
      port: ccr2
      bits: 16
  tim1_CCR3:
    - instance: tim1
      port: ccr3
    - instance: tim1_cc
      port: ccr3
      bits: 16
  tim1_CCR4:
    - instance: tim1
      port: ccr4
    - instance: tim1_cc
      port: ccr4
      bits: 16
  tim1_CH1:
    - instance: tim1_ch1
      port: io
    - instance: tim1_cc
      port: ch1
  tim1_CH1N:
    - instance: tim1_ch1n
      port: io
    - instance: tim1_cc
      port: ch1n
  tim1_CH2:
    - instance: tim1_ch2
      port: io
    - instance: tim1_cc
      port: ch2
  tim1_CH2N:
    - instance: tim1_ch2n
      port: io
    - instance: tim1_cc
      port: ch2n
  tim1_CH3:
    - instance: tim1_ch3
      port: io
    - instance: tim1_cc
      port: ch3
  tim1_CH3N:
    - instance: tim1_ch3n
      port: io
    - instance: tim1_cc
      port: ch3n
  tim1_CH4:
    - instance: tim1_ch4
      port: io
    - instance: tim1_cc
      port: ch4
  tim1_ETR:
    - instance: tim1_etr
      port: io
    - instance: tim1_cc
      port: etr
  tim1_BKIN:
    - instance: tim1_bkin
      port: io
    - instance: tim1_cc
      port: bkin
  tim1_BKIN2:
    - instance: tim1_bkin2
      port: io
    - instance: tim1_cc
      port: bkin2
  tim1_TRGO:
    - instance: tim1_cc
      port: trgo
    - instance: trigger_router
      port: tim1_trgo
  tim1_TRGO2:
    - instance: tim1_cc
      port: trgo2
    - instance: trigger_router
      port: tim1_trgo2
  tim1_BRK:
    - instance: tim1_cc
      port: brk
    - instance: interrupt_tim1
      port: brk
  tim1_UP:
    - instance: tim1_cc
      port: update
    - instance: interrupt_tim1
      port: update
  tim1_CC1:
    - instance: tim1_cc
      port: cc1
    - instance: interrupt_tim1
      port: cc1
  tim1_CC2:
    - instance: tim1_cc
      port: cc2
    - instance: interrupt_tim1
      port: cc2
  tim1_CC3:
    - instance: tim1_cc
      port: cc3
    - instance: interrupt_tim1
      port: cc3
  tim1_CC4:
    - instance: tim1_cc
      port: cc4
    - instance: interrupt_tim1
      port: cc4
  tim1_COM:
    - instance: tim1_cc
      port: com
    - instance: interrupt_tim1
      port: com
  tim1_DMA_CH1:
    - instance: tim1_cc
      port: dma_ch1
    - instance: dma_tim1_ch1
      port: request
  tim1_DMA_CH2:
    - instance: tim1_cc
      port: dma_ch2
    - instance: dma_tim1_ch2
      port: request
  tim1_DMA_CH3:
    - instance: tim1_cc
      port: dma_ch3
    - instance: dma_tim1_ch3
      port: request
  tim1_DMA_CH4:
    - instance: tim1_cc
      port: dma_ch4
    - instance: dma_tim1_ch4
      port: request
  tim1_DMA_UP:
    - instance: tim1_cc
      port: dma_update
    - instance: dma_tim1_up
      port: request
  tim1_DMA_COM:
    - instance: tim1_cc
      port: dma_com
    - instance: dma_tim1_com
      port: request
  
  tim8_clk:
    - instance: clk_divider
      port: clk_tim8
    - instance: tim8
      port: clk
  tim8_cnt:
    - instance: tim8
      port: counter
    - instance: tim8_cc
      port: counter
      bits: 16
  tim8_ARR:
    - instance: tim8
      port: auto_reload
    - instance: tim8_cc
      port: auto_reload
      bits: 16
  tim8_PSC:
    - instance: tim8
      port: prescaler
    - instance: tim8_cc
      port: prescaler
      bits: 16
  tim8_CCR1:
    - instance: tim8
      port: ccr1
    - instance: tim8_cc
      port: ccr1
      bits: 16
  tim8_CCR2:
    - instance: tim8
      port: ccr2
    - instance: tim8_cc
      port: ccr2
      bits: 16
  tim8_CCR3:
    - instance: tim8
      port: ccr3
    - instance: tim8_cc
      port: ccr3
      bits: 16
  tim8_CCR4:
    - instance: tim8
      port: ccr4
    - instance: tim8_cc
      port: ccr4
      bits: 16
  tim8_CH1:
    - instance: tim8_ch1
      port: io
    - instance: tim8_cc
      port: ch1
  tim8_CH1N:
    - instance: tim8_ch1n
      port: io
    - instance: tim8_cc
      port: ch1n
  tim8_CH2:
    - instance: tim8_ch2
      port: io
    - instance: tim8_cc
      port: ch2
  tim8_CH2N:
    - instance: tim8_ch2n
      port: io
    - instance: tim8_cc
      port: ch2n
  tim8_CH3:
    - instance: tim8_ch3
      port: io
    - instance: tim8_cc
      port: ch3
  tim8_CH3N:
    - instance: tim8_ch3n
      port: io
    - instance: tim8_cc
      port: ch3n
  tim8_CH4:
    - instance: tim8_ch4
      port: io
    - instance: tim8_cc
      port: ch4
  tim8_ETR:
    - instance: tim8_etr
      port: io
    - instance: tim8_cc
      port: etr
  tim8_BKIN:
    - instance: tim8_bkin
      port: io
    - instance: tim8_cc
      port: bkin
  tim8_BKIN2:
    - instance: tim8_bkin2
      port: io
    - instance: tim8_cc
      port: bkin2
  tim8_TRGO:
    - instance: tim8_cc
      port: trgo
    - instance: trigger_router
      port: tim8_trgo
  tim8_TRGO2:
    - instance: tim8_cc
      port: trgo2
    - instance: trigger_router
      port: tim8_trgo2
  tim8_BRK:
    - instance: tim8_cc
      port: brk
    - instance: interrupt_tim8
      port: brk
  tim8_UP:
    - instance: tim8_cc
      port: update
    - instance: interrupt_tim8
      port: update
  tim8_CC1:
    - instance: tim8_cc
      port: cc1
    - instance: interrupt_tim8
      port: cc1
  tim8_CC2:
    - instance: tim8_cc
      port: cc2
    - instance: interrupt_tim8
      port: cc2
  tim8_CC3:
    - instance: tim8_cc
      port: cc3
    - instance: interrupt_tim8
      port: cc3
  tim8_CC4:
    - instance: tim8_cc
      port: cc4
    - instance: interrupt_tim8
      port: cc4
  tim8_COM:
    - instance: tim8_cc
      port: com
    - instance: interrupt_tim8
      port: com
  tim8_DMA_CH1:
    - instance: tim8_cc
      port: dma_ch1
    - instance: dma_tim8_ch1
      port: request
  tim8_DMA_CH2:
    - instance: tim8_cc
      port: dma_ch2
    - instance: dma_tim8_ch2
      port: request
  tim8_DMA_CH3:
    - instance: tim8_cc
      port: dma_ch3
    - instance: dma_tim8_ch3
      port: request
  tim8_DMA_CH4:
    - instance: tim8_cc
      port: dma_ch4
    - instance: dma_tim8_ch4
      port: request
  tim8_DMA_UP:
    - instance: tim8_cc
      port: dma_update
    - instance: dma_tim8_up
      port: request
  tim8_DMA_COM:
    - instance: tim8_cc
      port: dma_com
    - instance: dma_tim8_com
      port: request
  
  # General Purpose Timers (TIM2-TIM5)
  tim2_clk:
    - instance: clk_divider
      port: clk_tim2
    - instance: tim2
      port: clk
  tim2_cnt:
    - instance: tim2
      port: counter
    - instance: tim2_cc
      port: counter
      bits: 32
  tim2_ARR:
    - instance: tim2
      port: auto_reload
    - instance: tim2_cc
      port: auto_reload
      bits: 32
  tim2_PSC:
    - instance: tim2
      port: prescaler
    - instance: tim2_cc
      port: prescaler
      bits: 16
  tim2_CCR1:
    - instance: tim2
      port: ccr1
    - instance: tim2_cc
      port: ccr1
      bits: 32
  tim2_CCR2:
    - instance: tim2
      port: ccr2
    - instance: tim2_cc
      port: ccr2
      bits: 32
  tim2_CCR3:
    - instance: tim2
      port: ccr3
    - instance: tim2_cc
      port: ccr3
      bits: 32
  tim2_CCR4:
    - instance: tim2
      port: ccr4
    - instance: tim2_cc
      port: ccr4
      bits: 32
  tim2_CH1:
    - instance: tim2_ch1
      port: io
    - instance: tim2_cc
      port: ch1
  tim2_CH2:
    - instance: tim2_ch2
      port: io
    - instance: tim2_cc
      port: ch2
  tim2_CH3:
    - instance: tim2_ch3
      port: io
    - instance: tim2_cc
      port: ch3
  tim2_CH4:
    - instance: tim2_ch4
      port: io
    - instance: tim2_cc
      port: ch4
  tim2_ETR:
    - instance: tim2_etr
      port: io
    - instance: tim2_cc
      port: etr
  tim2_TRGO:
    - instance: tim2_cc
      port: trgo
    - instance: trigger_router
      port: tim2_trgo
  tim2_UP:
    - instance: tim2_cc
      port: update
    - instance: interrupt_tim2
      port: update
  tim2_CC1:
    - instance: tim2_cc
      port: cc1
    - instance: interrupt_tim2
      port: cc1
  tim2_CC2:
    - instance: tim2_cc
      port: cc2
    - instance: interrupt_tim2
      port: cc2
  tim2_CC3:
    - instance: tim2_cc
      port: cc3
    - instance: interrupt_tim2
      port: cc3
  tim2_CC4:
    - instance: tim2_cc
      port: cc4
    - instance: interrupt_tim2
      port: cc4
  tim2_DMA_CH1:
    - instance: tim2_cc
      port: dma_ch1
    - instance: dma_tim2_ch1
      port: request
  tim2_DMA_CH2:
    - instance: tim2_cc
      port: dma_ch2
    - instance: dma_tim2_ch2
      port: request
  tim2_DMA_CH3:
    - instance: tim2_cc
      port: dma_ch3
    - instance: dma_tim2_ch3
      port: request
  tim2_DMA_CH4:
    - instance: tim2_cc
      port: dma_ch4
    - instance: dma_tim2_ch4
      port: request
  tim2_DMA_UP:
    - instance: tim2_cc
      port: dma_update
    - instance: dma_tim2_up
      port: request
  
  tim3_clk:
    - instance: clk_divider
      port: clk_tim3
    - instance: tim3
      port: clk
  tim3_cnt:
    - instance: tim3
      port: counter
    - instance: tim3_cc
      port: counter
      bits: 16
  tim3_ARR:
    - instance: tim3
      port: auto_reload
    - instance: tim3_cc
      port: auto_reload
      bits: 16
  tim3_PSC:
    - instance: tim3
      port: prescaler
    - instance: tim3_cc
      port: prescaler
      bits: 16
  tim3_CCR1:
    - instance: tim3
      port: ccr1
    - instance: tim3_cc
      port: ccr1
      bits: 16
  tim3_CCR2:
    - instance: tim3
      port: ccr2
    - instance: tim3_cc
      port: ccr2
      bits: 16
  tim3_CCR3:
    - instance: tim3
      port: ccr3
    - instance: tim3_cc
      port: ccr3
      bits: 16
  tim3_CCR4:
    - instance: tim3
      port: ccr4
    - instance: tim3_cc
      port: ccr4
      bits: 16
  tim3_CH1:
    - instance: tim3_ch1
      port: io
    - instance: tim3_cc
      port: ch1
  tim3_CH2:
    - instance: tim3_ch2
      port: io
    - instance: tim3_cc
      port: ch2
  tim3_CH3:
    - instance: tim3_ch3
      port: io
    - instance: tim3_cc
      port: ch3
  tim3_CH4:
    - instance: tim3_ch4
      port: io
    - instance: tim3_cc
      port: ch4
  tim3_ETR:
    - instance: tim3_etr
      port: io
    - instance: tim3_cc
      port: etr
  tim3_TRGO:
    - instance: tim3_cc
      port: trgo
    - instance: trigger_router
      port: tim3_trgo
  tim3_UP:
    - instance: tim3_cc
      port: update
    - instance: interrupt_tim3
      port: update
  tim3_CC1:
    - instance: tim3_cc
      port: cc1
    - instance: interrupt_tim3
      port: cc1
  tim3_CC2:
    - instance: tim3_cc
      port: cc2
    - instance: interrupt_tim3
      port: cc2
  tim3_CC3:
    - instance: tim3_cc
      port: cc3
    - instance: interrupt_tim3
      port: cc3
  tim3_CC4:
    - instance: tim3_cc
      port: cc4
    - instance: interrupt_tim3
      port: cc4
  tim3_DMA_CH1:
    - instance: tim3_cc
      port: dma_ch1
    - instance: dma_tim3_ch1
      port: request
  tim3_DMA_CH2:
    - instance: tim3_cc
      port: dma_ch2
    - instance: dma_tim3_ch2
      port: request
  tim3_DMA_CH3:
    - instance: tim3_cc
      port: dma_ch3
    - instance: dma_tim3_ch3
      port: request
  tim3_DMA_CH4:
    - instance: tim3_cc
      port: dma_ch4
    - instance: dma_tim3_ch4
      port: request
  tim3_DMA_UP:
    - instance: tim3_cc
      port: dma_update
    - instance: dma_tim3_up
      port: request
  
  tim4_clk:
    - instance: clk_divider
      port: clk_tim4
    - instance: tim4
      port: clk
  tim4_cnt:
    - instance: tim4
      port: counter
    - instance: tim4_cc
      port: counter
      bits: 16
  tim4_ARR:
    - instance: tim4
      port: auto_reload
    - instance: tim4_cc
      port: auto_reload
      bits: 16
  tim4_PSC:
    - instance: tim4
      port: prescaler
    - instance: tim4_cc
      port: prescaler
      bits: 16
  tim4_CCR1:
    - instance: tim4
      port: ccr1
    - instance: tim4_cc
      port: ccr1
      bits: 16
  tim4_CCR2:
    - instance: tim4
      port: ccr2
    - instance: tim4_cc
      port: ccr2
      bits: 16
  tim4_CCR3:
    - instance: tim4
      port: ccr3
    - instance: tim4_cc
      port: ccr3
      bits: 16
  tim4_CCR4:
    - instance: tim4
      port: ccr4
    - instance: tim4_cc
      port: ccr4
      bits: 16
  tim4_CH1:
    - instance: tim4_ch1
      port: io
    - instance: tim4_cc
      port: ch1
  tim4_CH2:
    - instance: tim4_ch2
      port: io
    - instance: tim4_cc
      port: ch2
  tim4_CH3:
    - instance: tim4_ch3
      port: io
    - instance: tim4_cc
      port: ch3
  tim4_CH4:
    - instance: tim4_ch4
      port: io
    - instance: tim4_cc
      port: ch4
  tim4_ETR:
    - instance: tim4_etr
      port: io
    - instance: tim4_cc
      port: etr
  tim4_TRGO:
    - instance: tim4_cc
      port: trgo
    - instance: trigger_router
      port: tim4_trgo
  tim4_UP:
    - instance: tim4_cc
      port: update
    - instance: interrupt_tim4
      port: update
  tim4_CC1:
    - instance: tim4_cc
      port: cc1
    - instance: interrupt_tim4
      port: cc1
  tim4_CC2:
    - instance: tim4_cc
      port: cc2
    - instance: interrupt_tim4
      port: cc2
  tim4_CC3:
    - instance: tim4_cc
      port: cc3
    - instance: interrupt_tim4
      port: cc3
  tim4_CC4:
    - instance: tim4_cc
      port: cc4
    - instance: interrupt_tim4
      port: cc4
  tim4_DMA_CH1:
    - instance: tim4_cc
      port: dma_ch1
    - instance: dma_tim4_ch1
      port: request
  tim4_DMA_CH2:
    - instance: tim4_cc
      port: dma_ch2
    - instance: dma_tim4_ch2
      port: request
  tim4_DMA_CH3:
    - instance: tim4_cc
      port: dma_ch3
    - instance: dma_tim4_ch3
      port: request
  tim4_DMA_CH4:
    - instance: tim4_cc
      port: dma_ch4
    - instance: dma_tim4_ch4
      port: request
  tim4_DMA_UP:
    - instance: tim4_cc
      port: dma_update
    - instance: dma_tim4_up
      port: request
  
  tim5_clk:
    - instance: clk_divider
      port: clk_tim5
    - instance: tim5
      port: clk
  tim5_cnt:
    - instance: tim5
      port: counter
    - instance: tim5_cc
      port: counter
      bits: 32
  tim5_ARR:
    - instance: tim5
      port: auto_reload
    - instance: tim5_cc
      port: auto_reload
      bits: 32
  tim5_PSC:
    - instance: tim5
      port: prescaler
    - instance: tim5_cc
      port: prescaler
      bits: 16
  tim5_CCR1:
    - instance: tim5
      port: ccr1
    - instance: tim5_cc
      port: ccr1
      bits: 32
  tim5_CCR2:
    - instance: tim5
      port: ccr2
    - instance: tim5_cc
      port: ccr2
      bits: 32
  tim5_CCR3:
    - instance: tim5
      port: ccr3
    - instance: tim5_cc
      port: ccr3
      bits: 32
  tim5_CCR4:
    - instance: tim5
      port: ccr4
    - instance: tim5_cc
      port: ccr4
      bits: 32
  tim5_CH1:
    - instance: tim5_ch1
      port: io
    - instance: tim5_cc
      port: ch1
  tim5_CH2:
    - instance: tim5_ch2
      port: io
    - instance: tim5_cc
      port: ch2
  tim5_CH3:
    - instance: tim5_ch3
      port: io
    - instance: tim5_cc
      port: ch3
  tim5_CH4:
    - instance: tim5_ch4
      port: io
    - instance: tim5_cc
      port: ch4
  tim5_ETR:
    - instance: tim5_etr
      port: io
    - instance: tim5_cc
      port: etr
  tim5_TRGO:
    - instance: tim5_cc
      port: trgo
    - instance: trigger_router
      port: tim5_trgo
  tim5_UP:
    - instance: tim5_cc
      port: update
    - instance: interrupt_tim5
      port: update
  tim5_CC1:
    - instance: tim5_cc
      port: cc1
    - instance: interrupt_tim5
      port: cc1
  tim5_CC2:
    - instance: tim5_cc
      port: cc2
    - instance: interrupt_tim5
      port: cc2
  tim5_CC3:
    - instance: tim5_cc
      port: cc3
    - instance: interrupt_tim5
      port: cc3
  tim5_CC4:
    - instance: tim5_cc
      port: cc4
    - instance: interrupt_tim5
      port: cc4
  tim5_DMA_CH1:
    - instance: tim5_cc
      port: dma_ch1
    - instance: dma_tim5_ch1
      port: request
  tim5_DMA_CH2:
    - instance: tim5_cc
      port: dma_ch2
    - instance: dma_tim5_ch2
      port: request
  tim5_DMA_CH3:
    - instance: tim5_cc
      port: dma_ch3
    - instance: dma_tim5_ch3
      port: request
  tim5_DMA_CH4:
    - instance: tim5_cc
      port: dma_ch4
    - instance: dma_tim5_ch4
      port: request
  tim5_DMA_UP:
    - instance: tim5_cc
      port: dma_update
    - instance: dma_tim5_up
      port: request
  
  # Basic Timers (TIM6, TIM7)
  tim6_clk:
    - instance: clk_divider
      port: clk_tim6
    - instance: tim6
      port: clk
  tim6_cnt:
    - instance: tim6
      port: counter
    - instance: tim6_base
      port: counter
      bits: 16
  tim6_ARR:
    - instance: tim6
      port: auto_reload
    - instance: tim6_base
      port: auto_reload
      bits: 16
  tim6_PSC:
    - instance: tim6
      port: prescaler
    - instance: tim6_base
      port: prescaler
      bits: 16
  tim6_TRGO:
    - instance: tim6_base
      port: trgo
    - instance: trigger_router
      port: tim6_trgo
  tim6_UP:
    - instance: tim6_base
      port: update
    - instance: interrupt_tim6
      port: update
  tim6_DMA_UP:
    - instance: tim6_base
      port: dma_update
    - instance: dma_tim6_up
      port: request
  
  tim7_clk:
    - instance: clk_divider
      port: clk_tim7
    - instance: tim7
      port: clk
  tim7_cnt:
    - instance: tim7
      port: counter
    - instance: tim7_base
      port: counter
      bits: 16
  tim7_ARR:
    - instance: tim7
      port: auto_reload
    - instance: tim7_base
      port: auto_reload
      bits: 16
  tim7_PSC:
    - instance: tim7
      port: prescaler
    - instance: tim7_base
      port: prescaler
      bits: 16
  tim7_TRGO:
    - instance: tim7_base
      port: trgo
    - instance: trigger_router
      port: tim7_trgo
  tim7_UP:
    - instance: tim7_base
      port: update
    - instance: interrupt_tim7
      port: update
  tim7_DMA_UP:
    - instance: tim7_base
      port: dma_update
    - instance: dma_tim7_up
      port: request
  
  # Low-power Timer (LPTIM1, LPTIM2)
  lptim1_clk:
    - instance: clk_divider
      port: clk_lptim1
    - instance: lptim1
      port: clk
  lptim1_cnt:
    - instance: lptim1
      port: counter
    - instance: lptim1_cc
      port: counter
      bits: 16
  lptim1_ARR:
    - instance: lptim1
      port: auto_reload
    - instance: lptim1_cc
      port: auto_reload
      bits: 16
  lptim1_CMP:
    - instance: lptim1
      port: compare
    - instance: lptim1_cc
      port: compare
      bits: 16
  lptim1_OUT:
    - instance: lptim1_cc
      port: output
    - instance: lptim1_out
      port: io
  lptim1_ETR:
    - instance: lptim1_etr
      port: io
    - instance: lptim1_cc
      port: etr
  lptim1_IN1:
    - instance: lptim1_in1
      port: io
    - instance: lptim1_cc
      port: in1
  lptim1_IN2:
    - instance: lptim1_in2
      port: io
    - instance: lptim1_cc
      port: in2
  lptim1_ARRM:
    - instance: lptim1_cc
      port: arrm
    - instance: interrupt_lptim1
      port: arrm
  lptim1_CMPM:
    - instance: lptim1_cc
      port: cmpm
    - instance: interrupt_lptim1
      port: cmpm
    EXTTRIG: { link: [lptim1_cc.ext_trig, interrupt_lptim1.ext_trig] }
    ARRMCF:  { link: [lptim1_cc.arrmcf, interrupt_lptim1.arrmcf] }
    CMPMCF:  { link: [lptim1_cc.cmpmcf, interrupt_lptim1.cmpmcf] }
  
  lptim2:
    clk:     { link: [clk_divider.clk_lptim2, lptim2.clk] }
    cnt:     { link: [lptim2.counter, lptim2_cc.counter], width: 16 }
    ARR:     { link: [lptim2.auto_reload, lptim2_cc.auto_reload], width: 16 }
    CMP:     { link: [lptim2.compare, lptim2_cc.compare], width: 16 }
    OUT:     { link: [lptim2_cc.output, lptim2_out.io] }
    ETR:     { link: [lptim2_etr.io, lptim2_cc.etr] }
    IN1:     { link: [lptim2_in1.io, lptim2_cc.in1] }
    IN2:     { link: [lptim2_in2.io, lptim2_cc.in2] }
    ARRM:    { link: [lptim2_cc.arrm, interrupt_lptim2.arrm] }
    CMPM:    { link: [lptim2_cc.cmpm, interrupt_lptim2.cmpm] }
    EXTTRIG: { link: [lptim2_cc.ext_trig, interrupt_lptim2.ext_trig] }
    ARRMCF:  { link: [lptim2_cc.arrmcf, interrupt_lptim2.arrmcf] }
    CMPMCF:  { link: [lptim2_cc.cmpmcf, interrupt_lptim2.cmpmcf] }
  
  # High-resolution Timer (HRTIM)
  hrtim_clk: { link: [clk_divider.clk_hrtim, hrtim.clk] }
  hrtim_MASTER_CNT: { link: [hrtim.master_counter, hrtim_master.counter], width: 16 }
  hrtim_MASTER_PER: { link: [hrtim.master_period, hrtim_master.period], width: 16 }
  hrtim_MASTER_CMP: { link: [hrtim.master_compare, hrtim_master.compare], width: 16 }
  hrtim_TA1_OUT: { link: [hrtim_ta1.cc1, hrtim_ta1_out.io] }
  hrtim_TA2_OUT: { link: [hrtim_ta2.cc2, hrtim_ta2_out.io] }
  hrtim_TB1_OUT: { link: [hrtim_tb1.cc1, hrtim_tb1_out.io] }
  hrtim_TB2_OUT: { link: [hrtim_tb2.cc2, hrtim_tb2_out.io] }
  hrtim_TC1_OUT: { link: [hrtim_tc1.cc1, hrtim_tc1_out.io] }
  hrtim_TC2_OUT: { link: [hrtim_tc2.cc2, hrtim_tc2_out.io] }
  hrtim_TD1_OUT: { link: [hrtim_td1.cc1, hrtim_td1_out.io] }
  hrtim_TD2_OUT: { link: [hrtim_td2.cc2, hrtim_td2_out.io] }
  hrtim_TE1_OUT: { link: [hrtim_te1.cc1, hrtim_te1_out.io] }
  hrtim_TE2_OUT: { link: [hrtim_te2.cc2, hrtim_te2_out.io] }
  hrtim_SCOUT: { link: [hrtim.scout, hrtim_scout.io] }
  hrtim_SCIN: { link: [hrtim_scin.io, hrtim.scin] }
  hrtim_FLT1: { link: [hrtim_flt1.io, hrtim.flt1] }
  hrtim_FLT2: { link: [hrtim_flt2.io, hrtim.flt2] }
  hrtim_FLT3: { link: [hrtim_flt3.io, hrtim.flt3] }
  hrtim_FLT4: { link: [hrtim_flt4.io, hrtim.flt4] }
  hrtim_FLT5: { link: [hrtim_flt5.io, hrtim.flt5] }
  hrtim_SYSFLT: { link: [hrtim.sys_flt, interrupt_hrtim.sys_flt] }
  hrtim_MASTER: { link: [hrtim_master.interrupt, interrupt_hrtim.master] }
  hrtim_TA: { link: [hrtim_ta.interrupt, interrupt_hrtim.ta] }
  hrtim_TB: { link: [hrtim_tb.interrupt, interrupt_hrtim.tb] }
  hrtim_TC: { link: [hrtim_tc.interrupt, interrupt_hrtim.tc] }
  hrtim_TD: { link: [hrtim_td.interrupt, interrupt_hrtim.td] }
  hrtim_TE: { link: [hrtim_te.interrupt, interrupt_hrtim.te] }
  hrtim_DLLRDY: { link: [hrtim.dll_ready, interrupt_hrtim.dll_rdy] }
  hrtim_BMPER: { link: [hrtim.bmper, interrupt_hrtim.bmper] }
  
  # System Time Base (SYSTICK)
  systick_clk: { link: [clk_divider.clk_systick, systick.clk] }
  systick_cnt: { link: [systick.counter, systick_ctrl.counter], width: 24 }
  systick_RELOAD: { link: [systick.reload, systick_ctrl.reload], width: 24 }
  systick_FLAG: { link: [systick_ctrl.flag, interrupt_systick.flag] }
  systick_CALIB: { link: [systick_calib.out, systick_ctrl.calib], width: 24 }
  
  # Independent Watchdog (IWDG)
  iwdg_clk: { link: [clk_divider.clk_lsi, iwdg.clk] }
  iwdg_CNT: { link: [iwdg.counter, iwdg_ctrl.counter], width: 12 }
  iwdg_RLR: { link: [iwdg.reload, iwdg_ctrl.reload], width: 12 }
  iwdg_KR: { link: [iwdg_key.out, iwdg_ctrl.key], width: 16 }
  iwdG_PR: { link: [iwdg_prescaler.out, iwdg_ctrl.prescaler], width: 3 }
  iwdg_WINR: { link: [iwdg.window, iwdg_ctrl.window], width: 12 }
  iwdg_EWI: { link: [iwdg_ctrl.early_wakeup, interrupt_iwdg.early] }
  iwdg_RST: { link: [iwdg_ctrl.reset_out, rst_iwdg.in] }
  
  # Window Watchdog (WWDG)
  wwdg_clk: { link: [clk_divider.clk_apb, wwdg.clk] }
  wwdg_CNT: { link: [wwdg.counter, wwdg_ctrl.counter], width: 7 }
  wwdg_WDG: { link: [wwdg.window, wwdg_ctrl.window], width: 7 }
  wwdg_CR: { link: [wwdg_ctrl.control, wwdg.control], width: 32 }
  wwdg_CFGR: { link: [wwdg_config.out, wwdg_ctrl.config], width: 32 }
  wwdg_EWI: { link: [wwdg_ctrl.early_wakeup, interrupt_wwdg.early] }
  wwdg_RST: { link: [wwdg_ctrl.reset_out, rst_wwdg.in] }
  
  # RTC Time Base
  rtc_clk: { link: [clk_divider.clk_rtc, rtc.clk] }
  rtc_TR: { link: [rtc.time, rtc_alarm.time], width: 32 }
  rtc_DR: { link: [rtc.date, rtc_alarm.date], width: 32 }
  rtc_SSR: { link: [rtc.subsec, rtc_alarm.subsec], width: 16 }
  rtc_PRER: { link: [rtc_prescaler.out, rtc.prescaler], width: 20 }
  rtc_WUTR: { link: [rtc_wakeup.reload, rtc_alarm.wakeup_reload], width: 16 }
  rtc_WUCKSEL: { link: [rtc_wakeup.clock_sel, rtc_alarm.wakeup_clk], width: 3 }
  rtc_ALRMAR: { link: [rtc_alarm.alarm_a, rtc.alarm_a], width: 32 }
  rtc_ALRMBR: { link: [rtc_alarm.alarm_b, rtc.alarm_b], width: 32 }
  rtc_TS: { link: [rtc.time_stamp, rtc_alarm.time_stamp], width: 32 }
  rtc_TAMP: { link: [rtc_tamper.detect, rtc_alarm.tamper], width: 2 }
  rtc_WUT: { link: [rtc_alarm.wakeup, interrupt_rtc.wakeup] }
  rtc_ALRA: { link: [rtc_alarm.alarm_a_trig, interrupt_rtc.alarm_a] }
  rtc_ALRB: { link: [rtc_alarm.alarm_b_trig, interrupt_rtc.alarm_b] }
  rtc_TSIF: { link: [rtc_alarm.time_stamp_trig, interrupt_rtc.time_stamp] }
  rtc_TAMP1: { link: [rtc_tamper.tamper1, interrupt_rtc.tamper1] }
  rtc_TAMP2: { link: [rtc_tamper.tamper2, interrupt_rtc.tamper2] }
  rtc_TSOV: { link: [rtc_alarm.time_stamp_ovr, interrupt_rtc.time_stamp_ovr] }
  rtc_ITSE: { link: [rtc_alarm.time_stamp_en, rtc.time_stamp_en] }
  rtc_REFCLKON: { link: [rtc_ctrl.refclk_on, rtc.refclk_on] }
  rtc_TAMP1E: { link: [rtc_tamper.tamper1_en, rtc.tamper1_en] }
  rtc_TAMP2E: { link: [rtc_tamper.tamper2_en, rtc.tamper2_en] }

bus:
  # Timer APB Configuration Bus
  timer_apb:
    - instance: instance.apb_interconnect
      port: timer_master
    - instance: instance.tim1_cfg
      port: apb_slave
    - instance: instance.tim2_cfg
      port: apb_slave
    - instance: instance.tim3_cfg
      port: apb_slave
    - instance: instance.tim4_cfg
      port: apb_slave
    - instance: instance.tim5_cfg
      port: apb_slave
    - instance: instance.tim6_cfg
      port: apb_slave
    - instance: instance.tim7_cfg
      port: apb_slave
    - instance: instance.tim8_cfg
      port: apb_slave
    - instance: instance.tim12_cfg
      port: apb_slave
    - instance: instance.tim13_cfg
      port: apb_slave
    - instance: instance.tim14_cfg
      port: apb_slave
    - instance: instance.tim15_cfg
      port: apb_slave
    - instance: instance.tim16_cfg
      port: apb_slave
    - instance: instance.tim17_cfg
      port: apb_slave
  
  # LPTIM APB Configuration Bus
  lptim_apb:
    - instance: instance.apb_interconnect
      port: lptim_master
    - instance: instance.lptim1_cfg
      port: apb_slave
    - instance: instance.lptim2_cfg
      port: apb_slave
  
  # HRTIM APB Configuration Bus
  hrtim_apb:
    - instance: instance.apb_interconnect
      port: hrtim_master
    - instance: instance.hrtim_cfg
      port: apb_slave

comb:
  # Timer system status
  timer_ready: { expr: "tim1_ready & tim2_ready & tim3_ready & tim4_ready & tim5_ready & tim6_ready & tim7_ready & tim8_ready" }
  tim1_ready:  { expr: "tim1.ready & tim1_cfg.ready" }
  tim2_ready:  { expr: "tim2.ready & tim2_cfg.ready" }
  tim3_ready:  { expr: "tim3.ready & tim3_cfg.ready" }
  tim4_ready:  { expr: "tim4.ready & tim4_cfg.ready" }
  tim5_ready:  { expr: "tim5.ready & tim5_cfg.ready" }
  tim6_ready:  { expr: "tim6.ready & tim6_cfg.ready" }
  tim7_ready:  { expr: "tim7.ready & tim7_cfg.ready" }
  tim8_ready:  { expr: "tim8.ready & tim8_cfg.ready" }
  
  # Low-power timer status
  lptim_ready: { expr: "lptim1_ready & lptim2_ready" }
  lptim1_ready: { expr: "lptim1.ready & lptim1_cfg.ready" }
  lptim2_ready: { expr: "lptim2.ready & lptim2_cfg.ready" }
  
  # High-resolution timer status
  hrtim_ready: { expr: "hrtim.ready & hrtim_cfg.ready & hrtim_dll_ready" }
  hrtim_dll_ready: { expr: "hrtim.dll_ready" }
  
  # Watchdog status
  wdg_status: { expr: "{iwdg_active, wwdg_active, wdg_timeout}" }
  iwdg_active: { expr: "iwdg.enable" }
  wwdg_active: { expr: "wwdg.enable" }
  wdg_timeout: { expr: "iwdg.timeout | wwdg.timeout" }
  
  # RTC status
  rtc_ready: { expr: "rtc.ready & rtc_init.done" }
  rtc_init_done: { expr: "rtc_init.done" }
  rtc_sync: { expr: "rtc.sync_done" }
  
  # Trigger routing status
  trigger_status: { expr: "{tim1_trgo, tim2_trgo, tim3_trgo, tim4_trgo, tim5_trgo, tim6_trgo, tim7_trgo, tim8_trgo}" }
  tim1_trgo: { expr: "trigger_router.tim1_trgo_active" }
  tim2_trgo: { expr: "trigger_router.tim2_trgo_active" }
  tim3_trgo: { expr: "trigger_router.tim3_trgo_active" }
  tim4_trgo: { expr: "trigger_router.tim4_trgo_active" }
  tim5_trgo: { expr: "trigger_router.tim5_trgo_active" }
  tim6_trgo: { expr: "trigger_router.tim6_trgo_active" }
  tim7_trgo: { expr: "trigger_router.tim7_trgo_active" }
  tim8_trgo: { expr: "trigger_router.tim8_trgo_active" }


# Part 6: DMA and Interrupt System
  # MDMA Controller
  mdma_ch0_req: { link: [mdma_ch0.request, mdma_controller.ch0_req] }
  mdma_ch0_ack: { link: [mdma_controller.ch0_ack, mdma_ch0.ack] }
  mdma_ch0_data: { link: [mdma_ch0.data, mdma_controller.ch0_data], width: 32 }
  mdma_ch0_addr: { link: [mdma_ch0.addr, mdma_controller.ch0_addr], width: 32 }
  mdma_ch0_ctrl: { link: [mdma_ch0.control, mdma_controller.ch0_ctrl], width: 32 }
  mdma_ch0_stat: { link: [mdma_controller.ch0_stat, mdma_ch0.status], width: 32 }
  mdma_ch0_int: { link: [mdma_controller.ch0_int, interrupt_mdma.ch0] }
  mdma_ch0_tfr: { link: [mdma_controller.ch0_tfr, interrupt_mdma.ch0_tfr] }
  mdma_ch0_blk: { link: [mdma_controller.ch0_blk, interrupt_mdma.ch0_blk] }
  mdma_ch0_suspn: { link: [mdma_controller.ch0_suspn, interrupt_mdma.ch0_suspn] }
  
  mdma_ch1_req:
    - instance: mdma_ch1
      port: request
    - instance: mdma_controller
      port: ch1_req
  mdma_ch1_ack:
    - instance: mdma_controller
      port: ch1_ack
    - instance: mdma_ch1
      port: ack
  mdma_ch1_data:
    - instance: mdma_ch1
      port: data
    - instance: mdma_controller
      port: ch1_data
      bits: 32
  mdma_ch1_addr:
    - instance: mdma_ch1
      port: addr
    - instance: mdma_controller
      port: ch1_addr
      bits: 32
  mdma_ch1_ctrl:
    - instance: mdma_ch1
      port: control
    - instance: mdma_controller
      port: ch1_ctrl
      bits: 32
  mdma_ch1_stat:
    - instance: mdma_controller
      port: ch1_stat
    - instance: mdma_ch1
      port: status
      bits: 32
  mdma_ch1_int:
    - instance: mdma_controller
      port: ch1_int
    - instance: interrupt_mdma
      port: ch1
  mdma_ch1_tfr:
    - instance: mdma_controller
      port: ch1_tfr
    - instance: interrupt_mdma
      port: ch1_tfr
  mdma_ch1_blk:
    - instance: mdma_controller
      port: ch1_blk
    - instance: interrupt_mdma
      port: ch1_blk
  mdma_ch1_suspn:
    - instance: mdma_controller
      port: ch1_suspn
    - instance: interrupt_mdma
      port: ch1_suspn
  
  mdma_ch2_req:
    - instance: mdma_ch2
      port: request
    - instance: mdma_controller
      port: ch2_req
  mdma_ch2_ack:
    - instance: mdma_controller
      port: ch2_ack
    - instance: mdma_ch2
      port: ack
  mdma_ch2_data:
    - instance: mdma_ch2
      port: data
    - instance: mdma_controller
      port: ch2_data
      bits: 32
  mdma_ch2_addr:
    - instance: mdma_ch2
      port: addr
    - instance: mdma_controller
      port: ch2_addr
      bits: 32
  mdma_ch2_ctrl:
    - instance: mdma_ch2
      port: control
    - instance: mdma_controller
      port: ch2_ctrl
      bits: 32
  mdma_ch2_stat:
    - instance: mdma_controller
      port: ch2_stat
    - instance: mdma_ch2
      port: status
      bits: 32
  mdma_ch2_int:
    - instance: mdma_controller
      port: ch2_int
    - instance: interrupt_mdma
      port: ch2
  mdma_ch2_tfr:
    - instance: mdma_controller
      port: ch2_tfr
    - instance: interrupt_mdma
      port: ch2_tfr
  mdma_ch2_blk:
    - instance: mdma_controller
      port: ch2_blk
    - instance: interrupt_mdma
      port: ch2_blk
  mdma_ch2_suspn:
    - instance: mdma_controller
      port: ch2_suspn
    - instance: interrupt_mdma
      port: ch2_suspn
  
  mdma_ch3_req:
    - instance: mdma_ch3
      port: request
    - instance: mdma_controller
      port: ch3_req
  mdma_ch3_ack:
    - instance: mdma_controller
      port: ch3_ack
    - instance: mdma_ch3
      port: ack
  mdma_ch3_data:
    - instance: mdma_ch3
      port: data
    - instance: mdma_controller
      port: ch3_data
      bits: 32
  mdma_ch3_addr:
    - instance: mdma_ch3
      port: addr
    - instance: mdma_controller
      port: ch3_addr
      bits: 32
  mdma_ch3_ctrl:
    - instance: mdma_ch3
      port: control
    - instance: mdma_controller
      port: ch3_ctrl
      bits: 32
  mdma_ch3_stat:
    - instance: mdma_controller
      port: ch3_stat
    - instance: mdma_ch3
      port: status
      bits: 32
  mdma_ch3_int:
    - instance: mdma_controller
      port: ch3_int
    - instance: interrupt_mdma
      port: ch3
  mdma_ch3_tfr:
    - instance: mdma_controller
      port: ch3_tfr
    - instance: interrupt_mdma
      port: ch3_tfr
  mdma_ch3_blk:
    - instance: mdma_controller
      port: ch3_blk
    - instance: interrupt_mdma
      port: ch3_blk
  mdma_ch3_suspn:
    - instance: mdma_controller
      port: ch3_suspn
    - instance: interrupt_mdma
      port: ch3_suspn
  
  # DMA1 Controller
  dma1_ch0_req:
    - instance: dma1_ch0
      port: request
    - instance: dma1_controller
      port: ch0_req
  dma1_ch0_ack:
    - instance: dma1_controller
      port: ch0_ack
    - instance: dma1_ch0
      port: ack
  dma1_ch0_data:
    - instance: dma1_ch0
      port: data
    - instance: dma1_controller
      port: ch0_data
      bits: 16
  dma1_ch0_addr:
    - instance: dma1_ch0
      port: addr
    - instance: dma1_controller
      port: ch0_addr
      bits: 16
  dma1_ch0_ctrl:
    - instance: dma1_ch0
      port: control
    - instance: dma1_controller
      port: ch0_ctrl
      bits: 32
  dma1_ch0_stat:
    - instance: dma1_controller
      port: ch0_stat
    - instance: dma1_ch0
      port: status
      bits: 32
  dma1_ch0_int:
    - instance: dma1_controller
      port: ch0_int
    - instance: interrupt_dma1
      port: ch0
  dma1_ch0_ht:
    - instance: dma1_controller
      port: ch0_ht
    - instance: interrupt_dma1
      port: ch0_ht
  dma1_ch0_tc:
    - instance: dma1_controller
      port: ch0_tc
    - instance: interrupt_dma1
      port: ch0_tc
  dma1_ch1_req:
    - instance: dma1_ch1
      port: request
    - instance: dma1_controller
      port: ch1_req
  dma1_ch1_ack:
    - instance: dma1_controller
      port: ch1_ack
    - instance: dma1_ch1
      port: ack
  dma1_ch1_data:
    - instance: dma1_ch1
      port: data
    - instance: dma1_controller
      port: ch1_data
      bits: 16
  dma1_ch1_addr:
    - instance: dma1_ch1
      port: addr
    - instance: dma1_controller
      port: ch1_addr
      bits: 16
  dma1_ch1_ctrl:
    - instance: dma1_ch1
      port: control
    - instance: dma1_controller
      port: ch1_ctrl
      bits: 32
  dma1_ch1_stat:
    - instance: dma1_controller
      port: ch1_stat
    - instance: dma1_ch1
      port: status
      bits: 32
  dma1_ch1_int:
    - instance: dma1_controller
      port: ch1_int
    - instance: interrupt_dma1
      port: ch1
  dma1_ch1_ht:
    - instance: dma1_controller
      port: ch1_ht
    - instance: interrupt_dma1
      port: ch1_ht
  dma1_ch1_tc:
    - instance: dma1_controller
      port: ch1_tc
    - instance: interrupt_dma1
      port: ch1_tc
  dma1_ch2_req:
    - instance: dma1_ch2
      port: request
    - instance: dma1_controller
      port: ch2_req
  dma1_ch2_ack:
    - instance: dma1_controller
      port: ch2_ack
    - instance: dma1_ch2
      port: ack
  dma1_ch2_data:
    - instance: dma1_ch2
      port: data
    - instance: dma1_controller
      port: ch2_data
      bits: 16
  dma1_ch2_addr:
    - instance: dma1_ch2
      port: addr
    - instance: dma1_controller
      port: ch2_addr
      bits: 16
  dma1_ch2_ctrl:
    - instance: dma1_ch2
      port: control
    - instance: dma1_controller
      port: ch2_ctrl
      bits: 32
  dma1_ch2_stat:
    - instance: dma1_controller
      port: ch2_stat
    - instance: dma1_ch2
      port: status
      bits: 32
  dma1_ch2_int:
    - instance: dma1_controller
      port: ch2_int
    - instance: interrupt_dma1
      port: ch2
  dma1_ch2_ht:
    - instance: dma1_controller
      port: ch2_ht
    - instance: interrupt_dma1
      port: ch2_ht
  dma1_ch2_tc:
    - instance: dma1_controller
      port: ch2_tc
    - instance: interrupt_dma1
      port: ch2_tc
  dma1_ch3_req:
    - instance: dma1_ch3
      port: request
    - instance: dma1_controller
      port: ch3_req
  dma1_ch3_ack:
    - instance: dma1_controller
      port: ch3_ack
    - instance: dma1_ch3
      port: ack
  dma1_ch3_data:
    - instance: dma1_ch3
      port: data
    - instance: dma1_controller
      port: ch3_data
      bits: 16
  dma1_ch3_addr:
    - instance: dma1_ch3
      port: addr
    - instance: dma1_controller
      port: ch3_addr
      bits: 16
  dma1_ch3_ctrl:
    - instance: dma1_ch3
      port: control
    - instance: dma1_controller
      port: ch3_ctrl
      bits: 32
  dma1_ch3_stat:
    - instance: dma1_controller
      port: ch3_stat
    - instance: dma1_ch3
      port: status
      bits: 32
  dma1_ch3_int:
    - instance: dma1_controller
      port: ch3_int
    - instance: interrupt_dma1
      port: ch3
  dma1_ch3_ht:
    - instance: dma1_controller
      port: ch3_ht
    - instance: interrupt_dma1
      port: ch3_ht
  dma1_ch3_tc:
    - instance: dma1_controller
      port: ch3_tc
    - instance: interrupt_dma1
      port: ch3_tc
  dma1_ch4_req:
    - instance: dma1_ch4
      port: request
    - instance: dma1_controller
      port: ch4_req
  dma1_ch4_ack:
    - instance: dma1_controller
      port: ch4_ack
    - instance: dma1_ch4
      port: ack
  dma1_ch4_data:
    - instance: dma1_ch4
      port: data
    - instance: dma1_controller
      port: ch4_data
      bits: 16
  dma1_ch4_addr:
    - instance: dma1_ch4
      port: addr
    - instance: dma1_controller
      port: ch4_addr
      bits: 16
  dma1_ch4_ctrl:
    - instance: dma1_ch4
      port: control
    - instance: dma1_controller
      port: ch4_ctrl
      bits: 32
  dma1_ch4_stat:
    - instance: dma1_controller
      port: ch4_stat
    - instance: dma1_ch4
      port: status
      bits: 32
  dma1_ch4_int:
    - instance: dma1_controller
      port: ch4_int
    - instance: interrupt_dma1
      port: ch4
  dma1_ch4_ht:
    - instance: dma1_controller
      port: ch4_ht
    - instance: interrupt_dma1
      port: ch4_ht
  dma1_ch4_tc:
    - instance: dma1_controller
      port: ch4_tc
    - instance: interrupt_dma1
      port: ch4_tc
  dma1_ch5_req:
    - instance: dma1_ch5
      port: request
    - instance: dma1_controller
      port: ch5_req
  dma1_ch5_ack:
    - instance: dma1_controller
      port: ch5_ack
    - instance: dma1_ch5
      port: ack
  dma1_ch5_data:
    - instance: dma1_ch5
      port: data
    - instance: dma1_controller
      port: ch5_data
      bits: 16
  dma1_ch5_addr:
    - instance: dma1_ch5
      port: addr
    - instance: dma1_controller
      port: ch5_addr
      bits: 16
  dma1_ch5_ctrl:
    - instance: dma1_ch5
      port: control
    - instance: dma1_controller
      port: ch5_ctrl
      bits: 32
  dma1_ch5_stat:
    - instance: dma1_controller
      port: ch5_stat
    - instance: dma1_ch5
      port: status
      bits: 32
  dma1_ch5_int:
    - instance: dma1_controller
      port: ch5_int
    - instance: interrupt_dma1
      port: ch5
  dma1_ch5_ht:
    - instance: dma1_controller
      port: ch5_ht
    - instance: interrupt_dma1
      port: ch5_ht
  dma1_ch5_tc:
    - instance: dma1_controller
      port: ch5_tc
    - instance: interrupt_dma1
      port: ch5_tc
  dma1_ch6_req:
    - instance: dma1_ch6
      port: request
    - instance: dma1_controller
      port: ch6_req
  dma1_ch6_ack:
    - instance: dma1_controller
      port: ch6_ack
    - instance: dma1_ch6
      port: ack
  dma1_ch6_data:
    - instance: dma1_ch6
      port: data
    - instance: dma1_controller
      port: ch6_data
      bits: 16
  dma1_ch6_addr:
    - instance: dma1_ch6
      port: addr
    - instance: dma1_controller
      port: ch6_addr
      bits: 16
  dma1_ch6_ctrl:
    - instance: dma1_ch6
      port: control
    - instance: dma1_controller
      port: ch6_ctrl
      bits: 32
  dma1_ch6_stat:
    - instance: dma1_controller
      port: ch6_stat
    - instance: dma1_ch6
      port: status
      bits: 32
  dma1_ch6_int:
    - instance: dma1_controller
      port: ch6_int
    - instance: interrupt_dma1
      port: ch6
  dma1_ch6_ht:
    - instance: dma1_controller
      port: ch6_ht
    - instance: interrupt_dma1
      port: ch6_ht
  dma1_ch6_tc:
    - instance: dma1_controller
      port: ch6_tc
    - instance: interrupt_dma1
      port: ch6_tc
  dma1_ch7_req:
    - instance: dma1_ch7
      port: request
    - instance: dma1_controller
      port: ch7_req
  dma1_ch7_ack:
    - instance: dma1_controller
      port: ch7_ack
    - instance: dma1_ch7
      port: ack
  dma1_ch7_data:
    - instance: dma1_ch7
      port: data
    - instance: dma1_controller
      port: ch7_data
      bits: 16
  dma1_ch7_addr:
    - instance: dma1_ch7
      port: addr
    - instance: dma1_controller
      port: ch7_addr
      bits: 16
  dma1_ch7_ctrl:
    - instance: dma1_ch7
      port: control
    - instance: dma1_controller
      port: ch7_ctrl
      bits: 32
  dma1_ch7_stat:
    - instance: dma1_controller
      port: ch7_stat
    - instance: dma1_ch7
      port: status
      bits: 32
  dma1_ch7_int:
    - instance: dma1_controller
      port: ch7_int
    - instance: interrupt_dma1
      port: ch7
  dma1_ch7_ht:
    - instance: dma1_controller
      port: ch7_ht
    - instance: interrupt_dma1
      port: ch7_ht
  dma1_ch7_tc:
    - instance: dma1_controller
      port: ch7_tc
    - instance: interrupt_dma1
      port: ch7_tc
  # DMA2 Controller
  dma2_ch0_req:
    - instance: dma2_ch0
      port: request
    - instance: dma2_controller
      port: ch0_req
  dma2_ch0_ack:
    - instance: dma2_controller
      port: ch0_ack
    - instance: dma2_ch0
      port: ack
  dma2_ch0_data:
    - instance: dma2_ch0
      port: data
    - instance: dma2_controller
      port: ch0_data
      bits: 16
  dma2_ch0_addr:
    - instance: dma2_ch0
      port: addr
    - instance: dma2_controller
      port: ch0_addr
      bits: 16
  dma2_ch0_ctrl:
    - instance: dma2_ch0
      port: control
    - instance: dma2_controller
      port: ch0_ctrl
      bits: 32
  dma2_ch0_stat:
    - instance: dma2_controller
      port: ch0_stat
    - instance: dma2_ch0
      port: status
      bits: 32
  dma2_ch0_int:
    - instance: dma2_controller
      port: ch0_int
    - instance: interrupt_dma2
      port: ch0
  dma2_ch0_ht:
    - instance: dma2_controller
      port: ch0_ht
    - instance: interrupt_dma2
      port: ch0_ht
  dma2_ch0_tc:
    - instance: dma2_controller
      port: ch0_tc
    - instance: interrupt_dma2
      port: ch0_tc
  dma2_ch1_req:
    - instance: dma2_ch1
      port: request
    - instance: dma2_controller
      port: ch1_req
  dma2_ch1_ack:
    - instance: dma2_controller
      port: ch1_ack
    - instance: dma2_ch1
      port: ack
  dma2_ch1_data:
    - instance: dma2_ch1
      port: data
    - instance: dma2_controller
      port: ch1_data
      bits: 16
  dma2_ch1_addr:
    - instance: dma2_ch1
      port: addr
    - instance: dma2_controller
      port: ch1_addr
      bits: 16
  dma2_ch1_ctrl:
    - instance: dma2_ch1
      port: control
    - instance: dma2_controller
      port: ch1_ctrl
      bits: 32
  dma2_ch1_stat:
    - instance: dma2_controller
      port: ch1_stat
    - instance: dma2_ch1
      port: status
      bits: 32
  dma2_ch1_int:
    - instance: dma2_controller
      port: ch1_int
    - instance: interrupt_dma2
      port: ch1
  dma2_ch1_ht:
    - instance: dma2_controller
      port: ch1_ht
    - instance: interrupt_dma2
      port: ch1_ht
  dma2_ch1_tc:
    - instance: dma2_controller
      port: ch1_tc
    - instance: interrupt_dma2
      port: ch1_tc
  dma2_ch2_req:
    - instance: dma2_ch2
      port: request
    - instance: dma2_controller
      port: ch2_req
  dma2_ch2_ack:
    - instance: dma2_controller
      port: ch2_ack
    - instance: dma2_ch2
      port: ack
  dma2_ch2_data:
    - instance: dma2_ch2
      port: data
    - instance: dma2_controller
      port: ch2_data
      bits: 16
  dma2_ch2_addr:
    - instance: dma2_ch2
      port: addr
    - instance: dma2_controller
      port: ch2_addr
      bits: 16
  dma2_ch2_ctrl:
    - instance: dma2_ch2
      port: control
    - instance: dma2_controller
      port: ch2_ctrl
      bits: 32
  dma2_ch2_stat:
    - instance: dma2_controller
      port: ch2_stat
    - instance: dma2_ch2
      port: status
      bits: 32
  dma2_ch2_int:
    - instance: dma2_controller
      port: ch2_int
    - instance: interrupt_dma2
      port: ch2
  dma2_ch2_ht:
    - instance: dma2_controller
      port: ch2_ht
    - instance: interrupt_dma2
      port: ch2_ht
  dma2_ch2_tc:
    - instance: dma2_controller
      port: ch2_tc
    - instance: interrupt_dma2
      port: ch2_tc
  dma2_ch3_req:
    - instance: dma2_ch3
      port: request
    - instance: dma2_controller
      port: ch3_req
  dma2_ch3_ack:
    - instance: dma2_controller
      port: ch3_ack
    - instance: dma2_ch3
      port: ack
  dma2_ch3_data:
    - instance: dma2_ch3
      port: data
    - instance: dma2_controller
      port: ch3_data
      bits: 16
  dma2_ch3_addr:
    - instance: dma2_ch3
      port: addr
    - instance: dma2_controller
      port: ch3_addr
      bits: 16
  dma2_ch3_ctrl:
    - instance: dma2_ch3
      port: control
    - instance: dma2_controller
      port: ch3_ctrl
      bits: 32
  dma2_ch3_stat:
    - instance: dma2_controller
      port: ch3_stat
    - instance: dma2_ch3
      port: status
      bits: 32
  dma2_ch3_int:
    - instance: dma2_controller
      port: ch3_int
    - instance: interrupt_dma2
      port: ch3
  dma2_ch3_ht:
    - instance: dma2_controller
      port: ch3_ht
    - instance: interrupt_dma2
      port: ch3_ht
  dma2_ch3_tc:
    - instance: dma2_controller
      port: ch3_tc
    - instance: interrupt_dma2
      port: ch3_tc
  dma2_ch4_req:
    - instance: dma2_ch4
      port: request
    - instance: dma2_controller
      port: ch4_req
  dma2_ch4_ack:
    - instance: dma2_controller
      port: ch4_ack
    - instance: dma2_ch4
      port: ack
  dma2_ch4_data:
    - instance: dma2_ch4
      port: data
    - instance: dma2_controller
      port: ch4_data
      bits: 16
  dma2_ch4_addr:
    - instance: dma2_ch4
      port: addr
    - instance: dma2_controller
      port: ch4_addr
      bits: 16
  dma2_ch4_ctrl:
    - instance: dma2_ch4
      port: control
    - instance: dma2_controller
      port: ch4_ctrl
      bits: 32
  dma2_ch4_stat:
    - instance: dma2_controller
      port: ch4_stat
    - instance: dma2_ch4
      port: status
      bits: 32
  dma2_ch4_int:
    - instance: dma2_controller
      port: ch4_int
    - instance: interrupt_dma2
      port: ch4
  dma2_ch4_ht:
    - instance: dma2_controller
      port: ch4_ht
    - instance: interrupt_dma2
      port: ch4_ht
  dma2_ch4_tc:
    - instance: dma2_controller
      port: ch4_tc
    - instance: interrupt_dma2
      port: ch4_tc
  dma2_ch5_req:
    - instance: dma2_ch5
      port: request
    - instance: dma2_controller
      port: ch5_req
  dma2_ch5_ack:
    - instance: dma2_controller
      port: ch5_ack
    - instance: dma2_ch5
      port: ack
  dma2_ch5_data:
    - instance: dma2_ch5
      port: data
    - instance: dma2_controller
      port: ch5_data
      bits: 16
  dma2_ch5_addr:
    - instance: dma2_ch5
      port: addr
    - instance: dma2_controller
      port: ch5_addr
      bits: 16
  dma2_ch5_ctrl:
    - instance: dma2_ch5
      port: control
    - instance: dma2_controller
      port: ch5_ctrl
      bits: 32
  dma2_ch5_stat:
    - instance: dma2_controller
      port: ch5_stat
    - instance: dma2_ch5
      port: status
      bits: 32
  dma2_ch5_int:
    - instance: dma2_controller
      port: ch5_int
    - instance: interrupt_dma2
      port: ch5
  dma2_ch5_ht:
    - instance: dma2_controller
      port: ch5_ht
    - instance: interrupt_dma2
      port: ch5_ht
  dma2_ch5_tc:
    - instance: dma2_controller
      port: ch5_tc
    - instance: interrupt_dma2
      port: ch5_tc
  dma2_ch6_req:
    - instance: dma2_ch6
      port: request
    - instance: dma2_controller
      port: ch6_req
  dma2_ch6_ack:
    - instance: dma2_controller
      port: ch6_ack
    - instance: dma2_ch6
      port: ack
  dma2_ch6_data:
    - instance: dma2_ch6
      port: data
    - instance: dma2_controller
      port: ch6_data
      bits: 16
  dma2_ch6_addr:
    - instance: dma2_ch6
      port: addr
    - instance: dma2_controller
      port: ch6_addr
      bits: 16
  dma2_ch6_ctrl:
    - instance: dma2_ch6
      port: control
    - instance: dma2_controller
      port: ch6_ctrl
      bits: 32
  dma2_ch6_stat:
    - instance: dma2_controller
      port: ch6_stat
    - instance: dma2_ch6
      port: status
      bits: 32
  dma2_ch6_int:
    - instance: dma2_controller
      port: ch6_int
    - instance: interrupt_dma2
      port: ch6
  dma2_ch6_ht:
    - instance: dma2_controller
      port: ch6_ht
    - instance: interrupt_dma2
      port: ch6_ht
  dma2_ch6_tc:
    - instance: dma2_controller
      port: ch6_tc
    - instance: interrupt_dma2
      port: ch6_tc
  dma2_ch7_req:
    - instance: dma2_ch7
      port: request
    - instance: dma2_controller
      port: ch7_req
  dma2_ch7_ack:
    - instance: dma2_controller
      port: ch7_ack
    - instance: dma2_ch7
      port: ack
  dma2_ch7_data:
    - instance: dma2_ch7
      port: data
    - instance: dma2_controller
      port: ch7_data
      bits: 16
  dma2_ch7_addr:
    - instance: dma2_ch7
      port: addr
    - instance: dma2_controller
      port: ch7_addr
      bits: 16
  dma2_ch7_ctrl:
    - instance: dma2_ch7
      port: control
    - instance: dma2_controller
      port: ch7_ctrl
      bits: 32
  dma2_ch7_stat:
    - instance: dma2_controller
      port: ch7_stat
    - instance: dma2_ch7
      port: status
      bits: 32
  dma2_ch7_int:
    - instance: dma2_controller
      port: ch7_int
    - instance: interrupt_dma2
      port: ch7
  dma2_ch7_ht:
    - instance: dma2_controller
      port: ch7_ht
    - instance: interrupt_dma2
      port: ch7_ht
  dma2_ch7_tc:
    - instance: dma2_controller
      port: ch7_tc
    - instance: interrupt_dma2
      port: ch7_tc
  # BDMA Controller
  bdma_ch0_req:
    - instance: bdma_ch0
      port: request
    - instance: bdma_controller
      port: ch0_req
  bdma_ch0_ack:
    - instance: bdma_controller
      port: ch0_ack
    - instance: bdma_ch0
      port: ack
  bdma_ch0_data:
    - instance: bdma_ch0
      port: data
    - instance: bdma_controller
      port: ch0_data
      bits: 32
  bdma_ch0_addr:
    - instance: bdma_ch0
      port: addr
    - instance: bdma_controller
      port: ch0_addr
      bits: 32
  bdma_ch0_ctrl:
    - instance: bdma_ch0
      port: control
    - instance: bdma_controller
      port: ch0_ctrl
      bits: 32
  bdma_ch0_stat:
    - instance: bdma_controller
      port: ch0_stat
    - instance: bdma_ch0
      port: status
      bits: 32
  bdma_ch0_int:
    - instance: bdma_controller
      port: ch0_int
    - instance: interrupt_bdma
      port: ch0
  bdma_ch0_ht:
    - instance: bdma_controller
      port: ch0_ht
    - instance: interrupt_bdma
      port: ch0_ht
  bdma_ch0_tc:
    - instance: bdma_controller
      port: ch0_tc
    - instance: interrupt_bdma
      port: ch0_tc
  bdma_ch1_req:
    - instance: bdma_ch1
      port: request
    - instance: bdma_controller
      port: ch1_req
  bdma_ch1_ack:
    - instance: bdma_controller
      port: ch1_ack
    - instance: bdma_ch1
      port: ack
  bdma_ch1_data:
    - instance: bdma_ch1
      port: data
    - instance: bdma_controller
      port: ch1_data
      bits: 32
  bdma_ch1_addr:
    - instance: bdma_ch1
      port: addr
    - instance: bdma_controller
      port: ch1_addr
      bits: 32
  bdma_ch1_ctrl:
    - instance: bdma_ch1
      port: control
    - instance: bdma_controller
      port: ch1_ctrl
      bits: 32
  bdma_ch1_stat:
    - instance: bdma_controller
      port: ch1_stat
    - instance: bdma_ch1
      port: status
      bits: 32
  bdma_ch1_int:
    - instance: bdma_controller
      port: ch1_int
    - instance: interrupt_bdma
      port: ch1
  bdma_ch1_ht:
    - instance: bdma_controller
      port: ch1_ht
    - instance: interrupt_bdma
      port: ch1_ht
  bdma_ch1_tc:
    - instance: bdma_controller
      port: ch1_tc
    - instance: interrupt_bdma
      port: ch1_tc
  bdma_ch2_req:
    - instance: bdma_ch2
      port: request
    - instance: bdma_controller
      port: ch2_req
  bdma_ch2_ack:
    - instance: bdma_controller
      port: ch2_ack
    - instance: bdma_ch2
      port: ack
  bdma_ch2_data:
    - instance: bdma_ch2
      port: data
    - instance: bdma_controller
      port: ch2_data
      bits: 32
  bdma_ch2_addr:
    - instance: bdma_ch2
      port: addr
    - instance: bdma_controller
      port: ch2_addr
      bits: 32
  bdma_ch2_ctrl:
    - instance: bdma_ch2
      port: control
    - instance: bdma_controller
      port: ch2_ctrl
      bits: 32
  bdma_ch2_stat:
    - instance: bdma_controller
      port: ch2_stat
    - instance: bdma_ch2
      port: status
      bits: 32
  bdma_ch2_int:
    - instance: bdma_controller
      port: ch2_int
    - instance: interrupt_bdma
      port: ch2
  bdma_ch2_ht:
    - instance: bdma_controller
      port: ch2_ht
    - instance: interrupt_bdma
      port: ch2_ht
  bdma_ch2_tc:
    - instance: bdma_controller
      port: ch2_tc
    - instance: interrupt_bdma
      port: ch2_tc
  bdma_ch3_req:
    - instance: bdma_ch3
      port: request
    - instance: bdma_controller
      port: ch3_req
  bdma_ch3_ack:
    - instance: bdma_controller
      port: ch3_ack
    - instance: bdma_ch3
      port: ack
  bdma_ch3_data:
    - instance: bdma_ch3
      port: data
    - instance: bdma_controller
      port: ch3_data
      bits: 32
  bdma_ch3_addr:
    - instance: bdma_ch3
      port: addr
    - instance: bdma_controller
      port: ch3_addr
      bits: 32
  bdma_ch3_ctrl:
    - instance: bdma_ch3
      port: control
    - instance: bdma_controller
      port: ch3_ctrl
      bits: 32
  bdma_ch3_stat:
    - instance: bdma_controller
      port: ch3_stat
    - instance: bdma_ch3
      port: status
      bits: 32
  bdma_ch3_int:
    - instance: bdma_controller
      port: ch3_int
    - instance: interrupt_bdma
      port: ch3
  bdma_ch3_ht:
    - instance: bdma_controller
      port: ch3_ht
    - instance: interrupt_bdma
      port: ch3_ht
  bdma_ch3_tc:
    - instance: bdma_controller
      port: ch3_tc
    - instance: interrupt_bdma
      port: ch3_tc
  
  # Nested Vectored Interrupt Controller (NVIC)
  nvic_irq0:
    - instance: periph_irq0
      port: out
    - instance: nvic
      port: irq0
  nvic_irq1:
    - instance: periph_irq1
      port: out
    - instance: nvic
      port: irq1
  nvic_irq2:
    - instance: periph_irq2
      port: out
    - instance: nvic
      port: irq2
  nvic_irq3:
    - instance: periph_irq3
      port: out
    - instance: nvic
      port: irq3
  nvic_irq4:
    - instance: periph_irq4
      port: out
    - instance: nvic
      port: irq4
  nvic_irq5:
    - instance: periph_irq5
      port: out
    - instance: nvic
      port: irq5
  nvic_irq6:
    - instance: periph_irq6
      port: out
    - instance: nvic
      port: irq6
  nvic_irq7:
    - instance: periph_irq7
      port: out
    - instance: nvic
      port: irq7
  nvic_irq8:
    - instance: periph_irq8
      port: out
    - instance: nvic
      port: irq8
  nvic_irq9:
    - instance: periph_irq9
      port: out
    - instance: nvic
      port: irq9
  nvic_irq10:
    - instance: periph_irq10
      port: out
    - instance: nvic
      port: irq10
  nvic_irq11:
    - instance: periph_irq11
      port: out
    - instance: nvic
      port: irq11
  nvic_irq12:
    - instance: periph_irq12
      port: out
    - instance: nvic
      port: irq12
  nvic_irq13:
    - instance: periph_irq13
      port: out
    - instance: nvic
      port: irq13
  nvic_irq14:
    - instance: periph_irq14
      port: out
    - instance: nvic
      port: irq14
  nvic_irq15:
    - instance: periph_irq15
      port: out
    - instance: nvic
      port: irq15
  nvic_irq16:
    - instance: periph_irq16
      port: out
    - instance: nvic
      port: irq16
  nvic_irq17:
    - instance: periph_irq17
      port: out
    - instance: nvic
      port: irq17
  nvic_irq18:
    - instance: periph_irq18
      port: out
    - instance: nvic
      port: irq18
  nvic_irq19:
    - instance: periph_irq19
      port: out
    - instance: nvic
      port: irq19
  nvic_irq20:
    - instance: periph_irq20
      port: out
    - instance: nvic
      port: irq20
  nvic_irq21:
    - instance: periph_irq21
      port: out
    - instance: nvic
      port: irq21
  nvic_irq22:
    - instance: periph_irq22
      port: out
    - instance: nvic
      port: irq22
  nvic_irq23:
    - instance: periph_irq23
      port: out
    - instance: nvic
      port: irq23
  nvic_irq24:
    - instance: periph_irq24
      port: out
    - instance: nvic
      port: irq24
  nvic_irq25:
    - instance: periph_irq25
      port: out
    - instance: nvic
      port: irq25
  nvic_irq26:
    - instance: periph_irq26
      port: out
    - instance: nvic
      port: irq26
  nvic_irq27:
    - instance: periph_irq27
      port: out
    - instance: nvic
      port: irq27
  nvic_irq28:
    - instance: periph_irq28
      port: out
    - instance: nvic
      port: irq28
  nvic_irq29:
    - instance: periph_irq29
      port: out
    - instance: nvic
      port: irq29
  nvic_irq30:
    - instance: periph_irq30
      port: out
    - instance: nvic
      port: irq30
  nvic_irq31:
    - instance: periph_irq31
      port: out
    - instance: nvic
      port: irq31
  # NVIC to Cortex processors
  nvic_m33_irq:
    - instance: nvic
      port: irq_out
    - instance: cortex_m33
      port: irq
  nvic_m33_fiq:
    - instance: nvic
      port: fiq_out
    - instance: cortex_m33
      port: fiq
  nvic_m0_irq:
    - instance: nvic
      port: irq_m0_out
    - instance: cortex_m0
      port: irq
  # EXTI (External Interrupt) Controller
  exti0_src:
    - instance: gpioa
      port: pin0
    - instance: exti
      port: line0_src
  exti1_src:
    - instance: gpioa
      port: pin1
    - instance: exti
      port: line1_src
  exti2_src:
    - instance: gpioa
      port: pin2
    - instance: exti
      port: line2_src
  exti3_src:
    - instance: gpioa
      port: pin3
    - instance: exti
      port: line3_src
  exti4_src:
    - instance: gpioa
      port: pin4
    - instance: exti
      port: line4_src
  exti5_src:
    - instance: gpioa
      port: pin5
    - instance: exti
      port: line5_src
  exti6_src:
    - instance: gpioa
      port: pin6
    - instance: exti
      port: line6_src
  exti7_src:
    - instance: gpioa
      port: pin7
    - instance: exti
      port: line7_src
  exti8_src:
    - instance: gpioa
      port: pin8
    - instance: exti
      port: line8_src
  exti9_src:
    - instance: gpioa
      port: pin9
    - instance: exti
      port: line9_src
  exti10_src:
    - instance: gpioa
      port: pin10
    - instance: exti
      port: line10_src
  exti11_src:
    - instance: gpioa
      port: pin11
    - instance: exti
      port: line11_src
  exti12_src:
    - instance: gpioa
      port: pin12
    - instance: exti
      port: line12_src
  exti13_src:
    - instance: gpioa
      port: pin13
    - instance: exti
      port: line13_src
  exti14_src:
    - instance: gpioa
      port: pin14
    - instance: exti
      port: line14_src
  exti15_src:
    - instance: gpioa
      port: pin15
    - instance: exti
      port: line15_src
  exti0_irq:
    - instance: exti
      port: line0_irq
    - instance: periph_irq0
      port: in
  exti1_irq:
    - instance: exti
      port: line1_irq
    - instance: periph_irq1
      port: in
  exti2_irq:
    - instance: exti
      port: line2_irq
    - instance: periph_irq2
      port: in
  exti3_irq:
    - instance: exti
      port: line3_irq
    - instance: periph_irq3
      port: in
  exti4_irq:
    - instance: exti
      port: line4_irq
    - instance: periph_irq4
      port: in
  exti5_irq:
    - instance: exti
      port: line5_irq
    - instance: periph_irq5
      port: in
  exti6_irq:
    - instance: exti
      port: line6_irq
    - instance: periph_irq6
      port: in
  exti7_irq:
    - instance: exti
      port: line7_irq
    - instance: periph_irq7
      port: in
  exti8_irq:
    - instance: exti
      port: line8_irq
    - instance: periph_irq8
      port: in
  exti9_irq:
    - instance: exti
      port: line9_irq
    - instance: periph_irq9
      port: in
  exti10_irq:
    - instance: exti
      port: line10_irq
    - instance: periph_irq10
      port: in
  exti11_irq:
    - instance: exti
      port: line11_irq
    - instance: periph_irq11
      port: in
  exti12_irq:
    - instance: exti
      port: line12_irq
    - instance: periph_irq12
      port: in
  exti13_irq:
    - instance: exti
      port: line13_irq
    - instance: periph_irq13
      port: in
  exti14_irq:
    - instance: exti
      port: line14_irq
    - instance: periph_irq14
      port: in
  exti15_irq:
    - instance: exti
      port: line15_irq
    - instance: periph_irq15
      port: in
  
  # Interrupt Router
  irq_tim1_brk: { link: [interrupt_tim1.brk, interrupt_router.tim1_brk] }
  irq_tim1_up: { link: [interrupt_tim1.update, interrupt_router.tim1_up] }
  irq_tim1_cc: { link: [interrupt_tim1.cc_all, interrupt_router.tim1_cc] }
  irq_tim1_com: { link: [interrupt_tim1.com, interrupt_router.tim1_com] }
  irq_tim1_trg: { link: [interrupt_tim1.trg, interrupt_router.tim1_trg] }
  
  irq_tim8_brk: { link: [interrupt_tim8.brk, interrupt_router.tim8_brk] }
  irq_tim8_up:  { link: [interrupt_tim8.update, interrupt_router.tim8_up] }
  irq_tim8_cc:  { link: [interrupt_tim8.cc_all, interrupt_router.tim8_cc] }
  irq_tim8_com: { link: [interrupt_tim8.com, interrupt_router.tim8_com] }
  irq_tim8_trg: { link: [interrupt_tim8.trg, interrupt_router.tim8_trg] }
  
  irq_tim2: { link: [interrupt_tim2.all, interrupt_router.tim2] }
  irq_tim3: { link: [interrupt_tim3.all, interrupt_router.tim3] }
  irq_tim4: { link: [interrupt_tim4.all, interrupt_router.tim4] }
  irq_tim5: { link: [interrupt_tim5.all, interrupt_router.tim5] }
  irq_tim6: { link: [interrupt_tim6.all, interrupt_router.tim6] }
  irq_tim7: { link: [interrupt_tim7.all, interrupt_router.tim7] }
  
  irq_tim12: { link: [interrupt_tim12.all, interrupt_router.tim12] }
  irq_tim13: { link: [interrupt_tim13.all, interrupt_router.tim13] }
  irq_tim14: { link: [interrupt_tim14.all, interrupt_router.tim14] }
  irq_tim15: { link: [interrupt_tim15.all, interrupt_router.tim15] }
  irq_tim16: { link: [interrupt_tim16.all, interrupt_router.tim16] }
  irq_tim17: { link: [interrupt_tim17.all, interrupt_router.tim17] }
  
  irq_lptim1: { link: [interrupt_lptim1.all, interrupt_router.lptim1] }
  irq_lptim2: { link: [interrupt_lptim2.all, interrupt_router.lptim2] }
  irq_hrtim: { link: [interrupt_hrtim.all, interrupt_router.hrtim] }
  irq_systick: { link: [interrupt_systick.all, interrupt_router.systick] }
  
  irq_iwdg: { link: [interrupt_iwdg.all, interrupt_router.iwdg] }
  irq_wwdg: { link: [interrupt_wwdg.all, interrupt_router.wwdg] }
  irq_rtc: { link: [interrupt_rtc.all, interrupt_router.rtc] }
  irq_rtc_s: { link: [interrupt_rtc.sec, interrupt_router.rtc_s] }
  
  irq_adc1: { link: [interrupt_adc1.all, interrupt_router.adc1] }
  irq_adc2: { link: [interrupt_adc2.all, interrupt_router.adc2] }
  irq_dac: { link: [interrupt_dac.all, interrupt_router.dac] }
  irq_comp1: { link: [interrupt_comp1.all, interrupt_router.comp1] }
  irq_comp2: { link: [interrupt_comp2.all, interrupt_router.comp2] }
  irq_opamp: { link: [interrupt_opamp.all, interrupt_router.opamp] }
  
  irq_dma1_ch0: { link: [interrupt_dma1.ch0, interrupt_router.dma1_ch0] }
  irq_dma1_ch1: { link: [interrupt_dma1.ch1, interrupt_router.dma1_ch1] }
  irq_dma1_ch2: { link: [interrupt_dma1.ch2, interrupt_router.dma1_ch2] }
  irq_dma1_ch3: { link: [interrupt_dma1.ch3, interrupt_router.dma1_ch3] }
  irq_dma1_ch4: { link: [interrupt_dma1.ch4, interrupt_router.dma1_ch4] }
  irq_dma1_ch5: { link: [interrupt_dma1.ch5, interrupt_router.dma1_ch5] }
  irq_dma1_ch6: { link: [interrupt_dma1.ch6, interrupt_router.dma1_ch6] }
  irq_dma1_ch7: { link: [interrupt_dma1.ch7, interrupt_router.dma1_ch7] }
  
  irq_dma2_ch0: { link: [interrupt_dma2.ch0, interrupt_router.dma2_ch0] }
  irq_dma2_ch1: { link: [interrupt_dma2.ch1, interrupt_router.dma2_ch1] }
  irq_dma2_ch2: { link: [interrupt_dma2.ch2, interrupt_router.dma2_ch2] }
  irq_dma2_ch3: { link: [interrupt_dma2.ch3, interrupt_router.dma2_ch3] }
  irq_dma2_ch4: { link: [interrupt_dma2.ch4, interrupt_router.dma2_ch4] }
  irq_dma2_ch5: { link: [interrupt_dma2.ch5, interrupt_router.dma2_ch5] }
  irq_dma2_ch6: { link: [interrupt_dma2.ch6, interrupt_router.dma2_ch6] }
  irq_dma2_ch7: { link: [interrupt_dma2.ch7, interrupt_router.dma2_ch7] }
  
  irq_bdma_ch0: { link: [interrupt_bdma.ch0, interrupt_router.bdma_ch0] }
  irq_bdma_ch1: { link: [interrupt_bdma.ch1, interrupt_router.bdma_ch1] }
  irq_bdma_ch2: { link: [interrupt_bdma.ch2, interrupt_router.bdma_ch2] }
  irq_bdma_ch3: { link: [interrupt_bdma.ch3, interrupt_router.bdma_ch3] }
  
  irq_mdma_ch0: { link: [interrupt_mdma.ch0, interrupt_router.mdma_ch0] }
  irq_mdma_ch1: { link: [interrupt_mdma.ch1, interrupt_router.mdma_ch1] }
  irq_mdma_ch2: { link: [interrupt_mdma.ch2, interrupt_router.mdma_ch2] }
  irq_mdma_ch3: { link: [interrupt_mdma.ch3, interrupt_router.mdma_ch3] }
  
  irq_eth: { link: [interrupt_eth.all, interrupt_router.eth] }
  irq_eth_wk: { link: [interrupt_eth.wake, interrupt_router.eth_wk] }
  irq_usb: { link: [interrupt_usb.all, interrupt_router.usb] }
  irq_usb_wk: { link: [interrupt_usb.wake, interrupt_router.usb_wk] }
  irq_pcie: { link: [interrupt_pcie.all, interrupt_router.pcie] }
  irq_pcie_wk: { link: [interrupt_pcie.wake, interrupt_router.pcie_wk] }
  
  irq_sdmmc1: { link: [interrupt_sdmmc1.all, interrupt_router.sdmmc1] }
  irq_sdmmc2: { link: [interrupt_sdmmc2.all, interrupt_router.sdmmc2] }
  irq_qspi: { link: [interrupt_qspi.all, interrupt_router.qspi] }
  irq_can1: { link: [interrupt_can1.all, interrupt_router.can1] }
  irq_can2: { link: [interrupt_can2.all, interrupt_router.can2] }
  
  irq_uart1: { link: [interrupt_usart1.all, interrupt_router.usart1] }
  irq_uart2: { link: [interrupt_usart2.all, interrupt_router.usart2] }
  irq_uart3: { link: [interrupt_usart3.all, interrupt_router.usart3] }
  irq_uart4: { link: [interrupt_uart4.all, interrupt_router.uart4] }
  irq_uart5: { link: [interrupt_uart5.all, interrupt_router.uart5] }
  irq_uart6: { link: [interrupt_usart6.all, interrupt_router.usart6] }
  irq_uart7: { link: [interrupt_uart7.all, interrupt_router.uart7] }
  irq_uart8: { link: [interrupt_uart8.all, interrupt_router.uart8] }
  
  irq_spi1: { link: [interrupt_spi1.all, interrupt_router.spi1] }
  irq_spi2: { link: [interrupt_spi2.all, interrupt_router.spi2] }
  irq_spi3: { link: [interrupt_spi3.all, interrupt_router.spi3] }
  irq_spi4: { link: [interrupt_spi4.all, interrupt_router.spi4] }
  irq_spi5: { link: [interrupt_spi5.all, interrupt_router.spi5] }
  irq_spi6: { link: [interrupt_spi6.all, interrupt_router.spi6] }
  
  irq_i2c1: { link: [interrupt_i2c1.all, interrupt_router.i2c1] }
  irq_i2c2: { link: [interrupt_i2c2.all, interrupt_router.i2c2] }
  irq_i2c3: { link: [interrupt_i2c3.all, interrupt_router.i2c3] }
  irq_i2c4: { link: [interrupt_i2c4.all, interrupt_router.i2c4] }
  irq_i2c5: { link: [interrupt_i2c5.all, interrupt_router.i2c5] }
  
  irq_exti0: { link: [exti.line0_irq, interrupt_router.exti0] }
  irq_exti1: { link: [exti.line1_irq, interrupt_router.exti1] }
  irq_exti2: { link: [exti.line2_irq, interrupt_router.exti2] }
  irq_exti3: { link: [exti.line3_irq, interrupt_router.exti3] }
  irq_exti4: { link: [exti.line4_irq, interrupt_router.exti4] }
  irq_exti9_5: { link: [exti.lines9_5_irq, interrupt_router.exti9_5] }
  irq_exti15_10: { link: [exti.lines15_10_irq, interrupt_router.exti15_10] }
  
  irq_hsem0: { link: [interrupt_hsem.ch0, interrupt_router.hsem0] }
  irq_hsem1: { link: [interrupt_hsem.ch1, interrupt_router.hsem1] }
  irq_hsem2: { link: [interrupt_hsem.ch2, interrupt_router.hsem2] }
  irq_hsem3: { link: [interrupt_hsem.ch3, interrupt_router.hsem3] }
  
  irq_ipcc_rx: { link: [interrupt_ipcc.rx, interrupt_router.ipcc_rx] }
  irq_ipcc_tx: { link: [interrupt_ipcc.tx, interrupt_router.ipcc_tx] }
  
  irq_cryp: { link: [interrupt_cryp.all, interrupt_router.cryp] }
  irq_hash: { link: [interrupt_hash.all, interrupt_router.hash] }
  irq_rng: { link: [interrupt_rng.all, interrupt_router.rng] }
  irq_crc: { link: [interrupt_crc.all, interrupt_router.crc] }
  irq_fpu: { link: [interrupt_fpu.all, interrupt_router.fpu] }
  
  irq_mpu_fault: { link: [mpu.fault, interrupt_router.mpu_fault] }
  irq_pvd: { link: [pvd.detect, interrupt_router.pvd] }
  irq_dfsdm: { link: [interrupt_dfsdm.all, interrupt_router.dfsdm] }
  irq_sai1: { link: [interrupt_sai1.all, interrupt_router.sai1] }
  irq_sai2: { link: [interrupt_sai2.all, interrupt_router.sai2] }
  irq_sai3: { link: [interrupt_sai3.all, interrupt_router.sai3] }
  irq_sai4: { link: [interrupt_sai4.all, interrupt_router.sai4] }

bus:
  # DMA APB Configuration Bus
  dma_apb:
    - instance: instance.apb_interconnect
      port: dma_master
    - instance: instance.dma1_cfg
      port: apb_slave
    - instance: instance.dma2_cfg
      port: apb_slave
    - instance: instance.bdma_cfg
      port: apb_slave
    - instance: instance.mdma_cfg
      port: apb_slave

comb:
  # DMA system status
  dma_ready: { expr: "mdma_ready & dma1_ready & dma2_ready & bdma_ready" }
  mdma_ready: { expr: "mdma_controller.ready & mdma_cfg.ready" }
  dma1_ready: { expr: "dma1_controller.ready & dma1_cfg.ready" }
  dma2_ready: { expr: "dma2_controller.ready & dma2_cfg.ready" }
  bdma_ready: { expr: "bdma_controller.ready & bdma_cfg.ready" }
  
  # DMA channel status
  mdma_ch_active: { expr: "{mdma_ch0_active, mdma_ch1_active, mdma_ch2_active, mdma_ch3_active}" }
  dma1_ch_active: { expr: "{dma1_ch0_active, dma1_ch1_active, dma1_ch2_active, dma1_ch3_active, dma1_ch4_active, dma1_ch5_active, dma1_ch6_active, dma1_ch7_active}" }
  dma2_ch_active: { expr: "{dma2_ch0_active, dma2_ch1_active, dma2_ch2_active, dma2_ch3_active, dma2_ch4_active, dma2_ch5_active, dma2_ch6_active, dma2_ch7_active}" }
  bdma_ch_active: { expr: "{bdma_ch0_active, bdma_ch1_active, bdma_ch2_active, bdma_ch3_active}" }
  
  mdma_ch0_active: { expr: "mdma_controller.ch0_active" }
  mdma_ch1_active: { expr: "mdma_controller.ch1_active" }
  mdma_ch2_active: { expr: "mdma_controller.ch2_active" }
  mdma_ch3_active: { expr: "mdma_controller.ch3_active" }
  
  dma1_ch0_active: { expr: "dma1_controller.ch0_active" }
  dma1_ch1_active: { expr: "dma1_controller.ch1_active" }
  dma1_ch2_active: { expr: "dma1_controller.ch2_active" }
  dma1_ch3_active: { expr: "dma1_controller.ch3_active" }
  dma1_ch4_active: { expr: "dma1_controller.ch4_active" }
  dma1_ch5_active: { expr: "dma1_controller.ch5_active" }
  dma1_ch6_active: { expr: "dma1_controller.ch6_active" }
  dma1_ch7_active: { expr: "dma1_controller.ch7_active" }
  
  dma2_ch0_active: { expr: "dma2_controller.ch0_active" }
  dma2_ch1_active: { expr: "dma2_controller.ch1_active" }
  dma2_ch2_active: { expr: "dma2_controller.ch2_active" }
  dma2_ch3_active: { expr: "dma2_controller.ch3_active" }
  dma2_ch4_active: { expr: "dma2_controller.ch4_active" }
  dma2_ch5_active: { expr: "dma2_controller.ch5_active" }
  dma2_ch6_active: { expr: "dma2_controller.ch6_active" }
  dma2_ch7_active: { expr: "dma2_controller.ch7_active" }
  
  bdma_ch0_active: { expr: "bdma_controller.ch0_active" }
  bdma_ch1_active: { expr: "bdma_controller.ch1_active" }
  bdma_ch2_active: { expr: "bdma_controller.ch2_active" }
  bdma_ch3_active: { expr: "bdma_controller.ch3_active" }
  
  # Interrupt system status
  nvic_ready: { expr: "nvic.ready & interrupt_router.ready" }
  exti_active: { expr: "{exti0_active, exti1_active, exti2_active, exti3_active, exti4_active, exti5_active, exti6_active, exti7_active, exti8_active, exti9_active, exti10_active, exti11_active, exti12_active, exti13_active, exti14_active, exti15_active}" }
  
  exti0_active: { expr: "exti.line0_active" }
  exti1_active: { expr: "exti.line1_active" }
  exti2_active: { expr: "exti.line2_active" }
  exti3_active: { expr: "exti.line3_active" }
  exti4_active: { expr: "exti.line4_active" }
  exti5_active: { expr: "exti.line5_active" }
  exti6_active: { expr: "exti.line6_active" }
  exti7_active: { expr: "exti.line7_active" }
  exti8_active: { expr: "exti.line8_active" }
  exti9_active: { expr: "exti.line9_active" }
  exti10_active: { expr: "exti.line10_active" }
  exti11_active: { expr: "exti.line11_active" }
  exti12_active: { expr: "exti.line12_active" }
  exti13_active: { expr: "exti.line13_active" }
  exti14_active: { expr: "exti.line14_active" }
  exti15_active: { expr: "exti.line15_active" }
  
  # Interrupt priority levels
  irq_priority: { expr: "nvic.priority_level", width: 8 }
  irq_mask: { expr: "nvic.irq_mask", width: 32 }
  irq_pending: { expr: "nvic.irq_pending", width: 32 }
  irq_active: { expr: "nvic.irq_active", width: 32 }

# 第7部分：GPIO和低速接口
  # GPIO端口A-H
  gpioa_in:
    bits: 16
    driver: port.PA0..PA15
  gpioa_out:
    bits: 16
    driver: instance.gpioa.GPIO0..GPIO15
  gpiob_in:
    bits: 16
    driver: port.PB0..PB15
  gpiob_out:
    bits: 16
    driver: instance.gpiob.GPIO0..GPIO15
  gpioc_in:
    bits: 16
    driver: port.PC0..PC15
  gpioc_out:
    bits: 16
    driver: instance.gpioc.GPIO0..GPIO15
  gpiod_in:
    bits: 16
    driver: port.PD0..PD15
  gpiod_out:
    bits: 16
    driver: instance.gpiod.GPIO0..GPIO15
  gpioe_in:
    bits: 16
    driver: port.PE0..PE15
  gpioe_out:
    bits: 16
    driver: instance.gpioe.GPIO0..GPIO15
  gpiof_in:
    bits: 16
    driver: port.PF0..PF15
  gpiof_out:
    bits: 16
    driver: instance.gpiof.GPIO0..GPIO15
  gpiog_in:
    bits: 16
    driver: port.PG0..PG15
  gpiog_out:
    bits: 16
    driver: instance.gpiog.GPIO0..GPIO15
  gpioh_in:
    bits: 16
    driver: port.PH0..PH15
  gpioh_out:
    bits: 16
    driver: instance.gpioh.GPIO0..GPIO15
  
  # GPIO中断到EXTI连接
  gpioa_exti:
    bits: 16
    driver: instance.exti.GPIOA0..GPIOA15
  gpiob_exti:
    bits: 16
    driver: instance.exti.GPIOB0..GPIOB15
  gpioc_exti:
    bits: 16
    driver: instance.exti.GPIOC0..GPIOC15
  gpiod_exti:
    bits: 16
    driver: instance.exti.GPIOD0..GPIOD15
  gpioe_exti:
    bits: 16
    driver: instance.exti.GPIOE0..GPIOE15
  gpiof_exti:
    bits: 16
    driver: instance.exti.GPIOF0..GPIOF15
  gpiog_exti:
    bits: 16
    driver: instance.exti.GPIOG0..GPIOG15
  gpioh_exti:
    bits: 16
    driver: instance.exti.GPIOH0..GPIOH15
  
  # I2C接口
  i2c1_scl:
    driver: port.I2C1_SCL
  i2c1_sda:
    driver: port.I2C1_SDA
  i2c2_scl:
    driver: port.I2C2_SCL
  i2c2_sda:
    driver: port.I2C2_SDA
  i2c3_scl:
    driver: port.I2C3_SCL
  i2c3_sda:
    driver: port.I2C3_SDA
  i2c4_scl:
    driver: port.I2C4_SCL
  i2c4_sda:
    driver: port.I2C4_SDA
  i2c5_scl:
    driver: port.I2C5_SCL
  i2c5_sda:
    driver: port.I2C5_SDA
  
  # SPI接口
  spi1_sck:
    driver: port.SPI1_SCK
  spi1_miso:
    driver: port.SPI1_MISO
  spi1_mosi:
    driver: port.SPI1_MOSI
  spi1_nss:
    driver: port.SPI1_NSS
  spi2_sck:
    driver: port.SPI2_SCK
  spi2_miso:
    driver: port.SPI2_MISO
  spi2_mosi:
    driver: port.SPI2_MOSI
  spi2_nss:
    driver: port.SPI2_NSS
  spi3_sck:
    driver: port.SPI3_SCK
  spi3_miso:
    driver: port.SPI3_MISO
  spi3_mosi:
    driver: port.SPI3_MOSI
  spi3_nss:
    driver: port.SPI3_NSS
  spi4_sck:
    driver: port.SPI4_SCK
  spi4_miso:
    driver: port.SPI4_MISO
  spi4_mosi:
    driver: port.SPI4_MOSI
  spi4_nss:
    driver: port.SPI4_NSS
  spi5_sck:
    driver: port.SPI5_SCK
  spi5_miso:
    driver: port.SPI5_MISO
  spi5_mosi:
    driver: port.SPI5_MOSI
  spi5_nss:
    driver: port.SPI5_NSS
  
  # USART/UART接口
  usart1_tx:
    driver: port.USART1_TX
  usart1_rx:
    driver: port.USART1_RX
  usart1_ck:
    driver: port.USART1_CK
  usart1_cts:
    driver: port.USART1_CTS
  usart1_rts:
    driver: port.USART1_RTS
  usart2_tx:
    driver: port.USART2_TX
  usart2_rx:
    driver: port.USART2_RX
  usart2_ck:
    driver: port.USART2_CK
  usart2_cts:
    driver: port.USART2_CTS
  usart2_rts:
    driver: port.USART2_RTS
  usart3_tx:
    driver: port.USART3_TX
  usart3_rx:
    driver: port.USART3_RX
  usart3_ck:
    driver: port.USART3_CK
  usart3_cts:
    driver: port.USART3_CTS
  usart3_rts:
    driver: port.USART3_RTS
  uart4_tx:
    driver: port.UART4_TX
  uart4_rx:
    driver: port.UART4_RX
  uart5_tx:
    driver: port.UART5_TX
  uart5_rx:
    driver: port.UART5_RX
  usart6_tx:
    driver: port.USART6_TX
  usart6_rx:
    driver: port.USART6_RX
  usart6_ck:
    driver: port.USART6_CK
  usart6_cts:
    driver: port.USART6_CTS
  usart6_rts:
    driver: port.USART6_RTS
  uart7_tx:
    driver: port.UART7_TX
  uart7_rx:
    driver: port.UART7_RX
  uart8_tx:
    driver: port.UART8_TX
  uart8_rx:
    driver: port.UART8_RX
  
  # GPIO到I2C控制器连接
  gpioa_i2c1:
    bits: 2
    driver: instance.i2c1.SCL,instance.i2c1.SDA
  gpiob_i2c1:
    bits: 2
    driver: instance.i2c1.SCL,instance.i2c1.SDA
  gpiob_i2c2:
    bits: 2
    driver: instance.i2c2.SCL,instance.i2c2.SDA
  gpioc_i2c2:
    bits: 2
    driver: instance.i2c2.SCL,instance.i2c2.SDA
  gpioc_i2c3:
    bits: 2
    driver: instance.i2c3.SCL,instance.i2c3.SDA
  gpiod_i2c3:
    bits: 2
    driver: instance.i2c3.SCL,instance.i2c3.SDA
  gpiof_i2c4:
    bits: 2
    driver: instance.i2c4.SCL,instance.i2c4.SDA
  gpioh_i2c4:
    bits: 2
    driver: instance.i2c4.SCL,instance.i2c4.SDA
  gpiof_i2c5:
    bits: 2
    driver: instance.i2c5.SCL,instance.i2c5.SDA
  gpioh_i2c5:
    bits: 2
    driver: instance.i2c5.SCL,instance.i2c5.SDA
  
  # GPIO到SPI控制器连接
  gpioa_spi1:
    bits: 4
    driver: instance.spi1.SCK,instance.spi1.MISO,instance.spi1.MOSI,instance.spi1.NSS
  gpiob_spi1:
    bits: 4
    driver: instance.spi1.SCK,instance.spi1.MISO,instance.spi1.MOSI,instance.spi1.NSS
  gpioc_spi2:
    bits: 4
    driver: instance.spi2.SCK,instance.spi2.MISO,instance.spi2.MOSI,instance.spi2.NSS
  gpiob_spi2:
    bits: 4
    driver: instance.spi2.SCK,instance.spi2.MISO,instance.spi2.MOSI,instance.spi2.NSS
  gpioc_spi3:
    bits: 4
    driver: instance.spi3.SCK,instance.spi3.MISO,instance.spi3.MOSI,instance.spi3.NSS
  gpioe_spi4:
    bits: 4
    driver: instance.spi4.SCK,instance.spi4.MISO,instance.spi4.MOSI,instance.spi4.NSS
  gpiof_spi5:
    bits: 4
    driver: instance.spi5.SCK,instance.spi5.MISO,instance.spi5.MOSI,instance.spi5.NSS
  
  # GPIO到USART/UART控制器连接
  gpioa_usart1:
    bits: 5
    driver: instance.usart1.TX,instance.usart1.RX,instance.usart1.CK,instance.usart1.CTS,instance.usart1.RTS
  gpiob_usart1:
    bits: 5
    driver: instance.usart1.TX,instance.usart1.RX,instance.usart1.CK,instance.usart1.CTS,instance.usart1.RTS
  gpiob_usart2:
    bits: 5
    driver: instance.usart2.TX,instance.usart2.RX,instance.usart2.CK,instance.usart2.CTS,instance.usart2.RTS
  gpiod_usart2:
    bits: 5
    driver: instance.usart2.TX,instance.usart2.RX,instance.usart2.CK,instance.usart2.CTS,instance.usart2.RTS
  gpiob_usart3:
    bits: 5
    driver: instance.usart3.TX,instance.usart3.RX,instance.usart3.CK,instance.usart3.CTS,instance.usart3.RTS
  gpioc_usart3:
    bits: 5
    driver: instance.usart3.TX,instance.usart3.RX,instance.usart3.CK,instance.usart3.CTS,instance.usart3.RTS
  gpioa_uart4:
    bits: 2
    driver: instance.uart4.TX,instance.uart4.RX
  gpioc_uart4:
    bits: 2
    driver: instance.uart4.TX,instance.uart4.RX
  gpiob_uart5:
    bits: 2
    driver: instance.uart5.TX,instance.uart5.RX
  gpioc_uart5:
    bits: 2
    driver: instance.uart5.TX,instance.uart5.RX
  gpioc_usart6:
    bits: 5
    driver: instance.usart6.TX,instance.usart6.RX,instance.usart6.CK,instance.usart6.CTS,instance.usart6.RTS
  gpiog_usart6:
    bits: 5
    driver: instance.usart6.TX,instance.usart6.RX,instance.usart6.CK,instance.usart6.CTS,instance.usart6.RTS
  gpioe_uart7:
    bits: 2
    driver: instance.uart7.TX,instance.uart7.RX
  gpiof_uart7:
    bits: 2
    driver: instance.uart7.TX,instance.uart7.RX
  gpioe_uart8:
    bits: 2
    driver: instance.uart8.TX,instance.uart8.RX
  gpiof_uart8:
    bits: 2
    driver: instance.uart8.TX,instance.uart8.RX

bus:
  # GPIO APB配置总线
  gpio_apb:
    - instance: instance.gpioa
      port: cfg
    - instance: instance.gpiob
      port: cfg
    - instance: instance.gpioc
      port: cfg
    - instance: instance.gpiod
      port: cfg
    - instance: instance.gpioe
      port: cfg
    - instance: instance.gpiof
      port: cfg
    - instance: instance.gpiog
      port: cfg
    - instance: instance.gpioh
      port: cfg
    - instance: instance.apb_interconnect
      port: gpio_slave
  
  # I2C APB配置总线
  i2c_apb:
    - instance: instance.i2c1
      port: cfg
    - instance: instance.i2c2
      port: cfg
    - instance: instance.i2c3
      port: cfg
    - instance: instance.i2c4
      port: cfg
    - instance: instance.i2c5
      port: cfg
    - instance: instance.apb_interconnect
      port: i2c_slave
  
  # SPI APB配置总线
  spi_apb:
    - instance: instance.spi1
      port: cfg
    - instance: instance.spi2
      port: cfg
    - instance: instance.spi3
      port: cfg
    - instance: instance.spi4
      port: cfg
    - instance: instance.spi5
      port: cfg
    - instance: instance.apb_interconnect
      port: spi_slave
  
  # USART APB配置总线
  usart_apb:
    - instance: instance.usart1
      port: cfg
    - instance: instance.usart2
      port: cfg
    - instance: instance.usart3
      port: cfg
    - instance: instance.uart4
      port: cfg
    - instance: instance.uart5
      port: cfg
    - instance: instance.usart6
      port: cfg
    - instance: instance.uart7
      port: cfg
    - instance: instance.uart8
      port: cfg
    - instance: instance.apb_interconnect
      port: usart_slave

comb:

  # GPIO状态
  gpioa_ready:
    expr: instance.gpioa.ready
  gpiob_ready:
    expr: instance.gpiob.ready
  gpioc_ready:
    expr: instance.gpioc.ready
  gpiod_ready:
    expr: instance.gpiod.ready
  gpioe_ready:
    expr: instance.gpioe.ready
  gpiof_ready:
    expr: instance.gpiof.ready
  gpiog_ready:
    expr: instance.gpiog.ready
  gpioh_ready:
    expr: instance.gpioh.ready
  
  # I2C状态
  i2c1_ready:
    expr: instance.i2c1.ready
  i2c2_ready:
    expr: instance.i2c2.ready
  i2c3_ready:
    expr: instance.i2c3.ready
  i2c4_ready:
    expr: instance.i2c4.ready
  i2c5_ready:
    expr: instance.i2c5.ready
  
  # SPI状态
  spi1_ready:
    expr: instance.spi1.ready
  spi2_ready:
    expr: instance.spi2.ready
  spi3_ready:
    expr: instance.spi3.ready
  spi4_ready:
    expr: instance.spi4.ready
  spi5_ready:
    expr: instance.spi5.ready
  
  # USART/UART状态
  usart1_ready:
    expr: instance.usart1.ready
  usart2_ready:
    expr: instance.usart2.ready
  usart3_ready:
    expr: instance.usart3.ready
  uart4_ready:
    expr: instance.uart4.ready
  uart5_ready:
    expr: instance.uart5.ready
  usart6_ready:
    expr: instance.usart6.ready
  uart7_ready:
    expr: instance.uart7.ready
  uart8_ready:
    expr: instance.uart8.ready
  
  # 低速接口就绪状态
  low_speed_ready:
    expr: i2c1_ready & i2c2_ready & i2c3_ready & i2c4_ready & i2c5_ready & spi1_ready & spi2_ready & spi3_ready & spi4_ready & spi5_ready & usart1_ready & usart2_ready & usart3_ready & uart4_ready & uart5_ready & usart6_ready & uart7_ready & uart8_ready

# 第8部分：系统控制和调试接口
  # JTAG/SWD调试接口
  jtag_tck:
    driver: port.JTCK
  jtag_tms:
    driver: port.JTMS
  jtag_tdi:
    driver: port.JTDI
  jtag_tdo:
    driver: port.JTDO
  jtag_trst:
    driver: port.JTRST
  swd_clk:
    driver: port.SWCLK
  swd_io:
    driver: port.SWDIO
  swd_trst:
    driver: port.SWTRST
  
  # 调试接口到Cortex处理器连接
  jtag_cortexa35:
    bits: 5
    driver: instance.cortexa35.JTCK,instance.cortexa35.JTMS,instance.cortexa35.JTDI,instance.cortexa35.JTDO,instance.cortexa35.JTRST
  swd_cortexa35:
    bits: 3
    driver: instance.cortexa35.SWCLK,instance.cortexa35.SWDIO,instance.cortexa35.SWTRST
  jtag_cortexm33:
    bits: 5
    driver: instance.cortexm33.JTCK,instance.cortexm33.JTMS,instance.cortexm33.JTDI,instance.cortexm33.JTDO,instance.cortexm33.JTRST
  swd_cortexm33:
    bits: 3
    driver: instance.cortexm33.SWCLK,instance.cortexm33.SWDIO,instance.cortexm33.SWTRST
  jtag_cortexm0plus:
    bits: 5
    driver: instance.cortexm0plus.JTCK,instance.cortexm0plus.JTMS,instance.cortexm0plus.JTDI,instance.cortexm0plus.JTDO,instance.cortexm0plus.JTRST
  swd_cortexm0plus:
    bits: 3
    driver: instance.cortexm0plus.SWCLK,instance.cortexm0plus.SWDIO,instance.cortexm0plus.SWTRST
  
  # 系统配置接口
  syscfg_exti_mux:
    bits: 128
    driver: instance.syscfg.EXTI0..EXTI127
  syscfg_mpu_mux:
    bits: 8
    driver: instance.syscfg.MPU_MUX0..MPU_MUX7
  syscfg_dma_mux:
    bits: 16
    driver: instance.syscfg.DMA_MUX0..DMA_MUX15
  syscfg_clk_mux:
    bits: 4
    driver: instance.syscfg.CLK_MUX0..CLK_MUX3
  
  # 系统控制信号
  syscfg_boot_mode:
    bits: 3
    driver: port.BOOT0,port.BOOT1,port.BOOT2
  syscfg_reset_source:
    bits: 8
    driver: instance.rcc.POR,instance.rcc.BOR,instance.rcc.PIN,instance.rcc.SW,instance.rcc.IWDG,instance.rcc.WWDG,instance.rcc.LP,instance.rcc.FIREWALL
  syscfg_low_power:
    bits: 4
    driver: instance.pwr.SLEEP,instance.pwr.STOP,instance.pwr.STANDBY,instance.pwr.SHUTDOWN
  
  # 选项字节接口
  option_bytes:
    bits: 32
    driver: instance.flash.OPT0..OPT31
  option_lock:
    driver: instance.flash.OPTLOCK
  option_start:
    driver: instance.flash.OPTSTRT
  
  # 系统状态信号
  system_ready:
    driver: instance.syscfg.READY
  system_error:
    bits: 8
    driver: instance.syscfg.ERR0..ERR7
  system_flag:
    bits: 16
    driver: instance.syscfg.FLAG0..FLAG15
  
  # 追踪接口
  trace_clk:
    driver: port.TRACECLK
  trace_data:
    bits: 4
    driver: port.TRACE0,port.TRACE1,port.TRACE2,port.TRACE3
  trace_ctl:
    driver: port.TRACECTL
  trace_cortexa35:
    bits: 6
    driver: instance.cortexa35.TRACECLK,instance.cortexa35.TRACE0,instance.cortexa35.TRACE1,instance.cortexa35.TRACE2,instance.cortexa35.TRACE3,instance.cortexa35.TRACECTL
  trace_cortexm33:
    bits: 6
    driver: instance.cortexm33.TRACECLK,instance.cortexm33.TRACE0,instance.cortexm33.TRACE1,instance.cortexm33.TRACE2,instance.cortexm33.TRACE3,instance.cortexm33.TRACECTL
  
  # 性能监控接口
  pmu_cortexa35:
    bits: 8
    driver: instance.cortexa35.PMU0..PMU7
  pmu_cortexm33:
    bits: 4
    driver: instance.cortexm33.PMU0..PMU3
  pmu_overflow:
    bits: 2
    driver: instance.cortexa35.OVFL,instance.cortexm33.OVFL
  
  # 安全接口
  secure_boot:
    driver: port.SECBOOT
  secure_jtag:
    driver: port.SECJT
  secure_trace:
    driver: port.SECTRACE
  tamper_detect:
    bits: 8
    driver: port.TAMP0,port.TAMP1,port.TAMP2,port.TAMP3,port.TAMP4,port.TAMP5,port.TAMP6,port.TAMP7
  
  # Clock Security System
  css_lse:
    driver: instance.rcc.CSS_LSE
  css_hse:
    driver: instance.rcc.CSS_HSE
  css_pll:
    driver: instance.rcc.CSS_PLL
  css_system:
    driver: instance.rcc.CSS_SYS
  css_lse_flag:
    driver: instance.rcc.CSS_LSEF
  css_hse_flag:
    driver: instance.rcc.CSS_HSEF
  css_pll_flag:
    driver: instance.rcc.CSS_PLLF

bus:
  # 系统配置APB总线
  syscfg_apb:
    - instance: syscfg
      port: cfg
    - instance: flash
      port: cfg
    - instance: pwr
      port: cfg
    - instance: apb_interconnect
      port: slave_syscfg
  
  # 调试APB总线
  debug_apb:
    - instance: dbgmcu
      port: cfg
    - instance: apb_interconnect
      port: slave_debug

comb:
  # 调试接口状态
  jtag_ready:
    expr: instance.dbgmcu.JTAG_RDY
  swd_ready:
    expr: instance.dbgmcu.SWD_RDY
  trace_ready:
    expr: instance.dbgmcu.TRACE_RDY
  debug_ready:
    expr: jtag_ready | swd_ready
  
  # 系统控制状态
  syscfg_ready:
    expr: instance.syscfg.ready
  boot_mode_valid:
    expr: syscfg_boot_mode != 3'b111
  reset_source_valid:
    expr: |syscfg_reset_source
  option_bytes_valid:
    expr: !option_lock
  
  # 安全状态
  secure_mode:
    expr: secure_boot & syscfg_ready
  jtag_secure:
    expr: secure_jtag & secure_mode
  trace_secure:
    expr: secure_trace & secure_mode
  tamper_active:
    expr: |tamper_detect
  
  # 时钟安全状态
  css_lse_fail:
    expr: css_lse_flag & css_lse
  css_hse_fail:
    expr: css_hse_flag & css_hse
  css_pll_fail:
    expr: css_pll_flag & css_pll
  css_fail:
    expr: css_lse_fail | css_hse_fail | css_pll_fail
  
  # 系统就绪状态
  system_control_ready:
    expr: syscfg_ready & boot_mode_valid & option_bytes_valid & !css_fail & !tamper_active
  debug_system_ready:
    expr: debug_ready & trace_ready & system_control_ready


# 第9部分：电源管理和低功耗控制
  # 电源域接口
  vdd_core:
    driver: port.VDD_CORE
  vdd_cpu:
    driver: port.VDD_CPU
  vdd_gpu:
    driver: port.VDD_GPU
  vdd_npu:
    driver: port.VDD_NPU
  vdd_ddr:
    driver: port.VDD_DDR
  vdd_io:
    driver: port.VDD_IO
  vdd_usb:
    driver: port.VDD_USB
  vdd_sd:
    driver: port.VDD_SD
  vdd_can:
    driver: port.VDD_CAN
  vdd_adc:
    driver: port.VDD_ADC
  vdd_dac:
    driver: port.VDD_DAC
  vdd_pll:
    driver: port.VDD_PLL
  vdd_rtc:
    driver: port.VDD_RTC
  vdd_bkp:
    driver: port.VDD_BKP
  vdd_vref:
    driver: port.VDD_VREF
  
  # 电源监控接口
  pvd_in:
    driver: port.PVD_IN
  pvd_out:
    driver: instance.pwr.PVD_OUT
  bordet_in:
    driver: port.BOR_DET
  bordet_out:
    driver: instance.pwr.BOR_DET
  avd_in:
    driver: port.AVD_IN
  avd_out:
    driver: instance.pwr.AVD_OUT
  vbat_in:
    driver: port.VBAT
  vbat_mon:
    driver: instance.pwr.VBAT_MON
  
  # 低功耗唤醒接口
  wakeup_pins:
    bits: 8
    driver: port.WKUP0,port.WKUP1,port.WKUP2,port.WKUP3,port.WKUP4,port.WKUP5,port.WKUP6,port.WKUP7
  rtc_wakeup:
    driver: instance.rtc.WKUP
  lptim_wakeup:
    bits: 2
    driver: instance.lptim1.WKUP,instance.lptim2.WKUP
  i2c_wakeup:
    bits: 5
    driver: instance.i2c1.WKUP,instance.i2c2.WKUP,instance.i2c3.WKUP,instance.i2c4.WKUP,instance.i2c5.WKUP
  usart_wakeup:
    bits: 8
    driver: instance.usart1.WKUP,instance.usart2.WKUP,instance.usart3.WKUP,instance.uart4.WKUP,instance.uart5.WKUP,instance.usart6.WKUP,instance.uart7.WKUP,instance.uart8.WKUP
  usb_wakeup:
    driver: instance.usb.WKUP
  eth_wakeup:
    driver: instance.eth.WKUP
  sdmmc_wakeup:
    bits: 2
    driver: instance.sdmmc1.WKUP,instance.sdmmc2.WKUP
  
  # 电源控制信号
  cpu_power_req:
    driver: instance.cortexa35.PWR_REQ
  cpu_power_ack:
    driver: instance.pwr.CPU_ACK
  gpu_power_req:
    driver: instance.gpu.PWR_REQ
  gpu_power_ack:
    driver: instance.pwr.GPU_ACK
  npu_power_req:
    driver: instance.npu.PWR_REQ
  npu_power_ack:
    driver: instance.pwr.NPU_ACK
  ddr_power_req:
    driver: instance.ddr.PWR_REQ
  ddr_power_ack:
    driver: instance.pwr.DDR_ACK
  periph_power_req:
    driver: instance.pwr.PERIPH_REQ
  periph_power_ack:
    driver: instance.pwr.PERIPH_ACK
  
  # 时钟门控信号
  cpu_clk_gate:
    driver: instance.rcc.CPU_GATE
  gpu_clk_gate:
    driver: instance.rcc.GPU_GATE
  npu_clk_gate:
    driver: instance.rcc.NPU_GATE
  ddr_clk_gate:
    driver: instance.rcc.DDR_GATE
  periph_clk_gate:
    bits: 16
    driver: instance.rcc.PERIPH_GATE0..instance.rcc.PERIPH_GATE15
  bus_clk_gate:
    bits: 8
    driver: instance.rcc.BUS_GATE0..instance.rcc.BUS_GATE7
  
  # 复位控制信号 - 使用新的复位控制器架构
  por_rst_n:
    driver: instance.por.OUT
  bor_rst_n:
    driver: instance.bor.OUT
  nrst_n:
    driver: instance.reset_pin.OUT
  iwdg_rst_n:
    driver: instance.iwdg.RST_OUT
  wwdg_rst_n:
    driver: instance.wwdg.RST_OUT
  sw_rst_n:
    driver: instance.syscfg.MANUAL_RESET_REQ
  css_rst_n:
    driver: instance.clock_security.CSS_FAIL
  
  # 复位控制器输出信号
  cpu_rst_n:
    driver: reset.main_reset_ctrl.cpu_rst_n
  mcu_rst_n:
    driver: reset.main_reset_ctrl.mcu_rst_n
  m0_rst_n:
    driver: reset.main_reset_ctrl.m0_rst_n
  sys_rst_n:
    driver: reset.main_reset_ctrl.sys_rst_n
  mem_rst_n:
    driver: reset.main_reset_ctrl.mem_rst_n
  periph_rst_n:
    driver: reset.main_reset_ctrl.periph_rst_n
  
  # 应用域复位信号
  app_cpu_rst_n:
    driver: reset.app_reset_ctrl.app_cpu_rst_n
  app_periph_rst_n:
    driver: reset.app_reset_ctrl.app_periph_rst_n
  
  # 调试域复位信号
  dbg_cpu_rst_n:
    driver: reset.dbg_reset_ctrl.dbg_cpu_rst_n
  dbg_mcu_rst_n:
    driver: reset.dbg_reset_ctrl.dbg_mcu_rst_n
  
  # 复位状态信号
  reset_reason:
    bits: 8
    driver: reset.main_reset_ctrl.reset_reason
  reason_valid:
    driver: reset.main_reset_ctrl.reason_valid
  reason_clear:
    driver: port.reason_clear
  reset_sequence_done:
    driver: reset.main_reset_ctrl.reset_sequence_done
  
  # 电源状态信号
  cpu_power_state:
    bits: 3
    driver: instance.pwr.CPU_STATE0,instance.pwr.CPU_STATE1,instance.pwr.CPU_STATE2
  gpu_power_state:
    bits: 2
    driver: instance.pwr.GPU_STATE0,instance.pwr.GPU_STATE1
  npu_power_state:
    bits: 2
    driver: instance.pwr.NPU_STATE0,instance.pwr.NPU_STATE1
  ddr_power_state:
    bits: 2
    driver: instance.pwr.DDR_STATE0,instance.pwr.DDR_STATE1
  system_power_state:
    bits: 4
    driver: instance.pwr.SYS_STATE0,instance.pwr.SYS_STATE1,instance.pwr.SYS_STATE2,instance.pwr.SYS_STATE3
  
  # 低功耗模式信号
  sleep_mode:
    driver: instance.pwr.SLEEP
  stop_mode:
    driver: instance.pwr.STOP
  standby_mode:
    driver: instance.pwr.STANDBY
  shutdown_mode:
    driver: instance.pwr.SHUTDOWN
  retention_mode:
    driver: instance.pwr.RETENTION
  
  # 电源隔离信号
  cpu_isolation:
    driver: instance.pwr.CPU_ISO
  gpu_isolation:
    driver: instance.pwr.GPU_ISO
  npu_isolation:
    driver: instance.pwr.NPU_ISO
  ddr_isolation:
    driver: instance.pwr.DDR_ISO
  periph_isolation:
    driver: instance.pwr.PERIPH_ISO
  
  # 电源序列控制
  power_sequence:
    bits: 8
    driver: instance.pwr.SEQ0..instance.pwr.SEQ7
  power_sequence_done:
    driver: instance.pwr.SEQ_DONE
  power_sequence_error:
    driver: instance.pwr.SEQ_ERR
  
  # 温度传感器接口
  temp_sensor:
    driver: instance.temp.TEMP
  temp_alarm:
    driver: instance.temp.ALARM
  temp_shutdown:
    driver: instance.temp.SHUTDOWN

bus:
  # 电源管理APB总线
  pwr_apb:
    - instance: instance.pwr
      port: cfg
    - instance: instance.apb_interconnect
      port: pwr_slave
  
  # 温度传感器APB总线
  temp_apb:
    - instance: instance.temp
      port: cfg
    - instance: instance.apb_interconnect
      port: temp_slave

comb:
  # 电源就绪状态
  core_power_ready:
    expr: vdd_core & vdd_cpu & vdd_gpu & vdd_npu & vdd_ddr & vdd_io
  analog_power_ready:
    expr: vdd_adc & vdd_dac & vdd_vref
  peripheral_power_ready:
    expr: vdd_usb & vdd_sd & vdd_can & vdd_pll
  backup_power_ready:
    expr: vdd_rtc & vdd_bkp
  all_power_ready:
    expr: core_power_ready & analog_power_ready & peripheral_power_ready & backup_power_ready
  
  # 电源监控状态
  pvd_active:
    expr: pvd_out
  bor_active:
    expr: bordet_out
  avd_active:
    expr: avd_out
  vbat_low:
    expr: vbat_mon < 0x800
  power_fault:
    expr: pvd_active | bor_active | avd_active | vbat_low
  
  # 唤醒状态
  wakeup_active:
    bits: 1
    expr: |wakeup_pins | rtc_wakeup | |lptim_wakeup | |i2c_wakeup | |usart_wakeup | usb_wakeup | eth_wakeup | |sdmmc_wakeup
  wakeup_edge:
    bits: 1
    expr: ^wakeup_pins | ^rtc_wakeup | ^|lptim_wakeup | ^|i2c_wakeup | ^|usart_wakeup | ^usb_wakeup | ^eth_wakeup | ^|sdmmc_wakeup
  
  # 电源控制状态
  cpu_power_on:
    expr: cpu_power_req & cpu_power_ack
  gpu_power_on:
    expr: gpu_power_req & gpu_power_ack
  npu_power_on:
    expr: npu_power_req & npu_power_ack
  ddr_power_on:
    expr: ddr_power_req & ddr_power_ack
  periph_power_on:
    expr: periph_power_req & periph_power_ack
  all_power_on:
    expr: cpu_power_on & gpu_power_on & npu_power_on & ddr_power_on & periph_power_on
  
  # 时钟门控状态
  cpu_clock_enabled:
    bits: 1
    expr: ~cpu_clk_gate & cpu_power_on
  gpu_clock_enabled:
    bits: 1
    expr: not gpu_clk_gate & gpu_power_on
  npu_clock_enabled:
    bits: 1
    expr: ~npu_clk_gate & npu_power_on
  ddr_clock_enabled:
    bits: 1
    expr: not ddr_clk_gate & ddr_power_on
  periph_clock_enabled:
    bits: 1
    expr: "! (periph_clk_gate & periph_power_on)"
  bus_clock_enabled:
    bits: 1
    expr: !bus_clk_gate
  
  # 复位门控状态 - 使用新的复位控制器信号
  cpu_reset_released:
    bits: 1
    expr: cpu_rst_n && cpu_clock_enabled
  mcu_reset_released:
    bits: 1
    expr: mcu_rst_n && mcu_clock_enabled
  m0_reset_released:
    bits: 1
    expr: m0_rst_n && m0plus_clock_enabled
  gpu_reset_released:
    bits: 1
    expr: rst_gpu && gpu_clock_enabled
  npu_reset_released:
    bits: 1
    expr: rst_npu && npu_clock_enabled
  ddr_reset_released:
    bits: 1
    expr: mem_rst_n && ddr_clock_enabled
  periph_reset_released:
    bits: 1
    expr: periph_rst_n && periph_clock_enabled
  bus_reset_released:
    bits: 1
    expr: sys_rst_n && bus_clock_enabled
  
  # 低功耗模式状态
  in_sleep_mode:
    expr: sleep_mode && !stop_mode && !standby_mode && !shutdown_mode
  in_stop_mode:
    expr: stop_mode && !standby_mode && !shutdown_mode
  in_standby_mode:
    expr: standby_mode && !shutdown_mode
  in_shutdown_mode:
    expr: shutdown_mode
  in_retention_mode:
    expr: retention_mode
  low_power_active:
    expr: in_sleep_mode || in_stop_mode || in_standby_mode || in_shutdown_mode || in_retention_mode
  
  # 电源隔离状态
  cpu_isolated:
    expr: cpu_isolation && (in_stop_mode || in_standby_mode || in_shutdown_mode)
  gpu_isolated:
    expr: gpu_isolation && (in_stop_mode || in_standby_mode || in_shutdown_mode)
  npu_isolated:
    expr: npu_isolation && (in_stop_mode || in_standby_mode || in_shutdown_mode)
  ddr_isolated:
    expr: ddr_isolation && (in_standby_mode || in_shutdown_mode)
  periph_isolated:
    expr: periph_isolation && (in_stop_mode || in_standby_mode || in_shutdown_mode)
  
  # 电源序列状态
  power_sequence_active:
    expr: power_sequence
  power_sequence_complete:
    expr: power_sequence_done && !power_sequence_error
  power_sequence_failed:
    expr: power_sequence_error
  
  # 温度监控状态
  temp_alarm_active:
    expr: temp_alarm
  temp_shutdown_active:
    expr: temp_shutdown
  thermal_fault:
    expr: temp_alarm_active || temp_shutdown_active
  
  # 电源管理就绪状态
  power_management_ready:
    expr: all_power_ready && !power_fault && power_sequence_complete && !thermal_fault
  system_power_ready:
    expr: power_management_ready && all_power_on && cpu_clock_enabled && cpu_reset_released
  low_power_exit_ready:
    expr: wakeup_active && low_power_active && !power_fault



# 第10部分：最终系统状态整合
net:
  # 系统级就绪信号整合
  system_ready_all:
    driver: comb.system_ready_final
  system_error_all:
    driver: comb.system_error_final
  system_status_all:
    bits: 32
    driver: comb.system_status_vector
  
  # 处理器系统状态
  cpu_cluster_ready:
    driver: comb.cpu_cluster_final
  mcu_ready:
    driver: comb.mcu_final
  m0plus_ready:
    driver: comb.m0plus_final
  processors_ready:
    driver: comb.all_processors_ready
  
  # 存储器系统状态
  memory_system_ready:
    driver: comb.memory_system_final
  ddr_ready:
    driver: comb.ddr_final
  sram_ready:
    driver: comb.sram_final
  flash_ready:
    driver: comb.flash_final
  
  # 外设系统状态
  peripheral_system_ready:
    driver: comb.peripheral_system_final
  high_speed_periph_ready:
    driver: comb.high_speed_periph_final
  low_speed_periph_ready:
    driver: comb.low_speed_periph_final
  analog_periph_ready:
    driver: comb.analog_periph_final
  
  # 通信系统状态
  communication_ready:
    driver: comb.communication_final
  network_ready:
    driver: comb.network_final
  storage_ready:
    driver: comb.storage_final
  debug_ready:
    driver: comb.debug_final
  
  # 时钟系统状态
  clock_system_ready:
    driver: comb.clock_system_final
  pll_system_ready:
    driver: comb.pll_final
  oscillator_ready:
    driver: comb.osc_final
  
  # 电源系统状态
  power_system_ready:
    driver: comb.power_system_final
  power_domain_ready:
    driver: comb.power_domain_final
  low_power_ready:
    driver: comb.low_power_final
  
  # 安全系统状态
  security_ready:
    driver: comb.security_final
  tamper_status:
    driver: comb.tamper_final
  secure_boot_status:
    driver: comb.secure_boot_final
  
  # 系统健康监控
  system_health:
    bits: 16
    driver: comb.health_status_vector
  performance_status:
    bits: 8
    driver: comb.performance_vector
  error_status:
    bits: 16
    driver: comb.error_vector
  
  # 复位状态监控
  reset_status:
    bits: 8
    driver: comb.reset_reason_vector
  reset_in_progress:
    driver: comb.reset_in_progress
  system_reset_active:
    driver: comb.system_reset_active
  reset_sequence_done:
    driver: comb.reset_sequence_done
  
  # 复位原因记录
  reset_reason:
    bits: 8
    driver: comb.reset_reason_vector
  reason_valid:
    driver: comb.reason_valid
  reason_clear:
    driver: port.reason_clear
  
  # 系统配置状态
  config_valid:
    driver: comb.config_final
  boot_status:
    bits: 4
    driver: comb.boot_status_vector
  mode_status:
    bits: 8
    driver: comb.mode_status_vector
  
  # 测试和调试控制
  test_en:
    driver: port.test_en

bus:
  # 系统状态总线
  system_status_bus:
    - instance: instance.syscfg
      port: status
    - instance: instance.apb_interconnect
      port: syscfg_slave
  
  # 系统健康监控总线
  health_monitor_bus:
    - instance: instance.health_monitor
      port: cfg
    - instance: instance.apb_interconnect
      port: health_slave
  
  # 复位控制总线
  reset_control_bus:
    - instance: instance.rcc
      port: reset_cfg
    - instance: instance.apb_interconnect
      port: reset_slave
  
  # 复位状态监控总线
  reset_status_bus:
    - instance: instance.reset.main_reset_ctrl
      port: status
    - instance: instance.apb_interconnect
      port: reset_status_slave

comb:
  # 最终系统就绪状态
  system_ready_final: { bits: 1, expr: "power_system_ready && clock_system_ready && memory_system_ready && processor_system_ready && peripheral_system_ready && communication_ready && security_ready && debug_ready" }
  
  # 处理器系统最终状态
  cpu_cluster_final: { bits: 1, expr: "cortexa35_ready && cpu_power_on && cpu_clock_enabled && cpu_reset_released && !cpu_isolated" }
  mcu_final: { bits: 1, expr: "cortexm33_ready && mcu_power_on && mcu_clock_enabled && mcu_reset_released && !mcu_isolated" }
  m0plus_final: { bits: 1, expr: "cortexm0plus_ready && m0plus_power_on && m0plus_clock_enabled && m0_reset_released && !m0plus_isolated" }
  processor_system_ready: { bits: 1, expr: "cpu_cluster_final && mcu_final && m0plus_final" }
  all_processors_ready: { bits: 1, expr: "processor_system_ready && !low_power_active" }
  
  # 存储器系统最终状态
  memory_system_final: { expr: "ddr_final & sram_final & flash_final & memory_protection_ready & !memory_fault" }
  ddr_final: { expr: "ddr_ready & ddr_power_on & ddr_clock_enabled & ddr_reset_released & !ddr_isolated & !ddr_ecc_error" }
  sram_final: { expr: "sram_ready & sram_power_on & sram_clock_enabled & !sram_ecc_error" }
  flash_final: { expr: "flash_ready & flash_power_on & !flash_error & !flash_ecc_error" }
  
  # 外设系统最终状态
  peripheral_system_final: { expr: "high_speed_periph_final & low_speed_periph_final & analog_periph_final & !peripheral_fault" }
  high_speed_periph_final: { expr: "gpu_ready & npu_ready & video_ready & usb_ready & eth_ready & pcie_ready & sdmmc_ready & qspi_ready" }
  low_speed_periph_final: { expr: "gpio_ready & low_speed_ready & timer_system_ready & dma_ready" }
  analog_periph_final: { expr: "adc_ready & dac_ready & temp_ready & analog_ready" }
  
  # 通信系统最终状态
  communication_final: { expr: "network_final & storage_final & !communication_error" }
  network_final: { expr: "eth_ready & usb_ready & pcie_ready & can_ready & i2c_ready & spi_ready & usart_ready" }
  storage_final: { expr: "sdmmc_ready & qspi_ready & flash_ready" }
  debug_final: { expr: "debug_system_ready & jtag_ready & swd_ready & trace_ready" }
  
  # 时钟系统最终状态
  clock_system_final: { expr: "pll_final & osc_final & clock_distribution_ready & !css_fail" }
  pll_final: { expr: "pll1_ready & pll2_ready & pll3_ready & pll4_ready & pll_lock_all & pll_clock_enabled" }
  osc_final: { expr: "hse_ready & hsi_ready & lse_ready & lsi_ready & css_osc_ready" }
  
  # 电源系统最终状态
  power_system_final: { expr: "power_management_ready & power_domain_ready & power_sequence_complete & !power_fault & !thermal_fault" }
  power_domain_final: { expr: "core_power_ready & analog_power_ready & peripheral_power_ready & backup_power_ready & all_power_on" }
  low_power_final: { expr: "low_power_exit_ready & !low_power_conflict & wakeup_configured" }
  
  # 安全系统最终状态
  security_final: { expr: "secure_boot_final & tamper_final & !security_breach" }
  tamper_final: { expr: "!tamper_active & tamper_configured & tamper_filter_ready" }
  secure_boot_final: { expr: "secure_mode & secure_jtag & boot_authentication_pass & !secure_error" }
  
  # 系统配置最终状态
  config_final: { expr: "syscfg_ready & boot_mode_valid & option_bytes_valid & config_loaded & !config_error" }
  boot_status_vector: { bits: 4, expr: "{boot_mode_valid, secure_boot_status, low_power_mode, system_ready_final}" }
  mode_status_vector: { bits: 8, expr: "{sleep_mode, stop_mode, standby_mode, shutdown_mode, retention_mode, secure_mode, debug_mode, test_mode}" }
  
  # 系统健康监控向量
  health_status_vector: { bits: 16, expr: "{power_fault, clock_fault, memory_fault, peripheral_fault, communication_error, security_breach, thermal_fault, config_error, tamper_active, css_fail, ecc_error, reset_in_progress, low_power_active, debug_active, test_active, calibration_active}" }
  
  # 性能状态向量
  performance_vector: { bits: 8, expr: "{cpu_performance_ok, gpu_performance_ok, memory_bandwidth_ok, io_performance_ok, network_performance_ok, thermal_performance_ok, power_efficiency_ok, system_responsive}" }
  
  # 错误状态向量
  error_vector: { bits: 16, expr: "{power_sequence_failed, pll_lock_failed, oscillator_failed, memory_ecc_error, peripheral_timeout, communication_link_error, security_violation, tamper_detected, thermal_shutdown, clock_security_fail, config_checksum_error, boot_authentication_fail, debug_security_breach, test_failure, calibration_error, system_hang_detected}" }
  
  # 系统错误最终状态
  system_error_final: { expr: "|error_vector | power_fault | clock_fault | memory_fault | security_breach | thermal_fault" }
  
  # 系统状态最终向量
  system_status_vector: { bits: 32, expr: "{system_ready_final, processor_system_ready, memory_system_final, peripheral_system_final, communication_ready, clock_system_final, power_system_final, security_final, config_valid, boot_status_vector, health_status_vector[7:0], performance_vector[7:0]}" }
  
  # 系统运行状态机
  system_run_state: { bits: 2, expr: "system_fsm_state[1:0]" }
  system_fsm_state: { bits: 2, expr: "system_run_state_machine" }
  
  # 错误处理和恢复机制
  error_recovery_enable: { bits: 1, expr: "system_config_valid" }
  auto_recovery_enable: { bits: 1, expr: "error_recovery_enable & !manual_recovery_mode" }
  manual_recovery_mode: { bits: 1, expr: "instance.syscfg.MANUAL_RECOVERY_MODE" }
  error_recovery_action: { 
    bits: 2, 
    expr: "system_run_state == 2'b11 ? 2'b01 : (system_run_state == 2'b10 & auto_recovery_enable ? 2'b10 : 2'b00)"
  }
  error_recovery_status: { bits: 1, expr: "error_recovery_action != 2'b00" }
  
  # 系统运行状态机定义
  system_run_state_machine: { 
    expr: "// 简化系统状态机编码\n// 2'b00: INIT - 系统初始化状态\n// 2'b01: NORMAL - 正常运行状态\n// 2'b10: DEGRADED - 降级运行状态\n// 2'b11: ERROR - 系统错误状态"
  }
  
  # 最终系统健康指示
  system_healthy: { expr: "system_ready_final & !system_error_final & performance_vector[0] & health_status_vector[0]" }
  system_degraded: { expr: "!system_healthy & !system_error_final & |performance_vector[7:1]" }
  system_failed: { expr: "system_error_final & !system_ready_final" }
  system_recovery_possible: { expr: "system_failed & !power_fault & !thermal_fault & !security_breach" }
  
  # 错误处理和恢复机制
  error_detected: { bits: 1, expr: "system_error_final || ecc_fatal || thermal_fault || power_sequence_failed" }
  error_type: { bits: 4, expr: "{system_error_final, ecc_fatal, thermal_fault, power_sequence_failed}" }
  error_recovery_active: { bits: 1, expr: "error_detected && !system_reset_active" }
  system_reset_active: { bits: 1, expr: "error_to_reset || manual_reset_request" }
  system_reset_complete: { bits: 1, expr: "system_reset_active && reset_sequence_done" }
  recovery_successful: { bits: 1, expr: "error_recovery_active && !error_detected && system_ready_final" }
  recovery_failed: { bits: 1, expr: "error_recovery_active && error_detected && !system_ready_final" }
  manual_reset_request: { bits: 1, expr: "instance.syscfg.MANUAL_RESET_REQ" }
  reset_sequence_done: { bits: 1, expr: "reset.main_reset_ctrl.reset_sequence_done" }
  
  # Reset Cause Detection and Recording
  por_reset_active: { bits: 1, expr: "!por_rst_n" }
  nrst_reset_active: { bits: 1, expr: "!nrst_n" }
  bor_reset_active: { bits: 1, expr: "!bor_rst_n" }
  iwdg_reset_active: { bits: 1, expr: "!iwdg_rst_n" }
  wwdg_reset_active: { bits: 1, expr: "!wwdg_rst_n" }
  sw_reset_active: { bits: 1, expr: "!sw_rst_n" }
  css_reset_active: { bits: 1, expr: "!css_rst_n" }
  
  # Reset Status Monitoring
  reset_in_progress: { bits: 1, expr: "!cpu_rst_n || !mcu_rst_n || !m0_rst_n || !sys_rst_n" }
  cpu_reset_active: { bits: 1, expr: "!cpu_rst_n" }
  mcu_reset_active: { bits: 1, expr: "!mcu_rst_n" }
  m0_reset_active: { bits: 1, expr: "!m0_rst_n" }
  sys_reset_active: { bits: 1, expr: "!sys_rst_n" }
  mem_reset_active: { bits: 1, expr: "!mem_rst_n" }
  periph_reset_active: { bits: 1, expr: "!periph_rst_n" }
  
  # Reset Reason Vector (for reset reason recording)
  reset_reason_vector: { bits: 8, expr: "{por_reset_active, nrst_reset_active, bor_reset_active, iwdg_reset_active, wwdg_reset_active, sw_reset_active, css_reset_active, reset_in_progress}" }
  
  # Application Domain Reset Status
  app_reset_active: { bits: 1, expr: "!app_cpu_rst_n || !app_periph_rst_n" }
  app_cpu_reset_active: { bits: 1, expr: "!app_cpu_rst_n" }
  app_periph_reset_active: { bits: 1, expr: "!app_periph_rst_n" }
  
  # Debug Domain Reset Status
  dbg_reset_active: { bits: 1, expr: "!dbg_cpu_rst_n || !dbg_mcu_rst_n" }
  dbg_cpu_reset_active: { bits: 1, expr: "!dbg_cpu_rst_n" }
  dbg_mcu_reset_active: { bits: 1, expr: "!dbg_mcu_rst_n" }

# 参数合法性检查规则
validation:
  # RCC参数验证规则
  rcc_parameter_rules:
    - rule: frequency_range_check
      description: "RCC频率参数范围检查"
      target: instance.rcc.parameter.FREQUENCY
      condition: "value >= 1000000 && value <= 1000000000"
      severity: error
      message: "RCC频率必须在1MHz到1GHz之间"
    
    - rule: pll_count_validation
      description: "PLL数量参数验证"
      target: instance.rcc.parameter.PLL_COUNT
      condition: "value >= 1 && value <= 8"
      severity: error
      message: "PLL数量必须在1到8之间"
    
    - rule: clock_source_validation
      description: "时钟源数量参数验证"
      target: instance.rcc.parameter.CLOCK_SOURCE_COUNT
      condition: "value >= 2 && value <= 10"
      severity: error
      message: "时钟源数量必须在2到10之间"
  
  # 通用时钟频率参数验证
  clock_frequency_rules:
    - rule: cpu_frequency_range
      description: "CPU时钟频率范围检查"
      target: "instance.*.parameter.FREQUENCY"
      condition: "value >= 1000000 && value <= 2000000000"
      severity: error
      message: "CPU时钟频率必须在1MHz到2GHz之间"
      applies_to: ["cortexa35", "cortexm33", "cortexm0plus"]
    
    - rule: peripheral_frequency_range
      description: "外设时钟频率范围检查"
      target: "instance.*.parameter.FREQUENCY"
      condition: "value >= 100000 && value <= 500000000"
      severity: warning
      message: "外设时钟频率建议在100kHz到500MHz之间"
      applies_to: ["gpio", "timer", "usart", "spi", "i2c"]
    
    - rule: bus_frequency_range
      description: "总线时钟频率范围检查"
      target: "instance.*.parameter.FREQUENCY"
      condition: "value >= 1000000 && value <= 800000000"
      severity: error
      message: "总线时钟频率必须在1MHz到800MHz之间"
      applies_to: ["axi_interconnect", "ahb_interconnect", "apb_interconnect"]
  
  # 存储器参数验证
  memory_parameter_rules:
    - rule: flash_size_validation
      description: "Flash存储器大小验证"
      target: instance.flash.parameter.FLASH_SIZE
      condition: "value >= 65536 && value <= 16777216"
      severity: error
      message: "Flash大小必须在64KB到16MB之间"
    
    - rule: flash_sector_count
      description: "Flash扇区数量验证"
      target: instance.flash.parameter.SECTOR_COUNT
      condition: "value >= 4 && value <= 256"
      severity: warning
      message: "Flash扇区数量建议在4到256之间"
    
    - rule: ddr_size_validation
      description: "DDR存储器大小验证"
      target: instance.ddrc.parameter.MEMORY_SIZE
      condition: "value >= 8388608 && value <= 4294967296"
      severity: error
      message: "DDR大小必须在8MB到4GB之间"
  
  # 外设参数验证
  peripheral_parameter_rules:
    - rule: gpio_pin_count
      description: "GPIO端口引脚数量验证"
      target: "instance.gpio*.parameter.PIN_COUNT"
      condition: "value >= 1 && value <= 32"
      severity: error
      message: "GPIO端口引脚数量必须在1到32之间"
    
    - rule: timer_prescaler_range
      description: "定时器预分频器范围检查"
      target: "instance.*timer*.parameter.PRESCALER"
      condition: "value >= 0 && value <= 65535"
      severity: error
      message: "定时器预分频器必须在0到65535之间"
    
    - rule: usart_baudrate_range
      description: "USART波特率范围检查"
      target: "instance.usart*.parameter.BAUDRATE"
      condition: "value >= 300 && value <= 3000000"
      severity: warning
      message: "USART波特率建议在300到3Mbps之间"
  
  # 系统参数验证
  system_parameter_rules:
    - rule: power_domain_count
      description: "电源域数量验证"
      target: "instance.*pwr*.parameter.POWER_DOMAIN_COUNT"
      condition: "value >= 1 && value <= 16"
      severity: error
      message: "电源域数量必须在1到16之间"
    
    - rule: interrupt_priority_bits
      description: "中断优先级位宽验证"
      target: "instance.*nvic*.parameter.PRIORITY_BITS"
      condition: "value >= 2 && value <= 8"
      severity: error
      message: "中断优先级位宽必须在2到8之间"
    
    - rule: dma_channel_count
      description: "DMA通道数量验证"
      target: "instance.*dma*.parameter.CHANNEL_COUNT"
      condition: "value >= 1 && value <= 32"
      severity: error
      message: "DMA通道数量必须在1到32之间"
  
  # 安全参数验证
  security_parameter_rules:
    - rule: boot_mode_count
      description: "启动模式数量验证"
      target: instance.syscfg.parameter.BOOT_MODE_COUNT
      condition: "value >= 2 && value <= 16"
      severity: error
      message: "启动模式数量必须在2到16之间"
    
    - rule: exti_line_count
      description: "外部中断线数量验证"
      target: instance.syscfg.parameter.EXTI_COUNT
      condition: "value >= 1 && value <= 128"
      severity: error
      message: "外部中断线数量必须在1到128之间"
    
    - rule: tamper_pin_count
      description: "防篡改引脚数量验证"
      target: "instance.*tamp*.parameter.PIN_COUNT"
      condition: "value >= 0 && value <= 8"
      severity: warning
      message: "防篡改引脚数量建议在0到8之间"
  
  # 参数依赖关系验证
  parameter_dependency_rules:
    - rule: pll_frequency_dependency
      description: "PLL频率依赖关系检查"
      target: "instance.rcc.parameter.*"
      condition: "pll1_p_freq <= pll1_vco_freq && pll1_p_freq >= (pll1_vco_freq / 128)"
      severity: error
      message: "PLL输出频率必须在VCO频率的1/128到1倍之间"
    
    - rule: clock_divider_dependency
      description: "时钟分频器依赖关系检查"
      target: "instance.*clk_divider*.parameter.*"
      condition: "input_freq >= output_freq && input_freq % output_freq == 0"
      severity: error
      message: "时钟分频器输入频率必须是输出频率的整数倍"
    
    - rule: memory_timing_dependency
      description: "存储器时序参数依赖关系"
      target: "instance.*ddr*.parameter.*"
      condition: "cas_latency <= ras_to_cas_delay && ras_to_cas_delay <= row_precharge_time"
      severity: error
      message: "存储器时序参数不满足约束关系(CL <= tRCD <= tRP)"
  
  # 性能参数验证
  performance_parameter_rules:
    - rule: max_frequency_limit
      description: "最大频率限制检查"
      target: "instance.*.parameter.FREQUENCY"
      condition: "value <= instance.*.parameter.MAX_FREQUENCY"
      severity: error
      message: "工作频率不能超过最大允许频率"
    
    - rule: power_consumption_limit
      description: "功耗限制检查"
      target: "instance.*.parameter.POWER_CONSUMPTION"
      condition: "value <= instance.*.parameter.MAX_POWER"
      severity: warning
      message: "功耗超过建议最大值"
    
    - rule: temperature_range_check
      description: "工作温度范围检查"
      target: "instance.*.parameter.OPERATING_TEMP"
      condition: "value >= -40 && value <= 125"
      severity: error
      message: "工作温度必须在-40°C到125°C之间"
  
  # 兼容性检查
  compatibility_rules:
    - rule: voltage_compatibility
      description: "电压兼容性检查"
      target: "instance.*.parameter.OPERATING_VOLTAGE"
      condition: "abs(value - 1.2) <= 0.1 || abs(value - 1.8) <= 0.1 || abs(value - 3.3) <= 0.3"
      severity: error
      message: "工作电压必须是标准值(1.2V, 1.8V, 3.3V)"
    
    - rule: io_standard_compatibility
      description: "I/O标准兼容性检查"
      target: "instance.gpio*.parameter.IO_STANDARD"
      condition: "value in ['LVCMOS12', 'LVCMOS18', 'LVCMOS33', 'LVTTL', 'SSTL15']"
      severity: warning
      message: "建议使用标准I/O电平标准"